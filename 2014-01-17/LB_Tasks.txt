ÊÊ` Method: LB_TasksÊÊ` DescriptionÊÊ` ÊÊ` ParametersÊÊ` $1 : $Task_txt ("SETWINDOWTITLE" | "SHOWALL" | "SHOWSELECTION" | "OMITSELECTION" | "CLEARHEADERS" | "QUERY" | "QUERYSELECTION"ÊÊ` "ORDER" | "DESELECTALL")ÊÊ` ----------------------------------------------------If (False)ÊÊ` User name (OS): Costas ManousakisÊÊ` User name (4D): DesignerÊÊ` Date and time: 01/14/14, 16:09:55ÊÊ` ----------------------------------------------------ÊÊ` First ReleaseMods_2014_01 End if C_LONGINT($0;$Result_L)$Result_L:=0C_TEXT($1;$Task_txt)C_TEXT($2;$LB_BaseName_txt)$Task_txt:=$1$LB_BaseName_txt:=$2C_POINTER($LB_Table_ptr)C_LONGINT($LB_Table_Num_L)C_TEXT($LB_FullName_txt;$LB_HiliteSet_txt;$LB_Selection_txt)$LB_FullName_txt:=$LB_BaseName_txt+"_LB"$LB_HiliteSet_txt:=$LB_BaseName_txt+"_HS"GET LISTBOX TABLE SOURCE(*;$LB_FullName_txt;$LB_Table_Num_L;$LB_Selection_txt)$LB_Table_ptr:=Table($LB_Table_Num_L)Case of : ($Task_txt="SHOWALL")ALL RECORDS($LB_Table_ptr->)LB_Tasks ("CLEARHEADERS";$LB_BaseName_txt)LB_Tasks ("DESELECTALL";$LB_BaseName_txt)LB_Tasks ("SETWINDOWTITLE";$LB_BaseName_txt): ($Task_txt="SHOWSELECTION")If (Records in set($LB_HiliteSet_txt)>0)USE SET($LB_HiliteSet_txt)LB_Tasks ("CLEARHEADERS";$LB_BaseName_txt)LB_Tasks ("DESELECTALL";$LB_BaseName_txt)LB_Tasks ("SETWINDOWTITLE";$LB_BaseName_txt)Else ALERT("No Records have been Selected!")End if : ($Task_txt="DELETESELECTION")C_LONGINT($NumToDelete_L)$NumToDelete_L:=Records in set($LB_HiliteSet_txt)If ($NumToDelete_L>0)CONFIRM("You are about to delete "+String($NumToDelete_L)+" records!  Are you sure you want to continue?";"DELETE";"Cancel")If (OK=1)USE SET($LB_HiliteSet_txt)LB_Tasks ("CLEARHEADERS";$LB_BaseName_txt)LB_Tasks ("DESELECTALL";$LB_BaseName_txt)LB_Tasks ("SETWINDOWTITLE";$LB_BaseName_txt)End if Else ALERT("No Records have been Selected!")End if : ($Task_txt="OMITSELECTION")If (Records in set($LB_HiliteSet_txt)>0)CREATE SET($LB_Table_ptr->;"MyLocalSet")DIFFERENCE("MyLocalSet";$LB_HiliteSet_txt;$LB_HiliteSet_txt)USE SET($LB_HiliteSet_txt)CLEAR SET("MyLocalSet")ÊÊ`CLEAR SET("SelectedRecordsSet")LB_Tasks ("CLEARHEADERS";$LB_BaseName_txt)LB_Tasks ("DESELECTALL";$LB_BaseName_txt)LB_Tasks ("SETWINDOWTITLE";$LB_BaseName_txt)Else ALERT("No Records have been Selected to Omit!")End if : ($Task_txt="SORT")ORDER BY($LB_Table_ptr->)If (OK=1)LB_Tasks ("CLEARHEADERS";$LB_BaseName_txt)LB_Tasks ("DESELECTALL";$LB_BaseName_txt)End if : ($Task_txt="QUERY")COPY NAMED SELECTION($LB_Table_ptr->;"LBPREQUERYSELECTION")QUERY($LB_Table_ptr->)If (OK=1)If (Records in selection($LB_Table_ptr->)>0)LB_Tasks ("CLEARHEADERS";$LB_BaseName_txt)LB_Tasks ("DESELECTALL";$LB_BaseName_txt)LB_Tasks ("SETWINDOWTITLE";$LB_BaseName_txt)Else ALERT("No Records were found!!")USE NAMED SELECTION("LBPREQUERYSELECTION")End if CLEAR NAMED SELECTION("LBPREQUERYSELECTION")End if : ($Task_txt="QUERYSELECTION")COPY NAMED SELECTION($LB_Table_ptr->;"LBPREQUERYSELECTION")QUERY SELECTION($LB_Table_ptr->)If (OK=1)If (Records in selection($LB_Table_ptr->)>0)LB_Tasks ("CLEARHEADERS";$LB_BaseName_txt)LB_Tasks ("DESELECTALL";$LB_BaseName_txt)LB_Tasks ("SETWINDOWTITLE";$LB_BaseName_txt)Else ALERT("No Records were found!!")USE NAMED SELECTION("LBPREQUERYSELECTION")End if CLEAR NAMED SELECTION("LBPREQUERYSELECTION")End if : ($Task_txt="CLEARHEADERS")C_LONGINT($numcols)ARRAY TEXT($arrColNames_atxt;0)ARRAY TEXT($ColHdrNames_atxt;0)ARRAY POINTER($ColVars;0)ARRAY POINTER($HeaderVars;0)ARRAY BOOLEAN($colVis;0)ARRAY POINTER($ColStyles;0)GET LISTBOX ARRAYS(*;$LB_FullName_txt;$arrColNames_atxt;$ColHdrNames_atxt;$ColVars;$HeaderVars;$colVis;$ColStyles)C_LONGINT($loop_L)For ($loop_L;1;Size of array($HeaderVars))$HeaderVars{$loop_L}->:=0End for : ($Task_txt="SETWINDOWTITLE")C_TEXT($WinTitle_txt)$WinTitle_txt:=""C_LONGINT($indx_L)$indx_L:=Find in array(LB_ListBoxNames_atxt;$LB_BaseName_txt)If ($indx_L>0)$WinTitle_txt:=LB_WindowTitles_atxt{$indx_L}End if If ($WinTitle_txt#"")SET WINDOW TITLE($WinTitle_txt+" - Displaying ["+String(Records in selection($LB_Table_ptr->);"###,###,##0")+" out of "+String(Records in table($LB_Table_ptr->);"###,###,##0")+"] records")Else SET WINDOW TITLE("Displaying ["+String(Records in selection($LB_Table_ptr->);"###,###,##0")+" out of "+String(Records in table($LB_Table_ptr->);"###,###,##0")+"] records")End if : ($Task_txt="DESELECTALL")CREATE EMPTY SET($LB_Table_ptr->;$LB_HiliteSet_txt): ($Task_txt="ADDTOLIST")C_TEXT($3;$WinTitle_txt)$WinTitle_txt:=$3C_TEXT($4;$inputForm_txt)$inputForm_txt:=$4C_LONGINT($KeyFldNum_L)$KeyFldNum_L:=0If (Count parameters>4)C_POINTER($5;$KeyFld_Ptr)$KeyFld_Ptr:=$5$KeyFldNum_L:=Field($KeyFld_Ptr)End if C_LONGINT($indx_L)If (Type(LB_ListBoxNames_atxt)#Text array )ARRAY TEXT(LB_ListBoxNames_atxt;0)ARRAY TEXT(LB_WindowTitles_atxt;0)ARRAY TEXT(LB_InputForms_atxt;0)ARRAY LONGINT(LB_ListBoxKeyFldNum_aL;0)End if $indx_L:=Find in array(LB_ListBoxNames_atxt;$LB_BaseName_txt)If ($indx_L>0)LB_WindowTitles_atxt{$indx_L}:=$WinTitle_txtElse APPEND TO ARRAY(LB_ListBoxNames_atxt;$LB_BaseName_txt)APPEND TO ARRAY(LB_WindowTitles_atxt;$WinTitle_txt)APPEND TO ARRAY(LB_InputForms_atxt;$inputForm_txt)APPEND TO ARRAY(LB_ListBoxKeyFldNum_aL;$KeyFldNum_L)End if QUERY([LB_QueryTable];[LB_QueryTable]QueryName_s=$LB_BaseName_txt)Case of : (Records in selection([LB_QueryTable])<1)If (User in group(Current user;"Design Access Group"))CREATE RECORD([LB_QueryTable])[LB_QueryTable]QueryName_s:=$LB_BaseName_txt[LB_QueryTable]TableNumber_l:=Table($LB_Table_ptr)[LB_QueryTable]TableName_s:=Table name($LB_Table_ptr)[LB_QueryTable]WindowTitle_s:=$WinTitle_txtInc_Sequence ("LB_QueryTable";->[LB_QueryTable]UniqueKey_l)LogNewRecord (->[LB_QueryTable]UniqueKey_l;->[LB_QueryTable]UniqueKey_l;->[LB_QueryTable]UniqueKey_l;0;"LB_QueryTable")InitChangeStack (1)PushChange (1;->[LB_QueryTable]QueryName_s)PushChange (1;->[LB_QueryTable]TableNumber_l)PushChange (1;->[LB_QueryTable]TableName_s)PushChange (1;->[LB_QueryTable]WindowTitle_s)FlushGrpChgs (1;->[LB_QueryTable]UniqueKey_l;->[LB_QueryTable]UniqueKey_l;->[LB_QueryTable]UniqueKey_l;0)SAVE RECORD([LB_QueryTable])Else ALERT("Listing "+$LB_BaseName_txt+" has not been defined in the current data file!!!"+" Please contact a database administrator!!")End if : (Records in selection([LB_QueryTable])>1)ALERT("Multiple entries found for listing "+$LB_BaseName_txt+" in the current data file!!!"+" Please contact a database administrator!!")End case : ($Task_txt="DOUBLECLICK")C_TEXT($inputForm_txt)$inputForm_txt:=""$indx_L:=Find in array(LB_ListBoxNames_atxt;$LB_BaseName_txt)If (Records in set($LB_HiliteSet_txt)>0)If ($indx_L>0)$inputForm_txt:=LB_InputForms_atxt{$indx_L}End if If ($LB_Selection_txt#"")USE NAMED SELECTION($LB_Selection_txt)End if C_LONGINT($LBCol_L;$LBRow_L)GET LISTBOX CELL POSITION(*;$LB_FullName_txt;$LBCol_L;$LBRow_L)If ($LBRow_L>0)GOTO SELECTED RECORD($LB_Table_ptr->;$LBRow_L)If ($inputForm_txt#"")INPUT FORM($LB_Table_ptr->;$inputForm_txt)If (Read only state($LB_Table_ptr->))READ ONLY($LB_Table_ptr->)LOAD RECORD($LB_Table_ptr->)DIALOG($LB_Table_ptr->;$inputForm_txt)Else C_LONGINT($LoadRecResult_L)$LoadRecResult_L:=ut_LoadRecordInteractiveV2 ($LB_Table_ptr)Case of : ($LoadRecResult_L=1)MODIFY RECORD($LB_Table_ptr->)$Result_L:=1: ($LoadRecResult_L=2)READ ONLY($LB_Table_ptr->)LOAD RECORD($LB_Table_ptr->)DIALOG($LB_Table_ptr->;$inputForm_txt)End case End if If (Selected record number($LB_Table_ptr->)>0)SELECT LISTBOX ROW(*;$LB_FullName_txt;Selected record number($LB_Table_ptr->);Replace listbox selection )SCROLL LINES(*;$LB_FullName_txt;Selected record number($LB_Table_ptr->))Else ÊÊ`deleted a recordARRAY LONGINT($RecordNumbers_aL;Records in selection($LB_Table_ptr->))SELECTION TO ARRAY($LB_Table_ptr->;$RecordNumbers_aL)C_LONGINT($loop_L)For ($loop_L;Size of array($RecordNumbers_aL);1;-1)If ($RecordNumbers_aL{$loop_L}<=0)DELETE FROM ARRAY($RecordNumbers_aL;$loop_L;1)End if End for CREATE SELECTION FROM ARRAY($LB_Table_ptr->;$RecordNumbers_aL)LB_Tasks ("DESELECTALL";$LB_BaseName_txt)LB_Tasks ("SETWINDOWTITLE";$LB_BaseName_txt)End if Else ALERT("No Input Form Defined!!")End if End if End if : ($Task_txt="CLICK"): (($Task_txt="SAVESELECTION")Ê|Ê($Task_txt="LOADSELECTION")Ê|Ê($Task_txt="ADDSELECTION")Ê|Ê($Task_txt="SUBTRACTSELECTION")Ê|Ê($Task_txt="INTERSECTSELECTION"))$Task_txt:=Replace string($Task_txt;"SELECTION";"")$indx_L:=Find in array(LB_ListBoxNames_atxt;$LB_BaseName_txt)If ($indx_L>0)If (LB_ListBoxKeyFldNum_aL{$indx_L}>0)SETUTIL_Control ($Task_txt;Field(Table($LB_Table_ptr);LB_ListBoxKeyFldNum_aL{$indx_L}))End if End if End case $0:=$Result_L