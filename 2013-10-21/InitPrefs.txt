If (False)  `procedure: InitPrefs  `by: Albert Leung  `created: 10/27/97  `modified: 3/18/98  `purpose: read preferences for application    `  `RELEASES - DISTRIBUTIONS  `2001-4-01 : Changed Version to 2.0  `2001-4-15 : added a line to set ZoneInfo to":4D Server 6.5@*". This to allow the automatic connection using ADSP.  Changed Version to 2.0a fo  `2001-11 : Changed Version to 2.1  `2002-08 : Adjusted ZoneInfo to determine the correct 4D version. Changed MHD BMS appl  `2002-10 : Version 3.0b  `2002-11 : Version 3.0c  `2002-11-26 : Version 3.0d  `2002-12-03 : Version 3.0d1  `2002-12-10 : Version 3.0d2  `2002-12-31 : Version 3.0d3  `2003-01 : Added Unload Record command.  `2003-1-14 : Version 3.0d4  `2003-2-05 : Version 3.1  `2003-2-10 : Version 3.1a  `2003-2-13 : Version 3.1b  `2003-3-11 : Version 3.1c  `2003-3-24 : Version 3.1d  `2003-3-28 : Version 3.1e  `2003-4-23 : Version 3.1f  `2003-5-27 : Version 3.2-Added inspections FCR, CMI+changed up-downloads.  `2003-6-03 : Version 3.2a-Allow Item 62 in CMI insps+small bug fixes+add D5.  `2003-6-03 : Version 3.2b-Fixes.  `2003-6-23 : Version 3.3-Added Closed and Damage Inspections. Added Group Data transfers. Added Consultan  `2003-6-26 : Version 3.3a-Fix problem in ADD_inspect method. Some more fixes in Damage and Closed insps.  `2003-6-29 : Version 3.3b-+  `2003-6-30 : Version 3.3c-Adjust Dive Low CL pg1, and saving of Insp Dates for UW inspections to SIA table  `2003-7-01 : Version 3.3d-Final† fix on the Item 61 label of UW LowCL pg1.  `2003-8-25 : Version 3.3f-Fixes in Spec memb forms, Damage, Adjustments of buttons in Inspections, Users g  `2003-8-26 : Version 3.3f1-Fix bug in FM DependencyCheck.  `2003-9-02 : Version 3.3f2-more minor bug fixes.  `2003-10-20 : Version 4.0  `2003-10-21 : Version 4.0a-Fix problem in copy-pasting sketches in picture fields and then trying to compress them.  `2003-11-13 : Version 4.0b-Fixes in Save and Cont of inspection;Fix in display of pending inspections;Fix in Print_closed method.  `2004-1-22 : When connecting with 4D Client use the structure file name to define the na  `2004-2-13 : Version 4.1-Multi-page 1s for FC,SpecM, Dam inspections;Combine Routine+Special.  `2004-4-29 : Changed size of◊sPrefname to 255.  `2004-5-04 : Version 4.2-Changed size of input screens;Fixes in Configuring of Inspections;Fixes in renumbering of images;Enhanced ElementDict table to allow faster sorting of Elements;Fixes in various Inspections forms.  `2004-5-27 : Version 4.2a-Fixes in Closed, Culvert and Routine Inspection forms. Adjustment in Rating Repo  `2004-6-06 : Version 4.2b-Added Special Menu item to re-send activity log entries.  `2004-6-20 : Version 4.2c-Fixed Re-Send method. Added Server process and table  for scheduled execution of methods.  `2004-6-30 : Version 4.2c1-Fix controlMenubar.  `2004-7-19 : Version 4.3-Include tracking of Items 21,22,26,106 with each Inspection.  `2004-10-19 : Version 4.3d. See Mods_2004_CM04-10  `2005-3-23 : Version 5.0  Mods_2005_CM03-7  `2005-6-01 : Version 5.0.7 Mods_2005_CM08-12  `2005-7-01 : Version 5.0.8 Mods_2005_CM13  `2005-7-07 : Version 5.0.9 Mods_2005_CM14  `2005-8-25 : Version 5.0.10 Mods_2005_CM15+Mods_2005_VN01   `2005-11-15 : Version 5.1.0   Mods_2005_CM16-Mods_2005_CM18 +Mods_2005_VN02 -3+Contracts Maintenance Module.  `2005-12-06 : Version 5.1.1   Mods_2005_CM19+Mods_2005_VN04   `2006-1-04 : Version 5.1.2   Mods_2005_CM20,21+Mods_2006_CM01   `2006-1-09 : Version 5.1.2a Mods_2006_CM02  `2006-4-04 : Version 5.1.2c Mods_2006_CM03  `2007-1-19 : Version 5.2.0   Mods_2006_CM04-Mods_2007_CM04   `2007-1-29 : Version 5.2.0b   Mods_2006_CM05-Mods_2007_CM05a   `2007-2-14 : Version 5.2.0c   Mods_2007_CM06  `2007-4-18 : Version 5.2.1   Mods_2007_CM07  `2007-6-04 : Version 5.3.0   All the way up to Mods_2007_CM10a+Added the Bridge Project module.  `2008-2-20 : Version 5.4.2   Mods_2007_CM.. to Mods_2008_CM5402  `2008-6-20 : Version 5.4.3   Mods_2008_CM5403  `2010-04-05 : Version 5.7.1a   Mods_2010_03, Mods_2010_04-571a - Also copied the Releases from the Comments of InitPrefs in the structure to the code of InitPrefs above.  `2010-04-26 : Version 5.7.1.b  Mods_2010_04-5.7.1.b  EXTERNAL SERVER ONLY  `2010-04-28 : Version 5.7.1.c  Mods_2010_04-5.7.1.c MHD BRIDGES only  `2010-05-28 : Version 5.8.0  Mods------  `2010-09-02 : Version 5.7.1.d  Only Method Mods_2010_09 in Release Structure file. Incorporates minor changes for MDC user  `2011-01-26 : Version 5.9.0  Mods to mark in Mods_2011_01  `2012-02-03 : Version 6.0.0 - release on v11  `2012-02-14 : Version 6.0.1 - bug fixes in Freeze thaw, RRR, inspection review, etc.  `2012-03-02 : Version 6.0.2 - bug fixes in Transfers , addition of some listboxes, fixes in logging of pictures, new version of POA.  `2012-03-6 : Version 6.0.2.a - bug fixes in table [LB_QueryTable] and the effect in buttons on the Bridge Input form.   `  `  `  `  `Released only as a buld standalone app to the districts  `2012-03-26 : Version 6.0.3 - bug fixes ; Additions/mods to ScourPOA; Custom clone table additions; SpellCheck all.   `2012-04-25 : Version 6.0.4 - bug fixes ; Additions/mods to ScourPOA FVC,  `2012-04-25 : Version 6.0.4a - bug fixes ;  `2012-05-16 : Version 6.0.5 - Add Flood Damage Inspection ; Adjustments in Lists from the Bridge Input form.   `  `  `  `  `Adjustments in POA forms ; Allow local storing of the mail server ;   `  `  `  `  `Review comments are no longer cleared at end of Inspection review ; bug fix in Bridge Design input.  `2012-06-27 : Version 6.0.6 - Minor fixes in POA forms; Bug fix in the [Personnel] log of new records;  `  `  `  `  `Added QA form printing for Inspections ; Fix in printing of Pontis to reset page setup;  `  `  `  `  `Added ProjectInfo Task events; Increased size of print boxes for photo descriptions.  `2012-07-09 : Version 6.0.7- Fix in methods ut_SQLCheckExternalTransfer that locked the record in [ServerProcesses] .   `  `  `  `  `Minor UI fixes/additions ;   `2012-08-30 : Version 6.0.8 -  Bug fixes in ScourPOA module; BridgeDesign print forms; Adjustement in MHD Bridge Status report  `2012-12-12 : Version 6.0.9 - Bug fixes in POA module;   `  `  `  `  `New QR methods;  `  `  `  `  `Started adding more Rail inspection forms and elements- not enabled yet;  `  `  `  `  `Several utilities for the structure;  `  `  `  `  `Start of new method to decide inspection type - not enabled only for designers;  `  `  `  `  `Bug fix in the inspection schedule for non nbi records  `  `  `  `  `Minor UI fixes in Inspection forms and Bridge List.  `2013-01-14 : Version 6.0.9.a - Minor fixes in POA module (forms);   `  `  `  `  `Bug fixes in startup routines (table sorting, personnel arrays)  `  `  `  `  `fix in routine insp page 1 misplaced objects.  `2013-01-16 : Version 6.0.9.b - [FileIDRes Table] visible  `2013-02-27 : Version 6.0.9.c - Fixes in the ut_ReturnKeyFldandVariable method  `  `  `  `  `Added new Bridge status reports for SD by deck area  `  `  `  `  `fix iin fUpforInsp for UW Spec member  `2013-03-19 : Version 6.1.0 - Added new set of inspections for Rail/Transit.   `  `  `  `  `Added modified NBISStackInfo form for MBTA users  `  `  `  `  `Added BridgeLink table to link one to one tables with the bridge table such as RailInfo  `2013-05-29 : Version 6.2.0 - Added new set of inspections for Tunnels.   `  `  `  `  `  `2013-06-11 : Version 6.2.0.a - BUG FIXES  ` Modified by: costasmanousakis-(Designer)-(3/11/09 12:12:20)Mods_2009_03   `  `For MTA and MDC users logged in with 4D Client to the MHD BMS server set   `  `variable ◊Transfer to zero, so that their changes do not go to the district offices.  ` Modified by: costasmanousakis-(Designer)-(4/22/09 10:56:40)Mods_2009_04   `  `Added ".4D@" to the Structure file comparison for the new 2004 type extensions.  `  `When checking for the Prefs in Client mode extract only the filename of the structure file w/out  `  ` the extension.  ` Modified by: costasmanousakis-(Designer)-(2/19/10 13:18:07)Mods_2010_02   `  `If district inspection engineers connect to the boston server  `  `set to no transfer until the district inspection resp is cleared up  `Ugrade to v11  `Modified by: Charles Miller (5/16/11 16:56:19)  `Ugrade to v11  `Modified by: Charles Miller (8/19/11 12:22:31)  ` Modified by: Costas Manousakis-(Designer)-(5/14/12 16:01:33)Mods_2012_05   `  `Call ut_setPrefSMTPServer after loading prefs from db or MHDBMSPrefs fileEnd if C_BOOLEAN($LoadFromDocument_b)$LoadFromDocument_b:=TrueC_STRING(255;◊sPrefname)If (Application type=4D Remote Mode )$LoadFromDocument_b:=FalseC_TEXT($StructFile_txt)C_LONGINT($4Dx_pos_L)$StructFile_txt:=Structure file$4Dx_pos_L:=Position(".4D";$StructFile_txt)If ($4Dx_pos_L<=0)Else $StructFile_txt:=Substring($StructFile_txt;1;($4Dx_pos_L-1))End if ◊sPrefname:=$StructFile_txt+" Prefs"Else C_TEXT($Path_txt;$Ext_txt)$Path_txt:=Structure fileIf (Application type#4D Local Mode )$Ext_txt:=".APP"Else $Ext_txt:=".4D"End if C_BOOLEAN($Complete_b)$Complete_b:=FalseC_LONGINT($pos_l)$pos_l:=Position($Ext_txt;$Path_txt)If ($pos_l>0)Repeat If ($Path_txt≤$pos_l≥=◊PL_DirectorySep_s)$Complete_b:=TrueElse $pos_l:=$pos_l-1End if Until ($Complete_b)$Path_txt:=Substring($Path_txt;1;$pos_l)End if ◊sPrefname:=$Path_txt+"MHD BMS Prefs"End if C_STRING(80;◊Destination;◊Forward;◊ZoneInfo;◊DestIP;◊ForwardIP;◊TxUserName)C_LONGINT(◊Transfer;◊Protocol)C_BOOLEAN(◊ManualCon;◊ShowPrint;◊LockUserTx;◊AllowTxRx)C_TIME($tPref_file)C_STRING(255;$fname)C_STRING(80;$stransfer;$sManualCon;$sShowPrint;$sProtocol;$sLockUserTx;$sAllowTxRx)  `Read the version numberC_STRING(80;◊Version)C_DATE(◊dbDate)ALL RECORDS([Preferences])FIRST RECORD([Preferences])◊dbDate:=[Preferences]dbDate  `changing the version will re-set the vsForward variable in The Rail input forms and methods  `method SIA_RRInput_FM and form method [RAILBridgeInfo];"RailRoutineInput". the check is for 5.9.0 so 5.9.0.a is OK  ` Release format major.minor.sub[.part] ex: 5.6.0 : no part  ; 5.7.1.c (partial fix = c)◊Version:="6.2.1 11-June-2013"If (($LoadFromDocument_b))$fname:=◊sPrefnameON ERR CALL("HandlePrefError")$tPref_file:=Open document($fname;"";Read Mode )End if If (Ok=1) & ($LoadFromDocument_b)  `Read the preferencesON ERR CALL("")  `go back to the default error call. any error including a code error   `will call the error handlerRECEIVE PACKET($tPref_file;◊Destination;◊sCR)RECEIVE PACKET($tPref_file;$stransfer;◊sCR)RECEIVE PACKET($tPref_file;◊Forward;◊sCR)RECEIVE PACKET($tPref_file;◊ZoneInfo;◊sCR)RECEIVE PACKET($tPref_file;$sManualCon;◊sCR)RECEIVE PACKET($tPref_file;$sShowPrint;◊sCR)RECEIVE PACKET($tPref_file;$sProtocol;◊sCR)RECEIVE PACKET($tPref_file;◊DestIP;◊sCR)RECEIVE PACKET($tPref_file;◊ForwardIP;◊sCR)RECEIVE PACKET($tPref_file;$sLockUserTx;◊sCR)RECEIVE PACKET($tPref_file;◊TxUserName;◊sCR)RECEIVE PACKET($tPref_file;$sAllowTxRx;◊sCR)◊Transfer:=Num($stransfer)◊ManualCon:=($sManualCon="True")◊ShowPrint:=($sShowPrint="True")◊Protocol:=Num($sProtocol)◊LockUserTx:=($sLockUserTx="True")◊AllowTxRx:=($sAllowTxRx="True")CLOSE DOCUMENT($tPref_file)Else   `Use defaults stored in data fileON ERR CALL("")ALL RECORDS([Preferences])FIRST RECORD([Preferences])◊Destination:=[Preferences]Destination◊Transfer:=[Preferences]Transfer Type◊Forward:=[Preferences]Forward◊ZoneInfo:=[Preferences]ZoneInfo◊ManualCon:=[Preferences]ManualCon◊ShowPrint:=[Preferences]ShowPrintDialog◊Protocol:=[Preferences]Protocol◊ForwardIP:=[Preferences]ForwardIP◊DestIP:=[Preferences]DestIP◊LockUserTx:=[Preferences]LockUserTx◊TxUserName:=[Preferences]TxUserName◊AllowTxRx:=[Preferences]AllowTxRxEnd if ut_setPrefSMTPServer   `this also calls ut_ControlUserPrefs ("LOAD")  overrides the  values in [preferences] recordIf ((Structure file="MHD BMS.4D@") & (Application type=4D Remote Mode ))C_TEXT($currUser_txt)$currUser_txt:=Current userIf ((User in group($currUser_txt;"MTA")) | (User in group($currUser_txt;"MDC")))◊Transfer:=0End if If (User in group($currUser_txt;"Inspection Engineers"))◊Transfer:=0  `If district inspection engineers connect to the boston server  `set to no transfer until the district inspection resp is cleared upEnd if End if UNLOAD RECORD([Preferences])REDUCE SELECTION([Preferences];0)  `Correctly specify the 4D server zone.C_STRING(48;$s4Dversion)$s4Dversion:=String(Num(Substring(Application version;1;2)))+"."+Substring(Application version;3;1)  `◊ZoneInfo:=":4D Server "+$s4Dversion+"@*"