ÊÊ` Method: ARCHIVE_MakeCopyÊÊ` DescriptionÊÊ` copy all records from a source table to and Archive tableÊÊ` ParametersÊÊ` $0 : $Result_b ÊÊ` $1 : $sourceTbl_ptrÊÊ` $2 : $TargetTbl_ptrÊÊ` $3 : $Reason_s `Reason for ArchiveÊÊ` $4 : $ArchDate_d `Date of archiveIf (False)ÊÊ` ----------------------------------------------------ÊÊ` User name (OS): costasmanousakisÊÊ` User name (4D): DesignerÊÊ` Date and time: 04/11/10, 16:52:23ÊÊ` ----------------------------------------------------ÊÊ` ----------------------------------------------------Mods_2010_04 End if C_BOOLEAN($0;$Result_b)C_POINTER($1;$sourceTbl_ptr)C_POINTER($2;$TargetTbl_ptr)C_STRING(80;$3;$Reason_s)C_DATE($4;$ArchDate_d)$sourceTbl_ptr:=$1$TargetTbl_ptr:=$2$Reason_s:=$3$ArchDate_d:=$4$Result_b:=FalseÊÊ`$sourceTbl_ptr:=->[Bridge MHD NBIS]ÊÊ`$TargetTbl_ptr:=->[BridgeMHDNBISArchive]ÊÊ`match fieldsof source and target by name-and verify type is sameC_POINTER($ReasonFld_ptr;$DateFld_ptr;$SourceFld_ptr;$TargetFld_ptr)C_LONGINT($SourceFlds_L;$TargetFields_L;$Loop_L;$SourceTable_L;$TargetTable_L)$SourceFlds_L:=Get last field number($sourceTbl_ptr)$TargetFields_L:=Get last field number($TargetTbl_ptr)$SourceTable_L:=Table($sourceTbl_ptr)$TargetTable_L:=Table($TargetTbl_ptr)ARRAY STRING(32;$TargetFieldNames_as;$TargetFields_L)ARRAY LONGINT($TargetFieldTypes_aL;$TargetFields_L)C_STRING(32;$FldName_s)C_LONGINT($FldType_L;$fldLen_L;$FldNameMatch_L)For ($Loop_L;1;$TargetFields_L)$FldName_s:=Field name($TargetTable_L;$Loop_L)GET FIELD PROPERTIES($TargetTable_L;$Loop_L;$FldType_L;$fldLen_L)$TargetFieldNames_as{$Loop_L}:=$FldName_s$TargetFieldTypes_aL{$Loop_L}:=$FldType_LCase of : ($FldName_s="@ArchiveReason_s")$ReasonFld_ptr:=Field($TargetTable_L;$Loop_L): ($FldName_s="@ArchiveDate_d")$DateFld_ptr:=Field($TargetTable_L;$Loop_L)End case End for ARRAY LONGINT($TargetFieldNos_aL;Get last field number($sourceTbl_ptr))C_BOOLEAN($MatchedOK_b)$MatchedOK_b:=TrueFor ($Loop_L;1;$SourceFlds_L)$FldName_s:=Field name($SourceTable_L;$Loop_L)GET FIELD PROPERTIES($SourceTable_L;$Loop_L;$FldType_L;$fldLen_L)$TargetFieldNos_aL{$Loop_L}:=0If ($FldType_L#Is Subtable )$FldNameMatch_L:=Find in array($TargetFieldNames_as;$FldName_s)If ($FldNameMatch_L>0)ÊÊ`verify matching typeIf ($FldType_L=$TargetFieldTypes_aL{$FldNameMatch_L})$TargetFieldNos_aL{$Loop_L}:=$FldNameMatch_LElse ALERT("Non-matching Field types for source field "+$FldName_s+" Source type="+String($FldType_L)+" Archivetype="+String($TargetFieldTypes_aL{$FldNameMatch_L}))$MatchedOK_b:=FalseEnd if Else ALERT("Source field "+$FldName_s+" Source type="+String($FldType_L)+" Not Found in the Archive table!")$MatchedOK_b:=FalseEnd if End if End for If ($MatchedOK_b)READ ONLY($sourceTbl_ptr->)ALL RECORDS($sourceTbl_ptr->)FIRST RECORD($sourceTbl_ptr->)While (Not(End selection($sourceTbl_ptr->)))CREATE RECORD($TargetTbl_ptr->)$ReasonFld_ptr->:=$Reason_s$DateFld_ptr->:=$ArchDate_dFor ($Loop_L;1;$SourceFlds_L)If ($TargetFieldNos_aL{$Loop_L}>0)$SourceFld_ptr:=Field($SourceTable_L;$Loop_L)$TargetFld_ptr:=Field($TargetTable_L;$TargetFieldNos_aL{$Loop_L})$TargetFld_ptr->:=$SourceFld_ptr->End if End for SAVE RECORD($TargetTbl_ptr->)NEXT RECORD($sourceTbl_ptr->)End while $Result_b:=TrueEnd if $0:=$Result_b