  `Method: ARCHIVE_ExportNBI  `Description  `  `Export an NBI tape from records in the archive tables  ` Parameters  ` ----------------------------------------------------If (False)  ` ----------------------------------------------------  `User name (OS): Costas Manousakis  `User (4D) : Designer  `Date and time: 04/06/12, 09:17:25  ` ----------------------------------------------------  `Created : Mods_2012_04   ` Modified by: Costas Manousakis-(Designer)-(6/18/13 09:48:14)Mods_2013_06   `  `Added $item8_txt to get fhwaItem8 field if it is populatedEnd if   `C_TIME($dExportFile)C_TIME($dErrFile)  `Added 4/3/2000 CMC_STRING(80;$NBfile)C_STRING(80;$NBErrfile)C_STRING(255;$fill)C_STRING(255;$vsOutputFolder;◊vsNBIExportOutF)C_TEXT($t)C_TEXT($et)  ` added 3/21/2001C_LONGINT($i;$j;$k;$Recs;$Interval)C_LONGINT($l)  `Added 4/3/2000 cm - error record counterC_INTEGER($y;$m)C_STRING(3;$crit)C_STRING(24;$Item6A)  `Added 3/6/98 by Tom Nee.C_STRING(1;$Item6B)C_STRING(18;$Item7)  `Added 3/6/98 by Tom Nee.C_STRING(25;$Item9)  `Added 3/6/98 by Tom Nee.C_STRING(4;$Item10)C_STRING(7;$Item11)C_STRING(1;$Item12)C_STRING(8;$Item16)C_STRING(9;$Item17)C_STRING(3;$Item19)C_STRING(4;$Item27;$Item28)C_STRING(6;$Item29)C_STRING(4;$Item30;$Item32)C_STRING(2;$Item34)C_STRING(1;$Item35;$Item37)  `C_STRING(11;$Item37FHWA;$Item37Code) ` Replaced by call to GP HistoricalTrans.C_STRING(4;$Item39)C_STRING(5;$Item40)C_STRING(3;$Item45)C_STRING(4;$Item46)C_STRING(3;$Item47)C_STRING(5;$Item48)C_STRING(6;$Item49)C_STRING(6;$Item50)C_STRING(4;$Item51;$Item52;$Item53)C_STRING(5;$Item54)C_STRING(4;$Item55)C_STRING(3;$Item56;$Item64;$Item66)C_STRING(6;$Item76)C_STRING(4;$Item90)C_STRING(2;$Item91)C_STRING(9;$Item92)C_STRING(4;$Item93A;$Item93B;$Item93C)C_STRING(6;$Item94;$Item95;$Item96)C_STRING(4;$Item97)C_STRING(1;$Item103;$Item104)C_STRING(4;$Item106)C_STRING(2;$Item109)C_STRING(1;$Item110;$Item112;$Item113)C_STRING(6;$Item114)C_STRING(4;$Item115)C_STRING(4;$Item116)  `C_STRING(2;$Item2)C_STRING(12;$Item13)  `C_STRING(2;$Item21;$Item22)   `C_STRING(1;$Item31;$Item33;$Item36;$Item38;$Item41)C_STRING(3;$Item44)  `C_STRING(1;$Item58;$Item59;$Item60;$Item61;$Item62); C_STRING(1;$Item63;$Item65)  `C_STRING(1;$Item67;$Item68;$Item69;$Item70;$Item71;$Item72)C_STRING(3;$Item75)  `C_STRING(5;$Item98);  `C_STRING(15;$Item99)C_STRING(1;$Item105)  `C_STRING(1;$Item107);  `C_STRING(3;$Item108)C_STRING(1;$Item111)C_BOOLEAN($igItem97;$igItem92a)  `Get only FHWA records  `SEARCH([BridgeMHDNBISArchive];[BridgeMHDNBISArchive]FHWARecord=True)  `  changed by CM to do it for records in selection$Recs:=Records in selection([BridgeMHDNBISArchive])CONFIRM("Export "+String($Recs;"##,##0")+" records to an NBI file (fixed length, 434 characters per record)?")If (OK=1)CENTER_WINDOW (250;190)DIALOG([Dialogs];"SuppressErrors")CLOSE WINDOWIf (Ok=1)$igItem97:=(CBItem97=1)$igItem92a:=(CBItem92a=1)End if   `  $Item37FHWA:="12235334435" ` Replaced by call to GP HistoricalTrans.  `  $Item37Code:="HEPANCR ?XZ" ` Replaced by call to GP HistoricalTrans.$fill:=" "*43$t:="Select folder for Export files."If (◊vsNBIExportOutF#"")$t:=$t+"  (Press Cancel for "+◊vsNBIExportOutF+")"End if $vsOutputFolder:=Select folder($t)If (OK=1)◊vsNBIExportOutF:=$vsOutputFolderElse $vsOutputFolder:=◊vsNBIExportOutFEnd if $NBfile:="MFINPUT.TXT"$dExportFile:=Create document($vsOutputFolder+$NBfile;"TEXT")$NBErrfile:="MFINPUTERR.TXT"$dErrFile:=Create document($vsOutputFolder+$NBErrfile;"TEXT")If (Ok=1)  `TRACE◊ProgressPID:=StartProgress ("NBIExport";"None";"Exporting NBI Records")UpdateProgress (0;$Recs)  `Start the progress$Interval:=MaxNum (MinNum (Int($Recs/40);20);2)  ` get an update interval between 2 and 20$t:=""$k:=0$l:=0FIRST RECORD([BridgeMHDNBISArchive])For ($i;1;$Recs)$Item6A:=" "*24$Item6A:=Change string($Item6A;[BridgeMHDNBISArchive]Item6A;1)  `Added 3/6/98 by Tom Nee.If ([BridgeMHDNBISArchive]Item6B=True)$Item6B:="*"Else $Item6B:=" "End if $Item7:=" "*18$Item7:=Change string($Item7;[BridgeMHDNBISArchive]Item7;1)  `Added 3/6/98 by Tom Nee.$Item9:=" "*25$Item9:=Change string($Item9;[BridgeMHDNBISArchive]Item9;1)  `Added 3/6/98 by Tom Nee.$Item10:=String([BridgeMHDNBISArchive]Item10*100;"0000")$Item11:=String([BridgeMHDNBISArchive]Item11*1000;"0000000")If ([BridgeMHDNBISArchive]Item12=True)$Item12:="1"Else $Item12:="0"End if $Item13:=" "*12  `Added 3/10/98 by Tom Nee.$Item13:=Change string($Item13;[BridgeMHDNBISArchive]Item 13A;11-Length([BridgeMHDNBISArchive]Item 13A))  `Right justified, 10 chars.$Item13:=Change string($Item13;[BridgeMHDNBISArchive]Item 13B;13-Length([BridgeMHDNBISArchive]Item 13B))  `Right justified, 2 chars.$Item16:=String([BridgeMHDNBISArchive]Item16A;"00")+String([BridgeMHDNBISArchive]Item16B;"00")+String([BridgeMHDNBISArchive]Item16C*100;"0000")$Item17:=String([BridgeMHDNBISArchive]Item17A;"000")+String([BridgeMHDNBISArchive]Item17B;"00")+String([BridgeMHDNBISArchive]Item17C*100;"0000")$Item19:=String([BridgeMHDNBISArchive]Item19;"000")$Item27:=String([BridgeMHDNBISArchive]Item27;"0000")$Item28:=String([BridgeMHDNBISArchive]Item28A;"00")+String([BridgeMHDNBISArchive]Item28B;"00")$Item29:=String([BridgeMHDNBISArchive]Item29;"000000")$Item30:=String([BridgeMHDNBISArchive]Item30;"0000")$Item32:=String([BridgeMHDNBISArchive]Item32*10;"0000")$Item34:=String([BridgeMHDNBISArchive]Item34;"00")If ([BridgeMHDNBISArchive]Item35=True)$Item35:="1"Else $Item35:="0"End if   `These four lines are now in  HistoricalTrans.  TDN 12/24/98.       `      $Item37:=$Item37FHWA≤Position([BridgeMHDNBISArchive]Item37;$Item37code)≥  `      If (Position($Item37;$Item37FHWA)<1)  `        $Item37:="4"  `      End if $Item37:=HistoricalTrans ([BridgeMHDNBISArchive]Item37)$Item39:=String([BridgeMHDNBISArchive]Item39*10;"0000")$Item40:=String([BridgeMHDNBISArchive]Item40*10;"00000")$Item44:=" "*3$Item44:=Change string($Item44;[BridgeMHDNBISArchive]Item44;1)  `Added 3/10/98 by Tom Nee.$Item45:=String([BridgeMHDNBISArchive]Item45;"000")$Item46:=String([BridgeMHDNBISArchive]Item46;"0000")$Item47:=String([BridgeMHDNBISArchive]Item47*10;"000")$Item48:=String([BridgeMHDNBISArchive]Item48*10;"00000")  `3/21/01 Rounding before truncating  `$Item49:=String([BridgeMHDNBISArchive]Item49*10;"000000")$Item49:=String(Round([BridgeMHDNBISArchive]Item49;1)*10;"000000")  `End of change$Item50:=String([BridgeMHDNBISArchive]Item50A*10;"000")+String([BridgeMHDNBISArchive]Item50B*10;"000")  `3/21/01 Rounding before truncating  `$Item51:=String([BridgeMHDNBISArchive]Item51*10;"0000")$Item51:=String(Round([BridgeMHDNBISArchive]Item51;1)*10;"0000")  ` End of change$Item52:=String([BridgeMHDNBISArchive]Item52*10;"0000")$Item53:=String([BridgeMHDNBISArchive]Item53*100;"0000")$Item54:=" "$Item54:=Change string($Item54;[BridgeMHDNBISArchive]Item54A;1)$Item54:=$Item54+String([BridgeMHDNBISArchive]Item54B*100;"0000")$Item55:=" "$Item55:=Change string($Item55;[BridgeMHDNBISArchive]Item55A;1)$Item55:=$Item55+String([BridgeMHDNBISArchive]Item55B*10;"000")$Item56:=String([BridgeMHDNBISArchive]Item56*10;"000")$Item63:=" "$Item63:=Change string($Item63;[BridgeMHDNBISArchive]Item 63;1)If (Position($Item63;"-6-7-8-")>0)$Item64:=String([BridgeMHDNBISArchive]Item64*100;"000")Else $Item64:=String([BridgeMHDNBISArchive]Item64*10;"000")End if $Item65:=" "$Item65:=Change string($Item65;[BridgeMHDNBISArchive]Item 65;1)If (Position($Item65;"-6-7-8-")>0)$Item66:=String([BridgeMHDNBISArchive]Item66*100;"000")Else $Item66:=String([BridgeMHDNBISArchive]Item66*10;"000")End if $Item75:=" "*3  `Added 3/10/98 by Tom Nee.$Item75:=Change string($Item75;[BridgeMHDNBISArchive]Item75A;1)$Item75:=Change string($Item75;[BridgeMHDNBISArchive]Item75B;3)$Item76:=String([BridgeMHDNBISArchive]Item76*10;"000000")$m:=Month of([BridgeMHDNBISArchive]Item90)$y:=Year of([BridgeMHDNBISArchive]Item90)If ($y>1999)$y:=$y-2000Else $y:=$y-1900End if $Item90:=String($m;"00")+String($y;"00")$Item91:=String([BridgeMHDNBISArchive]Item91;"00")$Item92:=""If ([BridgeMHDNBISArchive]Item92AA=True)If (($igItem92a=True) & ([BridgeMHDNBISArchive]Item92AB>24))$crit:="Y24"Else $crit:="Y"+String([BridgeMHDNBISArchive]Item92AB;"00")End if $m:=Month of([BridgeMHDNBISArchive]Item93A)$y:=Year of([BridgeMHDNBISArchive]Item93A)Case of : ($y>1999)$y:=$y-2000$Item93A:=String($m;"00")+String($y;"00"): ($y>1900)$y:=$y-1900$Item93A:=String($m;"00")+String($y;"00"): ($y=0)$Item93A:=" "*4End case Else $crit:="N  "$Item93A:="    "End if $Item92:=$critIf ([BridgeMHDNBISArchive]Item92BA=True)$crit:="Y"+String([BridgeMHDNBISArchive]Item92BB;"00")$m:=Month of([BridgeMHDNBISArchive]Item93B)$y:=Year of([BridgeMHDNBISArchive]Item93B)Case of : ($y>1999)$y:=$y-2000$Item93B:=String($m;"00")+String($y;"00"): ($y>1900)$y:=$y-1900$Item93B:=String($m;"00")+String($y;"00"): ($y=0)$Item93B:=" "*4End case Else $crit:="N  "$Item93B:="    "End if $Item92:=$Item92+$critIf ([BridgeMHDNBISArchive]Item92CA=True)$crit:="Y"+String([BridgeMHDNBISArchive]Item92CB;"00")$m:=Month of([BridgeMHDNBISArchive]Item93C)$y:=Year of([BridgeMHDNBISArchive]Item93C)Case of : ($y>1999)$y:=$y-2000$Item93C:=String($m;"00")+String($y;"00"): ($y>1900)$y:=$y-1900$Item93C:=String($m;"00")+String($y;"00"): ($y=0)$Item93C:=" "*4End case Else $crit:="N  "$Item93C:="    "End if $Item92:=$Item92+$crit$Item94:=String([BridgeMHDNBISArchive]Item94;"000000")$Item95:=String([BridgeMHDNBISArchive]Item95;"000000")$Item96:=String([BridgeMHDNBISArchive]Item96;"000000")$Item97:=String([BridgeMHDNBISArchive]Item97;"0000")If (($igItem97=True) & ($Item97="0000"))$Item97:=String(Year of(Current date(*));"0000")End if If ([BridgeMHDNBISArchive]Item103=True)$Item103:="T"Else $Item103:=" "End if If ([BridgeMHDNBISArchive]Item104=True)$Item104:="1"Else $Item104:="0"End if $Item105:=" "  `Added 3/10/98 by Tom Nee.$Item105:=Change string($Item105;[BridgeMHDNBISArchive]Item 105;1)$Item106:=String([BridgeMHDNBISArchive]Item106;"0000")$Item109:=String([BridgeMHDNBISArchive]Item109;"00")If ([BridgeMHDNBISArchive]Item110=True)$Item110:="1"Else $Item110:="0"End if $Item111:=" "  `Added 3/10/98 by Tom Nee.$Item111:=Change string($Item111;[BridgeMHDNBISArchive]Item111;1)If ([BridgeMHDNBISArchive]Item112=True)$Item112:="Y"Else $Item112:="N"End if $Item113:=[BridgeMHDNBISArchive]Item113If ($Item113="D")$Item113:="6"End if $Item114:=String([BridgeMHDNBISArchive]Item114;"000000")$Item115:=String([BridgeMHDNBISArchive]Item115;"0000")$Item116:=String([BridgeMHDNBISArchive]Item116*10;"0000")C_TEXT($item8_txt)$item8_txt:=[BridgeMHDNBISArchive]Item8If ([BridgeMHDNBISArchive]FHWAItem8#"")$item8_txt:=[BridgeMHDNBISArchive]FHWAItem8End if $t:="251"+$item8_txt+[BridgeMHDNBISArchive]Item5+[BridgeMHDNBISArchive]Item2$t:=$t+[BridgeMHDNBISArchive]Item3+[BridgeMHDNBISArchive]Item4+$Item6A+$Item6B+$Item7$t:=$t+$Item9+$Item10+$Item11+$Item12+$Item13$t:=$t+$Item16+$Item17+$Item19+[BridgeMHDNBISArchive]Item20+[BridgeMHDNBISArchive]Item21+[BridgeMHDNBISArchive]Item22$t:=$t+[BridgeMHDNBISArchive]Item26+$Item27+$Item28+$Item29+$Item30+SIA_DesignLoadTrans ([BridgeMHDNBISArchive]Item31)+$Item32$t:=$t+[BridgeMHDNBISArchive]Item33+$Item34+$Item35+[BridgeMHDNBISArchive]Item36A+[BridgeMHDNBISArchive]Item36B+[BridgeMHDNBISArchive]Item36C+[BridgeMHDNBISArchive]Item36D$t:=$t+$Item37+[BridgeMHDNBISArchive]Item38+$Item39+$Item40+[BridgeMHDNBISArchive]Item41+[BridgeMHDNBISArchive]Item42$t:=$t+[BridgeMHDNBISArchive]Item43+$Item44+$Item45+$Item46+$Item47+$Item48+$Item49$t:=$t+$Item50+$Item51+$Item52+$Item53+$Item54+$Item55+$Item56+[BridgeMHDNBISArchive]Item58+[BridgeMHDNBISArchive]Item59$t:=$t+[BridgeMHDNBISArchive]Item60+[BridgeMHDNBISArchive]Item61+[BridgeMHDNBISArchive]Item62+$Item63+$Item64$t:=$t+$Item65+$Item66+[BridgeMHDNBISArchive]Item67+[BridgeMHDNBISArchive]Item68$t:=$t+[BridgeMHDNBISArchive]Item69+[BridgeMHDNBISArchive]Item70+[BridgeMHDNBISArchive]Item71+[BridgeMHDNBISArchive]Item72$t:=$t+$Item75+$Item76+$Item90+$Item91+$Item92+$Item93A+$Item93B+$Item93C$t:=$t+$Item94+$Item95+$Item96+$Item97+[BridgeMHDNBISArchive]Item98A+[BridgeMHDNBISArchive]Item98B+[BridgeMHDNBISArchive]Item99$t:=$t+[BridgeMHDNBISArchive]Item100+[BridgeMHDNBISArchive]Item101+[BridgeMHDNBISArchive]Item102+$Item103+$Item104+$Item105$t:=$t+$Item106+[BridgeMHDNBISArchive]Item107+[BridgeMHDNBISArchive]Item108A+[BridgeMHDNBISArchive]Item108B+[BridgeMHDNBISArchive]Item108C$t:=$t+$Item109+$Item110+$Item111+$Item112+$Item113+$Item114+$Item115+$Item116+$fill+◊sCR+◊sLFIf (Length($t)#434)  `Includes CR and LF  ` Do some checks for data length and write any errors to the error file$et:=""If (Length([BridgeMHDNBISArchive]Item5)<9)$et:=$et+"5 < 9 : -"+[BridgeMHDNBISArchive]Item5+"-"+◊sCR+◊sLFEnd if If (Length($Item9)<25)$et:=$et+"9 : blank : -"+[BridgeMHDNBISArchive]Item9+"-"+◊sCR+◊sLFEnd if If (Length([BridgeMHDNBISArchive]Item20)<1)$et:=$et+"20 < 1 : -"+[BridgeMHDNBISArchive]Item20+"-"+◊sCR+◊sLFEnd if If (Length([BridgeMHDNBISArchive]Item21)<2)$et:=$et+"21 < 2 : -"+[BridgeMHDNBISArchive]Item21+"-"+◊sCR+◊sLFEnd if If (Length([BridgeMHDNBISArchive]Item22)<2)$et:=$et+"22 < 2 : -"+[BridgeMHDNBISArchive]Item22+"-"+◊sCR+◊sLFEnd if If (Length([BridgeMHDNBISArchive]Item26)<2)$et:=$et+"26 < 2 : -"+[BridgeMHDNBISArchive]Item26+"-"+◊sCR+◊sLFEnd if If (Length([BridgeMHDNBISArchive]Item31)<1)$et:=$et+"31 < 1 : -"+[BridgeMHDNBISArchive]Item31+"-"+◊sCR+◊sLFEnd if If (Length([BridgeMHDNBISArchive]Item33)<1)$et:=$et+"33 < 1 : -"+[BridgeMHDNBISArchive]Item33+"-"+◊sCR+◊sLFEnd if If (Length([BridgeMHDNBISArchive]Item36A)<1)$et:=$et+"36A < 1 : -"+[BridgeMHDNBISArchive]Item36A+"-"+◊sCR+◊sLFEnd if If (Length([BridgeMHDNBISArchive]Item36B)<1)$et:=$et+"36B < 1 : -"+[BridgeMHDNBISArchive]Item36B+"-"+◊sCR+◊sLFEnd if If (Length([BridgeMHDNBISArchive]Item36C)<1)$et:=$et+"36C < 1 : -"+[BridgeMHDNBISArchive]Item36C+"-"+◊sCR+◊sLFEnd if If (Length([BridgeMHDNBISArchive]Item36D)<1)$et:=$et+"36D < 1 : -"+[BridgeMHDNBISArchive]Item36D+"-"+◊sCR+◊sLFEnd if If (Length([BridgeMHDNBISArchive]Item38)<1)$et:=$et+"38 < 1 : -"+[BridgeMHDNBISArchive]Item38+"-"+◊sCR+◊sLFEnd if If (Length([BridgeMHDNBISArchive]Item41)<1)$et:=$et+"41 < 1 : -"+[BridgeMHDNBISArchive]Item41+"-"+◊sCR+◊sLFEnd if If (Length([BridgeMHDNBISArchive]Item42)<2)$et:=$et+"42 < 2 : -"+[BridgeMHDNBISArchive]Item42+"-"+◊sCR+◊sLFEnd if If (Length([BridgeMHDNBISArchive]Item43)<3)$et:=$et+"43 < 3 : -"+[BridgeMHDNBISArchive]Item43+"-"+◊sCR+◊sLFEnd if If (Length($Item54)<5)$et:=$et+"54 < 5 : -"+$Item54+"-"+◊sCR+◊sLFEnd if If (Length($Item55)<4)$et:=$et+"55 < 4 : -"+$Item55+"-"+◊sCR+◊sLFEnd if If (Length([BridgeMHDNBISArchive]Item58)<1)$et:=$et+"58 < 1 : -"+[BridgeMHDNBISArchive]Item58+"-"+◊sCR+◊sLFEnd if If (Length([BridgeMHDNBISArchive]Item59)<1)$et:=$et+"59 < 1 : -"+[BridgeMHDNBISArchive]Item59+"-"+◊sCR+◊sLFEnd if If (Length([BridgeMHDNBISArchive]Item60)<1)$et:=$et+"60 < 1 : -"+[BridgeMHDNBISArchive]Item60+"-"+◊sCR+◊sLFEnd if If (Length([BridgeMHDNBISArchive]Item61)<1)$et:=$et+"61 < 1 : -"+[BridgeMHDNBISArchive]Item61+"-"+◊sCR+◊sLFEnd if If (Length([BridgeMHDNBISArchive]Item62)<1)$et:=$et+"62 < 1 : -"+[BridgeMHDNBISArchive]Item62+"-"+◊sCR+◊sLFEnd if If (Length([BridgeMHDNBISArchive]Item71)<1)$et:=$et+"71 < 1 : -"+[BridgeMHDNBISArchive]Item71+"-"+◊sCR+◊sLFEnd if If (Length([BridgeMHDNBISArchive]Item72)<1)$et:=$et+"72 < 1 : -"+[BridgeMHDNBISArchive]Item72+"-"+◊sCR+◊sLFEnd if If (Length([BridgeMHDNBISArchive]Item98A)<3)$et:=$et+"98A < 3 : -"+[BridgeMHDNBISArchive]Item98A+"-"+◊sCR+◊sLFEnd if If (Length([BridgeMHDNBISArchive]Item98B)<2)$et:=$et+"98b < 2 : -"+[BridgeMHDNBISArchive]Item98B+"-"+◊sCR+◊sLFEnd if If (Length([BridgeMHDNBISArchive]Item99)<15)$et:=$et+"99 < 15 : -"+[BridgeMHDNBISArchive]Item99+"-"+◊sCR+◊sLFEnd if If (Length([BridgeMHDNBISArchive]Item100)<1)$et:=$et+"100 < 1 : -"+[BridgeMHDNBISArchive]Item100+"-"+◊sCR+◊sLFEnd if If (Length([BridgeMHDNBISArchive]Item101)<1)$et:=$et+"101 < 1 : -"+[BridgeMHDNBISArchive]Item101+"-"+◊sCR+◊sLFEnd if If (Length([BridgeMHDNBISArchive]Item102)<1)$et:=$et+"102 < 1 : -"+[BridgeMHDNBISArchive]Item102+"-"+◊sCR+◊sLFEnd if If (Length([BridgeMHDNBISArchive]Item107)<1)$et:=$et+"107 < 1 : -"+[BridgeMHDNBISArchive]Item107+"-"+◊sCR+◊sLFEnd if If (Length([BridgeMHDNBISArchive]Item108A)<1)$et:=$et+"108A < 1 : -"+[BridgeMHDNBISArchive]Item108A+"-"+◊sCR+◊sLFEnd if If (Length([BridgeMHDNBISArchive]Item108B)<1)$et:=$et+"108B < 1 : -"+[BridgeMHDNBISArchive]Item108B+"-"+◊sCR+◊sLFEnd if If (Length([BridgeMHDNBISArchive]Item108C)<1)$et:=$et+"108C < 1 : -"+[BridgeMHDNBISArchive]Item108C+"-"+◊sCR+◊sLFEnd if If (Length($Item113)<1)$et:=$et+"113 < 1 : -"+$Item113+"-"+◊sCR+◊sLFEnd if If ($et#"")SEND PACKET($dErrFile;("Item Length Errors found for BIN : "+[BridgeMHDNBISArchive]BIN+◊sCR+◊sLF))SEND PACKET($dErrFile;("(Item) < (Required Length) : -(Actual Item Value)- "+◊sCR+◊sLF))SEND PACKET($dErrFile;$et)End if SEND PACKET($dErrFile;$t)$l:=$l+1Else SEND PACKET($dExportFile;$t)$k:=$k+1End if   `Check to see if there is a secondary recordQUERY([NBISSecondaryArchive];[NBISSecondaryArchive]ArchiveReason_s=[BridgeMHDNBISArchive]ArchiveReason_s;*)QUERY([NBISSecondaryArchive]; & ;[NBISSecondaryArchive]ArchiveDate_d=[BridgeMHDNBISArchive]ArchiveDate_d)QUERY SELECTION([NBISSecondaryArchive];[NBISSecondaryArchive]BIN=[BridgeMHDNBISArchive]BIN)FIRST RECORD([NBISSecondaryArchive])For ($j;1;Records in selection([NBISSecondaryArchive]))$Item6A:=" "*24$Item6A:=Change string($Item6A;[NBISSecondaryArchive]Item6A;1)If ([NBISSecondaryArchive]Item6B=True)$Item6B:="*"Else $Item6B:=" "End if $Item7:=" "*18$Item7:=Change string($Item7;[NBISSecondaryArchive]Item7;1)$Item9:=" "*25$Item9:=Change string($Item9;[NBISSecondaryArchive]Item9;1)$Item10:=String([NBISSecondaryArchive]Item10*100;"0000")$Item11:=String([NBISSecondaryArchive]Item11*1000;"0000000")$Item16:=String([NBISSecondaryArchive]Item16A;"00")+String([NBISSecondaryArchive]Item16B;"00")+String([NBISSecondaryArchive]Item16C*100;"0000")$Item17:=String([NBISSecondaryArchive]Item17A;"000")+String([NBISSecondaryArchive]Item17B;"00")+String([NBISSecondaryArchive]Item17C*100;"0000")$Item19:=String([NBISSecondaryArchive]Item19;"000")$Item27:=String([NBISSecondaryArchive]Item27;"0000")$Item28:=String([NBISSecondaryArchive]Item28A;"00")+String([NBISSecondaryArchive]Item28B;"00")$Item29:=String([NBISSecondaryArchive]Item29;"000000")$Item30:=String([NBISSecondaryArchive]Item30;"0000")$Item47:=String([NBISSecondaryArchive]Item47*10;"000")$Item48:=String([NBISSecondaryArchive]Item48*10;"00000")$Item49:=String([NBISSecondaryArchive]Item49*10;"000000")If ([NBISSecondaryArchive]Item103=True)$Item103:="T"Else $Item103:=" "End if If ([NBISSecondaryArchive]Item104=True)$Item104:="1"Else $Item104:="0"End if $Item109:=String([NBISSecondaryArchive]Item109;"00")If ([NBISSecondaryArchive]Item110=True)$Item110:="1"Else $Item110:="0"End if $t:="251"+[BridgeMHDNBISArchive]Item8+[NBISSecondaryArchive]Item5+(" "*2)$t:=$t+[NBISSecondaryArchive]Item3+[NBISSecondaryArchive]Item4+$Item6A+$Item6B+$Item7$t:=$t+$Item9+$Item10+$Item11+(" "*13)$t:=$t+$Item16+$Item17+$Item19+[NBISSecondaryArchive]Item20+(" "*4)$t:=$t+[NBISSecondaryArchive]Item26+$Item27+$Item28+$Item29+$Item30+(" "*5)$t:=$t+(" "*8)$t:=$t+(" "*12)+[NBISSecondaryArchive]Item42$t:=$t+[NBISSecondaryArchive]Item43+(" "*10)+$Item47+$Item48+$Item49$t:=$t+(" "*127)$t:=$t+[NBISSecondaryArchive]Item100+[NBISSecondaryArchive]Item101+[NBISSecondaryArchive]Item102+$Item103+$Item104$t:=$t+(" "*9)$t:=$t+$Item109+$Item110+(" "*17)+$fill+◊sCR+◊sLFIf (Length($t)#434)  `Includes CR and LF  ` ALERT("Data length not 434 for BIN Secondary Record "+[NBISSecondaryArchive]BIN+  `" (="+String(Length($t))+")."+(2*◊sCR)+"Export aborted.")  ` UNLOAD RECORD([NBISSecondaryArchive])  `CLOSE DOCUMENT($dExportFile)  ` Do some data checks and export error message to error file.    $et:=""If (Length([NBISSecondaryArchive]Item20)<1)$et:=$et+"20 < 1 : -"+[NBISSecondaryArchive]Item20+"-"+◊sCR+◊sLFEnd if If (Length([NBISSecondaryArchive]Item26)<2)$et:=$et+"26 < 2 : -"+[NBISSecondaryArchive]Item26+"-"+◊sCR+◊sLFEnd if If (Length([NBISSecondaryArchive]Item42)<2)$et:=$et+"42 < 2 : -"+[NBISSecondaryArchive]Item42+"-"+◊sCR+◊sLFEnd if If (Length([NBISSecondaryArchive]Item43)<3)$et:=$et+"43 < 3 : -"+[NBISSecondaryArchive]Item43+"-"+◊sCR+◊sLFEnd if If (Length([NBISSecondaryArchive]Item100)<1)$et:=$et+"100 < 1 : -"+[NBISSecondaryArchive]Item100+"-"+◊sCR+◊sLFEnd if If (Length([NBISSecondaryArchive]Item101)<1)$et:=$et+"101 < 1 : -"+[NBISSecondaryArchive]Item101+"-"+◊sCR+◊sLFEnd if If (Length([NBISSecondaryArchive]Item102)<1)$et:=$et+"102 < 1 : -"+[NBISSecondaryArchive]Item102+"-"+◊sCR+◊sLFEnd if If ($et#"")SEND PACKET($dErrFile;("Errors found for Secondary BIN : "+[BridgeMHDNBISArchive]BIN+◊sCR+◊sLF))SEND PACKET($dErrFile;$et)End if SEND PACKET($dErrFile;$t)$l:=$l+1  `ABORTElse SEND PACKET($dExportFile;$t)$k:=$k+1End if NEXT RECORD([NBISSecondaryArchive])End for NEXT RECORD([BridgeMHDNBISArchive])If ($k%$Interval=0)  `Don't slow down things just to displayUpdateProgress ($i;$Recs)End if   ` check to see if aborted from the Progress windowIf (◊Abort)$i:=$Recs+1End if End for CALL PROCESS(◊ProgressPID)CLOSE DOCUMENT($dExportFile)CLOSE DOCUMENT($dErrFile)ALERT(String($k;"##,##0")+" total records (primary & secondary) exported successfully to "+$vsOutputFolder+$NBfile)If ($l>0)ALERT(String($l;"##,##0")+" total records (primary & secondary) with errors placed in "+$vsOutputFolder+$NBErrfile)ut_OpenDocument ($vsOutputFolder+$NBErrfile)End if End if End if   `NO TRACE3  `End ARCHIVE_ExportNBI