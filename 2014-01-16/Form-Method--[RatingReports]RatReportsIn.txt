If (False)ÊÊ`LO: [RatingReports];"RatReportsIn"ÊÊ`ÊÊ` Modified 23-10-2000 :ÊÊ`       Update Inv and Oper Loads in the Bridge MHD NBIS tableÊÊ` Apr-2002 : ÊÊ`     Add code to alow transfer of rating report data to districts.ÊÊ` Modified by: costasmanousakis-(Designer)-(4/20/2006 09:15:29)Mods_2006_CM04 ÊÊ` Modified by: costasmanousakis-(Designer)-(8/17/10 13:48:35)Mods_2010_08 ÊÊ`ÊÊ`ignore Operating Ratings for Masonrty Arch-DeckÊÊ` Modified by: costasmanousakis-(Designer)-(9/1/10 12:13:46)Mods_2010_09 ÊÊ`ÊÊ`Added Recording of Items 67.68.69.70 when changed by the AASHTO_SuffRat methodÊÊ` Modified by: costasmanousakis-(Designer)-(10/6/10 12:35:08)Mods_2010_10 ÊÊ`ÊÊ`Made sure to check if any of the [bridge mhd nbis] fields have been modified already beforeÊÊ`ÊÊ`the on validate event and add them to the message displayMods_2011_06 ÊÊ` CJ Miller`06/20/11, 11:13:07      ` Type all local variables for v11ÊÊ` Modified by: costasmanousakis-(Designer)-(9/22/11 16:19:07)Mods_2011_09 ÊÊ`ÊÊ`modified form to allow horizontal growth for the rating member include form.Mods_2012_03 ÊÊ`r003 Load record interactiveÊÊ`Modified by: Charles Miller (3/27/12 11:55:46)ÊÊ` Modified by: Costas Manousakis-(Designer)-(5/20/13 14:48:31)Mods_2013_05 ÊÊ`ÊÊ`move  popup menu outside if (load) statementÊÊ` Modified by: Costas Manousakis-(Designer)-(1/16/14 15:44:10)Mods_2014_01 ÊÊ`ÊÊ`Added query on [RatingMember] at the on load eventEnd if Case of : (Form event=On Close Detail )RELATE MANY([RatingReports])If (User in group(Current user;"Ratings and Overloads"))ENABLE BUTTON(*;"DeleteRatingBtn")ENABLE BUTTON(*;"RatMb@")Else DISABLE BUTTON(*;"DeleteRatingBtn")DISABLE BUTTON(*;"RatMb@")End if : (Form event=On Load )If (ut_LoadRecordInteractive (->[Bridge MHD NBIS]))C_BOOLEAN(vbForce0;vbNewRating)If (User in group(Current user;"Ratings and Overloads"))ENABLE BUTTON(*;"DeleteRatingBtn")ENABLE BUTTON(*;"RatMb@")Else DISABLE BUTTON(*;"DeleteRatingBtn")DISABLE BUTTON(*;"RatMb@")End if vbForce0:=FalsevbNewRating:=FalseÊÊ`## Initialize transfer dataInitChangeStack (1)ÊÊ`for the Bridge MHD NBIS dataInitChangeStack (2)ÊÊ`for the rating report itselfIf ([RatingReports]RatingID=0)ÊÊ`This is a new recordIf (User in group(Current user;"Ratings and Overloads"))vbNewRating:=True[RatingReports]BIN:=[Bridge MHD NBIS]BINInc_Sequence ("RatingReports";->[RatingReports]RatingID)LogNewRecord (->[Bridge MHD NBIS]BIN;->[RatingReports]BIN;->[RatingReports]RatingID;1;"RatingReports")SAVE RECORD([RatingReports])[RatingReports]Item58:=[Bridge MHD NBIS]Item58[RatingReports]Item59:=[Bridge MHD NBIS]Item59[RatingReports]Item64:=[Bridge MHD NBIS]Item64[RatingReports]Item66:=[Bridge MHD NBIS]Item66[RatingReports]Item63:=[Bridge MHD NBIS]Item 63[RatingReports]Item65:=[Bridge MHD NBIS]Item 65[RatingReports]Item43inRating:=[Bridge MHD NBIS]Item43PushChange (2;->[RatingReports]Item58)PushChange (2;->[RatingReports]Item59)PushChange (2;->[RatingReports]Item64)PushChange (2;->[RatingReports]Item66)PushChange (2;->[RatingReports]Item63)PushChange (2;->[RatingReports]Item65)PushChange (2;->[RatingReports]Item43inRating)Else CANCELÊÊ`Don't allow others to create new recordEnd if End if Else End if item43a:=Substring([RatingReports]Item43inRating;1;1)POPUPMENUC (->aItem43aDes;->aItem43a;->item43a)item43b:=Substring([RatingReports]Item43inRating;2;2)POPUPMENUC (->aItem43bDes;->aItem43b;->item43b)C_STRING(8;vsInvRtgUnit)C_STRING(8;vsOprRtgUnit)RtgMethod_OM (Form event;->aIRatMethD_;->aIRatMeth_;->[RatingReports]Item65;->[Bridge MHD NBIS]Item 65;->[RatingReports]Item66;->vsInvRtgUnit)RtgMethod_OM (Form event;->aORatMethD_;->aORatMeth_;->[RatingReports]Item63;->[Bridge MHD NBIS]Item 63;->[RatingReports]Item64;->vsOprRtgUnit)QUERY([RatingMember];[RatingMember]RatingID=[RatingReports]RatingID): (Form event=On Validate )ÊÊ`##Save changes made to tableIf ([RatingReports]Item43inRating#"811")ÊÊ`ignore Operating Ratings for Masonrty Arch-DeckIf (([RatingReports]Item64=0)Ê&Ê(vbForce0=False))Case of : ([RatingReports]OprMS18#0)[RatingReports]Item64:=[RatingReports]OprMS18[RatingReports]Item63:="1"PushChange (2;->[RatingReports]Item64)PushChange (2;->[RatingReports]Item63): ([RatingReports]OprHS2044#0)[RatingReports]Item64:=[RatingReports]OprHS2044*0.9[RatingReports]Item63:="2"PushChange (2;->[RatingReports]Item64)PushChange (2;->[RatingReports]Item63): (([RatingReports]OprHS2044=0)Ê&Ê([RatingReports]OprMS18=0))C_REAL($max)$max:=MaxNum ([RatingReports]OprH20;[RatingReports]OprType3;[RatingReports]Opr3S2)Case of : ($max=[RatingReports]OprH20)[RatingReports]Item64:=$max*1.25*0.9: ($max=[RatingReports]OprType3)[RatingReports]Item64:=$max*1*0.9: ($max=[RatingReports]Opr3S2)[RatingReports]Item64:=$max*0.7*0.9End case [RatingReports]Item63:="2"PushChange (2;->[RatingReports]Item64)PushChange (2;->[RatingReports]Item63)End case End if End if If (([RatingReports]Item66=0)Ê&Ê(vbForce0=False))Case of : ([RatingReports]InvMS18#0)[RatingReports]Item66:=[RatingReports]InvMS18[RatingReports]Item65:="1"PushChange (2;->[RatingReports]Item66)PushChange (2;->[RatingReports]Item65): ([RatingReports]InvHS2044#0)[RatingReports]Item66:=[RatingReports]InvHS2044*0.9[RatingReports]Item65:="2"PushChange (2;->[RatingReports]Item66)PushChange (2;->[RatingReports]Item65): (([RatingReports]InvHS2044=0)Ê&Ê([RatingReports]InvMS18=0))$max:=MaxNum ([RatingReports]InvH20;[RatingReports]InvType3;[RatingReports]Inv3S2)Case of : ($max=[RatingReports]InvH20)[RatingReports]Item66:=$max*1.25*0.9: ($max=[RatingReports]InvType3)[RatingReports]Item66:=$max*1*0.9: ($max=[RatingReports]Inv3S2)[RatingReports]Item66:=$max*0.7*0.9End case [RatingReports]Item65:="2"PushChange (2;->[RatingReports]Item66)PushChange (2;->[RatingReports]Item65)End case End if FlushGrpChgs (2;->[Bridge MHD NBIS]BIN;->[RatingReports]BIN;->[RatingReports]RatingID;1)SAVE RECORD([RatingReports])ÊÊ`AASHTO Suff calc destroys changesC_TEXT($MysMsg)C_REAL($vrMax)C_BOOLEAN($vbForceupd)$vbForceupd:=False$MysMsg:=""ÊÊ`     **** added minimum to avoid loading more than 99.9 values$vrMax:=Round(MinNum ([RatingReports]Item64;99.9);1)ÊÊ`$vbForceupd:=(Size of array(ptr_changes{1})>0)If (([Bridge MHD NBIS]Item64#$vrMax)Ê|Ê$vbForceupdÊ|Ê([Bridge MHD NBIS]Item64#Old([Bridge MHD NBIS]Item64)))[Bridge MHD NBIS]Item64:=$vrMaxPushChange (1;->[Bridge MHD NBIS]Item64)$MysMsg:=$MysMsg+"Item 64 = "+String([Bridge MHD NBIS]Item64;"##.#;-##.#;0")+×sCREnd if If (([Bridge MHD NBIS]Item 63#[RatingReports]Item63)Ê|Ê$vbForceupdÊ|Ê([Bridge MHD NBIS]Item 63#Old([Bridge MHD NBIS]Item 63)))[Bridge MHD NBIS]Item 63:=[RatingReports]Item63PushChange (1;->[Bridge MHD NBIS]Item 63)$MysMsg:=$MysMsg+"Item 63 = "+[Bridge MHD NBIS]Item 63+×sCREnd if $vrMax:=Round(MinNum ([RatingReports]Item66;99.9);1)If (([Bridge MHD NBIS]Item66#$vrMax)Ê|Ê$vbForceupdÊ|Ê([Bridge MHD NBIS]Item66#Old([Bridge MHD NBIS]Item66)))[Bridge MHD NBIS]Item66:=$vrMaxPushChange (1;->[Bridge MHD NBIS]Item66)$MysMsg:=$MysMsg+"Item 66 = "+String([Bridge MHD NBIS]Item66;"##.#;-##.#;0")+×sCREnd if If (([Bridge MHD NBIS]Item 65#[RatingReports]Item65)Ê|Ê$vbForceupdÊ|Ê([Bridge MHD NBIS]Item 65#Old([Bridge MHD NBIS]Item 65)))[Bridge MHD NBIS]Item 65:=[RatingReports]Item65PushChange (1;->[Bridge MHD NBIS]Item 65)$MysMsg:=$MysMsg+"Item 65 = "+[Bridge MHD NBIS]Item 65+×sCREnd if ÊÊ`     **** start of 23-10-2000 modificationsÊÊ`           convert to Integer as needed    $vrMax:=G_RatingV2NBI ([RatingReports]OprH20)If (([Bridge MHD NBIS]OprH20#$vrMax)Ê|Ê$vbForceupdÊ|Ê([Bridge MHD NBIS]OprH20#Old([Bridge MHD NBIS]OprH20)))[Bridge MHD NBIS]OprH20:=$vrMaxPushChange (1;->[Bridge MHD NBIS]OprH20)$MysMsg:=$MysMsg+"OprH20 = "+String([Bridge MHD NBIS]OprH20)+×sCREnd if $vrMax:=G_RatingV2NBI ([RatingReports]OprType3)If (([Bridge MHD NBIS]OprType3#$vrMax)Ê|Ê$vbForceupdÊ|Ê([Bridge MHD NBIS]OprType3#Old([Bridge MHD NBIS]OprType3)))[Bridge MHD NBIS]OprType3:=$vrMaxPushChange (1;->[Bridge MHD NBIS]OprType3)$MysMsg:=$MysMsg+"OprType3 = "+String([Bridge MHD NBIS]OprType3)+×sCREnd if $vrMax:=G_RatingV2NBI ([RatingReports]Opr3S2)If (([Bridge MHD NBIS]Opr3S2#$vrMax)Ê|Ê$vbForceupdÊ|Ê([Bridge MHD NBIS]Opr3S2#Old([Bridge MHD NBIS]Opr3S2)))[Bridge MHD NBIS]Opr3S2:=$vrMaxPushChange (1;->[Bridge MHD NBIS]Opr3S2)$MysMsg:=$MysMsg+"Opr3S2 = "+String([Bridge MHD NBIS]Opr3S2)+×sCREnd if $vrMax:=G_RatingV2NBI ([RatingReports]OprHS2044)If (([Bridge MHD NBIS]OprHS#$vrMax)Ê|Ê$vbForceupdÊ|Ê([Bridge MHD NBIS]OprHS#Old([Bridge MHD NBIS]OprHS)))[Bridge MHD NBIS]OprHS:=$vrMaxPushChange (1;->[Bridge MHD NBIS]OprHS)$MysMsg:=$MysMsg+"OprHS = "+String([Bridge MHD NBIS]OprHS)+×sCREnd if $vrMax:=G_RatingV2NBI ([RatingReports]OprMS18)If (([Bridge MHD NBIS]OprMS#$vrMax)Ê|Ê$vbForceupdÊ|Ê([Bridge MHD NBIS]OprMS#Old([Bridge MHD NBIS]OprMS)))[Bridge MHD NBIS]OprMS:=$vrMaxPushChange (1;->[Bridge MHD NBIS]OprMS)$MysMsg:=$MysMsg+"OprMS = "+String([Bridge MHD NBIS]OprMS)+×sCREnd if $vrMax:=G_RatingV2NBI ([RatingReports]InvH20)If (([Bridge MHD NBIS]InvH20#$vrMax)Ê|Ê$vbForceupdÊ|Ê([Bridge MHD NBIS]InvH20#Old([Bridge MHD NBIS]InvH20)))[Bridge MHD NBIS]InvH20:=$vrMaxPushChange (1;->[Bridge MHD NBIS]InvH20)$MysMsg:=$MysMsg+"InvH20 = "+String([Bridge MHD NBIS]InvH20)+×sCREnd if $vrMax:=G_RatingV2NBI ([RatingReports]InvType3)If (([Bridge MHD NBIS]InvType3#$vrMax)Ê|Ê$vbForceupdÊ|Ê([Bridge MHD NBIS]InvType3#Old([Bridge MHD NBIS]InvType3)))[Bridge MHD NBIS]InvType3:=$vrMaxPushChange (1;->[Bridge MHD NBIS]InvType3)$MysMsg:=$MysMsg+"InvType3 = "+String([Bridge MHD NBIS]InvType3)+×sCREnd if $vrMax:=G_RatingV2NBI ([RatingReports]Inv3S2)If (([Bridge MHD NBIS]Inv3S2#$vrMax)Ê|Ê$vbForceupdÊ|Ê([Bridge MHD NBIS]Inv3S2#Old([Bridge MHD NBIS]Inv3S2)))[Bridge MHD NBIS]Inv3S2:=$vrMaxPushChange (1;->[Bridge MHD NBIS]Inv3S2)$MysMsg:=$MysMsg+"Inv3S2 = "+String([Bridge MHD NBIS]Inv3S2)+×sCREnd if $vrMax:=G_RatingV2NBI ([RatingReports]InvHS2044)If (([Bridge MHD NBIS]InvHS#$vrMax)Ê|Ê$vbForceupdÊ|Ê([Bridge MHD NBIS]InvHS#Old([Bridge MHD NBIS]InvHS)))[Bridge MHD NBIS]InvHS:=$vrMaxPushChange (1;->[Bridge MHD NBIS]InvHS)$MysMsg:=$MysMsg+"InvHS = "+String([Bridge MHD NBIS]InvHS)+×sCREnd if $vrMax:=G_RatingV2NBI ([RatingReports]InvMS18)If (([Bridge MHD NBIS]InvMS#$vrMax)Ê|Ê$vbForceupdÊ|Ê([Bridge MHD NBIS]InvMS#Old([Bridge MHD NBIS]InvMS)))[Bridge MHD NBIS]InvMS:=$vrMaxPushChange (1;->[Bridge MHD NBIS]InvMS)$MysMsg:=$MysMsg+"InvMS = "+String([Bridge MHD NBIS]InvMS)+×sCREnd if If (([Bridge MHD NBIS]DateRatReport#[RatingReports]ReportDate)Ê|Ê$vbForceupd)[Bridge MHD NBIS]DateRatReport:=[RatingReports]ReportDatePushChange (1;->[Bridge MHD NBIS]DateRatReport)$MysMsg:=$MysMsg+"DateRatReport = "+String([Bridge MHD NBIS]DateRatReport)+×sCREnd if ÊÊ`     **** end of 23-10-2000 modifications$vrMax:=AASHTO_SuffRat If (([Bridge MHD NBIS]AASHTO#$vrMax)Ê|Ê$vbForceupd)[Bridge MHD NBIS]AASHTO:=$vrMaxPushChange (1;->[Bridge MHD NBIS]AASHTO)$MysMsg:=$MysMsg+"AASHTO = "+String([Bridge MHD NBIS]AASHTO;"##.#;-##.#;0")+×sCREnd if If (([Bridge MHD NBIS]Item67#Old([Bridge MHD NBIS]Item67))Ê|Ê$vbForceupd)PushChange (1;->[Bridge MHD NBIS]Item67)$MysMsg:=$MysMsg+"item67 = "+[Bridge MHD NBIS]Item67+×sCREnd if If (([Bridge MHD NBIS]Item68#Old([Bridge MHD NBIS]Item68))Ê|Ê$vbForceupd)PushChange (1;->[Bridge MHD NBIS]Item68)$MysMsg:=$MysMsg+"item68 = "+[Bridge MHD NBIS]Item68+×sCREnd if If (([Bridge MHD NBIS]Item69#Old([Bridge MHD NBIS]Item69))Ê|Ê$vbForceupd)PushChange (1;->[Bridge MHD NBIS]Item69)$MysMsg:=$MysMsg+"item69 = "+[Bridge MHD NBIS]Item69+×sCREnd if If (([Bridge MHD NBIS]Item70#Old([Bridge MHD NBIS]Item70))Ê|Ê$vbForceupd)PushChange (1;->[Bridge MHD NBIS]Item70)$MysMsg:=$MysMsg+"item70 = "+[Bridge MHD NBIS]Item70+×sCREnd if If ($MysMsg#"")$MysMsg:="Update the corresponding NBIS record with these values ?"+×sCR+$MysMsgG_MyConfirm ($MysMsg)End if If (OK=1)FlushGrpChgs (1;->[Bridge MHD NBIS]BIN;->[Bridge MHD NBIS]BIN;->[Bridge MHD NBIS]BIN;0)SAVE RECORD([Bridge MHD NBIS])Else REJECTEnd if CANCELEnd case 