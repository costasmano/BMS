  ` Method: PRINT_TunnelAllItems_F  ` Description  `  ` copied from PRINT_ROUTINE_F  `   ` Parameters  ` ----------------------------------------------------If (False)  ` ----------------------------------------------------  ` User name (OS): Costas Manousakis  ` User name (4D): Designer  ` Date and time: 04/29/13, 10:20:53  ` ----------------------------------------------------  ` First ReleaseMods_2013_04   ` Modified by: Costas Manousakis-(Designer)-(9/9/13 14:40:38)Mods_2013_09   `  `call Print_Tunnel_Cmts for both TAL and TOV inspectionsEnd if C_STRING(255;$oldWinTitle;$newWinTitle;$prevSpoolDocName)C_LONGINT($FormWindow)INSP_PRN_InitVars   `2005-01-04 ASL  `Guarantee this.SET PRINT PREVIEW(False)  `This creates a job name for the print jobs to follow$oldWinTitle:=Get window title$newWinTitle:="All Items Inspection "+[Bridge MHD NBIS]BIN+" "SET WINDOW TITLE($newWinTitle)  `added call to font setup - Oct-2002G_SetInspFont G_InitInspVars sInspDATE:=Uppercase(String([Inspections]Insp Date;Internal date abbreviated ))  `Save the current selection of safety elements and imagesCUT NAMED SELECTION([ElementsSafety];"Temp_PR_RTN_ELMTS")CUT NAMED SELECTION([Standard Photos];"Temp_PR_RTN_IMGS")  `1st pass is done to figure out total number of pages....PrintFlag:=FalsevPrintPhotos:=0  `these are needed to initialize variables used in Print photos methodvPrintSketches:=0vPrintCharts:=0vPrintSpMemPgs:=0G_CountRTNInspPgs   ` this updates selectionsbCmtsFlag:=(viNumCmtsPgs>0)  `found comments bSketchFlag:=(viNumSkPgs>0)bChartFlag:=(viNumChPgs>0)bPhotoFlag:=(viNumPhPgs>0)bSpecMemPgsFlag:=(viNumSpMPages>0)bInvPhotoFlag:=([Inspections]InitialInsp)  `chng.2007..ARRAY DATE(aInvPhotoDate_aD;0)If (bInvPhotoFlag)READ ONLY([InventoryPhotoInsp])QUERY([InventoryPhotoInsp];[InventoryPhotoInsp]BIN=[Inspections]BIN)SELECTION TO ARRAY([InventoryPhotoInsp]InvPhotoDate_D;aInvPhotoDate_aD)If (Size of array(aInvPhotoDate_aD)>0)SORT ARRAY(aInvPhotoDate_aD;<)INSERT IN ARRAY(aInvPhotoDate_aD;1;1)Else bInvPhotoFlag:=FalseEnd if Else End if bPontisFlag:=([Combined Inspections]BMSInspID>0)  ` get/update total number of pages for report and choose what is to be printedC_LONGINT($Width_l;$Height_l;$Win_l;$Pages_l)C_BOOLEAN($FixedWidth_b;$FixedHeight_b)C_TEXT($Title_txt)GET FORM PROPERTIES([Dialogs];"PrintInspRpt2";$Width_l;$Height_l;$Pages_l;$FixedWidth_b;$FixedHeight_b;$Title_txt)$Win_l:=ut_OpenNewWindow ($Width_l;$Height_l;0;Plain form window ;$Title_txt;"ut_CloseCancel")DIALOG([Dialogs];"PrintInspRpt2")CLOSE WINDOW($Win_l)If (OK=1)If (vPrintPreview=1)SET PRINT PREVIEW(True)ON ERR CALL("G_PrintError")  `Set error handler for quiting from PreviewEnd if   `PAGE SETUP([Inspections];"Dive Pr Pg 1")G_PrintOptions If (◊ShowPrint)PRINT SETTINGSEnd if If (OK=1)  `user can cancel from the print settings  G_PrintOptions BRING TO FRONT(Current process)  ` 1st  and second page  `initialize Page NumbervPageNo:=2GET PRINT OPTION(Spooler document name option ;$prevSpoolDocName)  `SET PRINT OPTION(Spooler document name option ;"Routine-"+[Inspections]BIN+"-"+St  `ring([Inspections]Insp Date))  `MODS_XXXX_CMIf (vPrintPage1=1)Case of : ([Inspections]Insp Type="TAL")Print form([Inspections];"TunnelRoutinePg1"): ([Inspections]Insp Type="TOV")Print form([Inspections];"TunnelOverPg1")End case If ((vPrintPage2=1) | (vPrintSpMemPgs=1))  `MODS_XXXX_CM  `PAGE BREAK(>)`MODS_XXXX_CMElse   `PAGE BREAK(>)End if End if If ((vPrintPage2=1) & (viInspPreviewErr=0))PAGE BREAK(>)  `MODS_XXXX_CMCase of : ([Inspections]Insp Type="TAL")Print form([Inspections];"TunnelRoutinePg2"): ([Inspections]Insp Type="TOV")Print form([Inspections];"TunnelOverPg2")End case If ((vPrintSpMemPgs=1) & (viInspPreviewErr=0))  `MODS_XXXX_CM  `PAGE BREAK(>)Else   `PAGE BREAK(>)End if End if If ((vPrintSpMemPgs=1) & (viInspPreviewErr=0))  `PAGE BREAK(>)`MODS_XXXX_CMPrint_SpecMem_pg3 End if vPageNo:=viCmtsPgStart-1  `Comments pagesIf ((vPrintCmts=1) & (Ok=1) & (viInspPreviewErr=0))PrintFlag:=TrueviNumCmtsPgs:=Print_Tunnel_Cmts   ` need to call it to set page numbers straightElse vPageNo:=viCmtsPgStart+viNumCmtsPgs-1End if   `print photo pagesIf (((vPrintPhotos=1) | (vPrintSketches=1) | (vPrintCharts=1)) & (viInspPreviewErr=0))PrintFlag:=TruePrint_Dive_photos Else vPageNo:=2+viNumSpMPages+viNumCmtsPgs+viNumSkPgs+viNumChPgs+viNumPhPgsEnd if   `Print inventory photoIf (vPrintInvPhotos=1)SET AUTOMATIC RELATIONS(False;False)QUERY([InventoryPhotoInsp];[InventoryPhotoInsp]BIN=[Inspections]BIN)QUERY SELECTION([InventoryPhotoInsp];[InventoryPhotoInsp]InvPhotoDate_D=aInvPhotoDate_aD{aInvPhotoDate_aD})If (Records in selection([InventoryPhotoInsp])=1)QUERY([InventoryPhotos];[InventoryPhotos]InvPhotoInsp_ID=[InventoryPhotoInsp]InvPhotoInspID_L)ORDER BY([InventoryPhotos];[InventoryPhotos]Sequence_I;>;[InventoryPhotos]PhotoDescr_txt;>)INV_PrintInvInsp (True)  `Bypass setting print settings in the methodEnd if   `SET AUTOMATIC RELATIONS(True;True)End if   `Print SI&A normal  If ((vPrintSIA=1) & (viInspPreviewErr=0))Print form([Bridge MHD NBIS];"TunnelSIA")PAGE BREAKEnd if   `send a last page break to spool the jobC_BOOLEAN($vbLastbreak)$vbLastbreak:=((vPrintPage1=1) | (vPrintPage2=1) | (vPrintSpMemPgs=1) | (vPrintCmts=1))$vbLastbreak:=$vbLastbreak | ((vPrintSketches=1) | (vPrintCharts=1) | (vPrintPhotos=1) | (vPrintSIA=1))If ($vbLastbreak)PAGE BREAKEnd if INSP_PRINTPontis If (vPrintPreview=1)SET PRINT PREVIEW(False)End if   `SET PRINT OPTION(Spooler document name option ;$prevSpoolDocName)  `MODS_XXXX_CMEnd if End if ON ERR CALL("")  `reset the error handlerUSE NAMED SELECTION("Temp_PR_RTN_ELMTS")USE NAMED SELECTION("Temp_PR_RTN_IMGS")SET WINDOW TITLE($oldWinTitle)