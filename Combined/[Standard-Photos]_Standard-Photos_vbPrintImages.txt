If (False)ÊÊ` ----------------------------------------------------ÊÊ` Object Method: vbPrintImagesÊÊ` User name (OS): cjmillerÊÊ` Date and time: 03/29/05, 15:58:38ÊÊ` ----------------------------------------------------ÊÊ` DescriptionÊÊ` ÊÊ`ÊÊ` ParametersÊÊ` ----------------------------------------------------ÊÊ`[Standard Photos]Standard Photos.vbPrintImages ÊÊ`Print preview the current image depending on type ofÊÊ`the inspectionÊÊ`Created in December 2004Mods_2004_VN04 Mods_2005_CJM02 ÊÊ`03/29/05, 15:58:45ÊÊ` Modified by: costasmanousakis-(Designer)-(10/10/2006 08:38:22)Mods_2006_CM06A ÊÊ` Modified by: costasmanousakis-(Designer)-(9/12/2007 10:32:42)Mods_2007_CM12_5301 ÊÊ` Modified by: costasmanousakis-(Designer)-(2/22/09 23:06:03)Mods_2009_CM_5404 ÊÊ` --- "FREEZETHAW"ÊÊ` Modified by: Costas Manousakis-(Designer)-(3/11/13 11:25:13)Mods_2013_03 ÊÊ`ÊÊ`Added the Rail Inspections when counting inspection pagesÊÊ` Modified by: Costas Manousakis-(Designer)-(8/28/13 11:25:13)Mods_2013_08 ÊÊ`ÊÊ`Added Redraw Window at end to fix Windows redraw problem at end of printingÊÊ` Modified by: Costas Manousakis-(Designer)-(10/22/13 09:38:03)Mods_2013_10 ÊÊ`ÊÊ`Added Tunnel inspection types in the recalc of the inspection pagesEnd if C_BOOLEAN($vbIsPrintPreviewed;$vbIsNewRecord;$vbIsRecordModified;$vbPrintFlag)C_STRING(6;$vsInspType)C_STRING(255;$vsMessage1;$vsMessage2)C_INTEGER(vPageNo;vPrintSketchs;vPrintCharts;vPrintPhotos)C_LONGINT($viInspID;$viStdPhotoID;$viRecordNum)ARRAY LONGINT($aiStdPhotoID;0)ÊÊ`Initialize all local variables$vbPrintFlag:=True$vbIsNewRecord:=False$vbIsRecordModified:=False$viInspID:=[Standard Photos]InspID$viStdPhotoID:=[Standard Photos]StdPhotoID$vsMessage1:="Please select either Print or Print Preview for current page images."$vsMessage2:="Do you want to save the new record you have created?"ÊÊ`Copy the current selection for later useCOPY NAMED SELECTION([ElementsSafety];"TempElements")COPY NAMED SELECTION([Standard Photos];"TempImages")G_PrintOptions ÊÊ`PAGE SETUP([Inspections];"Dive Pr Pg 1")ÊÊ`Either new record has created or the current record has been modifiedCase of ÊÊ`Check to see whether there is new record that has been created      : (Is new record([Standard Photos]))ÊÊ`Prompt the user to save the new record that have been createdCONFIRM($vsMessage2)If (OK=1)ÊÊ`Promt the user to select either Print or Print Preview optionCONFIRM($vsMessage1;"Print";"Print Preview")If (OK=1)ÊÊ`Print optionPRINT SETTINGSIf (OK#1)$vbPrintFlag:=FalseEnd if Else ÊÊ`Print Preview option        SET PRINT PREVIEW(True)End if $vbIsNewRecord:=TrueSAVE RECORD([Standard Photos])INSP_SavePhoto InitChangeStack (2)ÊÊ`Update the current selection with the new recordQUERY([Standard Photos];[Standard Photos]InspID=$viInspID)ÊÊ`Sort images according to their types and sequence numbersG_SortInspImages ÊÊ`Saved the current updated selection with the new recordCOPY NAMED SELECTION([ElementsSafety];"TempElements")COPY NAMED SELECTION([Standard Photos];"TempImages")ÊÊ`Put the current selection in to aiStdPhotoID array SELECTION TO ARRAY([Standard Photos]StdPhotoID;$aiStdPhotoID)ÊÊ`Abort print preview       Else $vbPrintFlag:=FalseEnd if ÊÊ`Check to see whether the current photo has been modified: ((Modified record([Standard Photos]))Ê|Ê(vbPictureChanged))ÊÊ`prompt the user to save the changes that have been madeCONFIRM("Do you want to save all the changes you have made?")If (OK=1)ÊÊ`Promt the user to select either Print or Print Preview optionCONFIRM($vsMessage1;"Print";"Print Preview")If (OK=1)ÊÊ`Print optionPRINT SETTINGSIf (OK#1)$vbPrintFlag:=FalseEnd if Else ÊÊ`Print Preview option         SET PRINT PREVIEW(True)End if $vbIsRecordModified:=TrueINSP_SavePhoto SAVE RECORD([Standard Photos])vbPictureChanged:=FalseInitChangeStack (2)ÊÊ`Update the current selection with the updated recordQUERY([Standard Photos];[Standard Photos]InspID=$viInspID)ÊÊ`Sort images according to their types and sequence numbersG_SortInspImages ÊÊ`Saved the current updated selection with the new recordCOPY NAMED SELECTION([ElementsSafety];"TempElements")COPY NAMED SELECTION([Standard Photos];"TempImages")ÊÊ`Put the current selection in to aiStdPhotoID array SELECTION TO ARRAY([Standard Photos]StdPhotoID;$aiStdPhotoID)ÊÊ`Abort print preview      Else $vbPrintFlag:=FalseEnd if ÊÊ`There are no changes for the images of the current page  Else vButtonPrintPreview:=0vButtonPrint:=0vButtonCancel:=0vTextMsg:=$vsMessage1C_LONGINT($tempWin)$tempWin:=Open window(100;300;595;500;0;"Print or Print Preview for Current Page Images")DIALOG([Dialogs];"PrintPreviewImages")CLOSE WINDOWCase of : (vButtonPrintPreview=1)SET PRINT PREVIEW(True): (vButtonPrint=1)PRINT SETTINGSIf (OK#1)$vbPrintFlag:=FalseEnd if : (vButtonCancel=1)$vbPrintFlag:=FalseEnd case End case ÊÊ`Print preview the current imagesIf ($vbPrintFlag)ÊÊ`get the inspection type$vsInspType:=[Inspections]Insp TypesInspDATE:=Uppercase(String([Inspections]Insp Date;Internal date abbreviated ))ON ERR CALL("G_PrintError")C_INTEGER(viInspPreviewErr)viInspPreviewErr:=0Case of ÊÊ`Culvert Inspection    : (($vsInsptype="CUL")Ê|Ê($vsInsptype="RRC"))G_CountCulvInspPgs ÊÊ`Closed Bridge Inspection    : ($vsInsptype="CLD")G_CountClsdInspPgs ÊÊ`Routine or Routine Arch Inspection    : (($vsInsptype="RTN")Ê|Ê($vsInsptype="RTA")Ê|Ê($vsInsptype="RRR")Ê|Ê($vsInsptype="RRA")Ê|Ê($vsInsptype="TAL")Ê|Ê($vsInsptype="TOV"))G_CountRTNInspPgs ÊÊ`Special Member or Fracture Critical or Damage Inspection    : (($vsInsptype="CMI")Ê|Ê($vsInsptype="FCR")Ê|Ê($vsInsptype="DAM")Ê|Ê($vsInsptype="OTH")Ê|Ê($vsInsptype="FRZ")Ê|Ê($vsInsptype="RRS")Ê|Ê($vsInsptype="RRF")Ê|Ê($vsInsptype="RRO")Ê|Ê($vsInsptype="RRD")Ê|Ê($vsInsptype="TSP")Ê|Ê($vsInsptype="TOT")Ê|Ê($vsInsptype="TDA"))G_CountSpInspPgs ÊÊ`Underwater or Underwater Special Member or ÊÊ`Underwater Close Clearance Inspection    : (($vsInsptype="DVE")Ê|Ê($vsInsptype="DVS")Ê|Ê($vsInsptype="DVL"))G_CountDiveInspPgs End case USE NAMED SELECTION("TempElements")USE NAMED SELECTION("TempImages")ÊÊ`Make sure that the current pointer is pointing to the new recordIf ($vbIsNewRecordÊ|Ê$vbIsRecordModified)$viRecordNum:=Find in array($aiStdPhotoID;$viStdPhotoID)If ($viRecordNum>0)GOTO SELECTED RECORD([Standard Photos];$viRecordNum)End if End if PreviewInspectionImages End if ON ERR CALL("")SET PRINT PREVIEW(False)CLEAR NAMED SELECTION("TempElements")CLEAR NAMED SELECTION("TempImages")REDRAW WINDOW