If (False)  `procedure: TEMP_ExportNBI  `by: Albert Leung  `date: 4/16/97  `modified: 3/6/98  `copied from ExportNBI by CM  `purpose: create file for NBI data submittal    ` modified  3/21/2001 : added various error checks for primary and  `       secondary records.  `Modified 3/21/01 by RLV  `Rounding item49 and Item51 before converting to string which truncates the valueMods_2004_CM11   ` Modified by: ManousakisC (3/21/2006)Mods_2006_CM03   ` Modified by: costasmanousakis-(Designer)-(3/4/10 10:15:17)Mods_2010_03   `  `changed extension of output file to .txt  ` Modified by: costasmanousakis-(Designer)-(11/3/10 14:49:04)Mods_2010_11   `  `Use method SIA_DesignLoadTrans to tranlsate [Bridge MHD NBIS]Item31 from MHD code to FHWA code  ` Modified by: costasmanousakis-(Designer)-(12/17/10 09:53:35)Mods_2010_12   `  `Added call to SIA_DataCheck  ` Modified by: costasmanousakis-(Designer)-(3/7/11 08:53:18)Mods_2011_03   `Use  ut_OpenDocument instead of AP ShellExecuteMods_2011_06   ` CJ Miller`06/13/11, 16:45:42      ` Type all local variables for v11  ` Modified by: Costas Manousakis-(Designer)-(3/15/13 15:25:18)Mods_2013_03   `  `Added $item8_txt to get fhwaItem8 field if it is populatedEnd if C_TIME($dExportFile)C_TIME($dErrFile)  `Added 4/3/2000 CMC_STRING(80;$NBfile)C_STRING(80;$NBErrfile)C_STRING(255;$fill)C_STRING(255;$vsOutputFolder;◊vsNBIExportOutF)C_TEXT($t)C_TEXT($et)  ` added 3/21/2001C_LONGINT($i;$j;$k;$Recs;$Interval)C_LONGINT($l)  `Added 4/3/2000 cm - error record counterC_INTEGER($y;$m)C_STRING(3;$crit)C_STRING(24;$Item6A)  `Added 3/6/98 by Tom Nee.C_STRING(1;$Item6B)C_STRING(18;$Item7)  `Added 3/6/98 by Tom Nee.C_STRING(25;$Item9)  `Added 3/6/98 by Tom Nee.C_STRING(4;$Item10)C_STRING(7;$Item11)C_STRING(1;$Item12)C_STRING(8;$Item16)C_STRING(9;$Item17)C_STRING(3;$Item19)C_STRING(4;$Item27;$Item28)C_STRING(6;$Item29)C_STRING(4;$Item30;$Item32)C_STRING(2;$Item34)C_STRING(1;$Item35;$Item37)  `C_STRING(11;$Item37FHWA;$Item37Code) ` Replaced by call to GP HistoricalTrans.C_STRING(4;$Item39)C_STRING(5;$Item40)C_STRING(3;$Item45)C_STRING(4;$Item46)C_STRING(3;$Item47)C_STRING(5;$Item48)C_STRING(6;$Item49)C_STRING(6;$Item50)C_STRING(4;$Item51;$Item52;$Item53)C_STRING(5;$Item54)C_STRING(4;$Item55)C_STRING(3;$Item56;$Item64;$Item66)C_STRING(6;$Item76)C_STRING(4;$Item90)C_STRING(2;$Item91)C_STRING(9;$Item92)C_STRING(4;$Item93A;$Item93B;$Item93C)C_STRING(6;$Item94;$Item95;$Item96)C_STRING(4;$Item97)C_STRING(1;$Item103;$Item104)C_STRING(4;$Item106)C_STRING(2;$Item109)C_STRING(1;$Item110;$Item112;$Item113)C_STRING(6;$Item114)C_STRING(4;$Item115)C_STRING(4;$Item116)  `C_STRING(2;$Item2)C_STRING(12;$Item13)  `C_STRING(2;$Item21;$Item22)   `C_STRING(1;$Item31;$Item33;$Item36;$Item38;$Item41)C_STRING(3;$Item44)  `C_STRING(1;$Item58;$Item59;$Item60;$Item61;$Item62); C_STRING(1;$Item63;$Item65)  `C_STRING(1;$Item67;$Item68;$Item69;$Item70;$Item71;$Item72)C_STRING(3;$Item75)  `C_STRING(5;$Item98);  `C_STRING(15;$Item99)C_STRING(1;$Item105)  `C_STRING(1;$Item107);  `C_STRING(3;$Item108)C_STRING(1;$Item111)C_TEXT($item8_txt)C_BOOLEAN($igItem97;$igItem92a)  `Get only FHWA records  `SEARCH([Bridge MHD NBIS];[Bridge MHD NBIS]FHWARecord=True)  `  changed by CM to do it for records in selection$Recs:=Records in selection([Bridge MHD NBIS])CONFIRM("Export "+String($Recs;"##,##0")+" records to an NBI file (fixed length, 434 characters per record)?")If (OK=1)CENTER_WINDOW (250;190)DIALOG([Dialogs];"SuppressErrors")CLOSE WINDOWIf (Ok=1)$igItem97:=(CBItem97=1)$igItem92a:=(CBItem92a=1)End if   `  $Item37FHWA:="12235334435" ` Replaced by call to GP HistoricalTrans.  `  $Item37Code:="HEPANCR ?XZ" ` Replaced by call to GP HistoricalTrans.$fill:=" "*43$t:="Select folder for Export files."If (◊vsNBIExportOutF#"")$t:=$t+"  (Press Cancel for "+◊vsNBIExportOutF+")"End if $vsOutputFolder:=Select folder($t)If (OK=1)◊vsNBIExportOutF:=$vsOutputFolderElse $vsOutputFolder:=◊vsNBIExportOutFEnd if $NBfile:="MFINPUT.TXT"$dExportFile:=Create document($vsOutputFolder+$NBfile;"TEXT")$NBErrfile:="MFINPUTERR.TXT"$dErrFile:=Create document($vsOutputFolder+$NBErrfile;"TEXT")If (Ok=1)  `TRACE◊ProgressPID:=StartProgress ("NBIExport";"None";"Exporting NBI Records")UpdateProgress (0;$Recs)  `Start the progress$Interval:=MaxNum (MinNum (Int($Recs/40);20);2)  ` get an update interval between 2 and 20$t:=""$k:=0$l:=0FIRST RECORD([Bridge MHD NBIS])For ($i;1;$Recs)$Item6A:=" "*24$Item6A:=Change string($Item6A;[Bridge MHD NBIS]Item6A;1)  `Added 3/6/98 by Tom Nee.If ([Bridge MHD NBIS]Item6B=True)$Item6B:="*"Else $Item6B:=" "End if $Item7:=" "*18$Item7:=Change string($Item7;[Bridge MHD NBIS]Item7;1)  `Added 3/6/98 by Tom Nee.$Item9:=" "*25$Item9:=Change string($Item9;[Bridge MHD NBIS]Item9;1)  `Added 3/6/98 by Tom Nee.$Item10:=String([Bridge MHD NBIS]Item10*100;"0000")$Item11:=String([Bridge MHD NBIS]Item11*1000;"0000000")If ([Bridge MHD NBIS]Item12=True)$Item12:="1"Else $Item12:="0"End if $Item13:=" "*12  `Added 3/10/98 by Tom Nee.$Item13:=Change string($Item13;[Bridge MHD NBIS]Item 13A;11-Length([Bridge MHD NBIS]Item 13A))  `Right justified, 10 chars.$Item13:=Change string($Item13;[Bridge MHD NBIS]Item 13B;13-Length([Bridge MHD NBIS]Item 13B))  `Right justified, 2 chars.$Item16:=String([Bridge MHD NBIS]Item16A;"00")+String([Bridge MHD NBIS]Item16B;"00")+String([Bridge MHD NBIS]Item16C*100;"0000")$Item17:=String([Bridge MHD NBIS]Item17A;"000")+String([Bridge MHD NBIS]Item17B;"00")+String([Bridge MHD NBIS]Item17C*100;"0000")$Item19:=String([Bridge MHD NBIS]Item19;"000")$Item27:=String([Bridge MHD NBIS]Item27;"0000")$Item28:=String([Bridge MHD NBIS]Item28A;"00")+String([Bridge MHD NBIS]Item28B;"00")$Item29:=String([Bridge MHD NBIS]Item29;"000000")$Item30:=String([Bridge MHD NBIS]Item30;"0000")$Item32:=String([Bridge MHD NBIS]Item32*10;"0000")$Item34:=String([Bridge MHD NBIS]Item34;"00")If ([Bridge MHD NBIS]Item35=True)$Item35:="1"Else $Item35:="0"End if   `These four lines are now in  HistoricalTrans.  TDN 12/24/98.       `      $Item37:=$Item37FHWA≤Position([Bridge MHD NBIS]Item37;$Item37code)≥  `      If (Position($Item37;$Item37FHWA)<1)  `        $Item37:="4"  `      End if $Item37:=HistoricalTrans $Item39:=String([Bridge MHD NBIS]Item39*10;"0000")$Item40:=String([Bridge MHD NBIS]Item40*10;"00000")$Item44:=" "*3$Item44:=Change string($Item44;[Bridge MHD NBIS]Item44;1)  `Added 3/10/98 by Tom Nee.$Item45:=String([Bridge MHD NBIS]Item45;"000")$Item46:=String([Bridge MHD NBIS]Item46;"0000")$Item47:=String([Bridge MHD NBIS]Item47*10;"000")$Item48:=String([Bridge MHD NBIS]Item48*10;"00000")  `3/21/01 Rounding before truncating  `$Item49:=String([Bridge MHD NBIS]Item49*10;"000000")$Item49:=String(Round([Bridge MHD NBIS]Item49;1)*10;"000000")  `End of change$Item50:=String([Bridge MHD NBIS]Item50A*10;"000")+String([Bridge MHD NBIS]Item50B*10;"000")  `3/21/01 Rounding before truncating  `$Item51:=String([Bridge MHD NBIS]Item51*10;"0000")$Item51:=String(Round([Bridge MHD NBIS]Item51;1)*10;"0000")  ` End of change$Item52:=String([Bridge MHD NBIS]Item52*10;"0000")$Item53:=String([Bridge MHD NBIS]Item53*100;"0000")$Item54:=" "$Item54:=Change string($Item54;[Bridge MHD NBIS]Item54A;1)$Item54:=$Item54+String([Bridge MHD NBIS]Item54B*100;"0000")$Item55:=" "$Item55:=Change string($Item55;[Bridge MHD NBIS]Item55A;1)$Item55:=$Item55+String([Bridge MHD NBIS]Item55B*10;"000")$Item56:=String([Bridge MHD NBIS]Item56*10;"000")$Item63:=" "$Item63:=Change string($Item63;[Bridge MHD NBIS]Item 63;1)If (Position($Item63;"-6-7-8-")>0)$Item64:=String([Bridge MHD NBIS]Item64*100;"000")Else $Item64:=String([Bridge MHD NBIS]Item64*10;"000")End if $Item65:=" "$Item65:=Change string($Item65;[Bridge MHD NBIS]Item 65;1)If (Position($Item65;"-6-7-8-")>0)$Item66:=String([Bridge MHD NBIS]Item66*100;"000")Else $Item66:=String([Bridge MHD NBIS]Item66*10;"000")End if $Item75:=" "*3  `Added 3/10/98 by Tom Nee.$Item75:=Change string($Item75;[Bridge MHD NBIS]Item75A;1)$Item75:=Change string($Item75;[Bridge MHD NBIS]Item75B;3)$Item76:=String([Bridge MHD NBIS]Item76*10;"000000")$m:=Month of([Bridge MHD NBIS]Item90)$y:=Year of([Bridge MHD NBIS]Item90)If ($y>1999)$y:=$y-2000Else $y:=$y-1900End if $Item90:=String($m;"00")+String($y;"00")$Item91:=String([Bridge MHD NBIS]Item91;"00")$Item92:=""If ([Bridge MHD NBIS]Item92AA=True)If (($igItem92a=True) & ([Bridge MHD NBIS]Item92AB>24))$crit:="Y24"Else $crit:="Y"+String([Bridge MHD NBIS]Item92AB;"00")End if $m:=Month of([Bridge MHD NBIS]Item93A)$y:=Year of([Bridge MHD NBIS]Item93A)Case of : ($y>1999)$y:=$y-2000$Item93A:=String($m;"00")+String($y;"00"): ($y>1900)$y:=$y-1900$Item93A:=String($m;"00")+String($y;"00"): ($y=0)$Item93A:=" "*4End case Else $crit:="N  "$Item93A:="    "End if $Item92:=$critIf ([Bridge MHD NBIS]Item92BA=True)$crit:="Y"+String([Bridge MHD NBIS]Item92BB;"00")$m:=Month of([Bridge MHD NBIS]Item93B)$y:=Year of([Bridge MHD NBIS]Item93B)Case of : ($y>1999)$y:=$y-2000$Item93B:=String($m;"00")+String($y;"00"): ($y>1900)$y:=$y-1900$Item93B:=String($m;"00")+String($y;"00"): ($y=0)$Item93B:=" "*4End case Else $crit:="N  "$Item93B:="    "End if $Item92:=$Item92+$critIf ([Bridge MHD NBIS]Item92CA=True)$crit:="Y"+String([Bridge MHD NBIS]Item92CB;"00")$m:=Month of([Bridge MHD NBIS]Item93C)$y:=Year of([Bridge MHD NBIS]Item93C)Case of : ($y>1999)$y:=$y-2000$Item93C:=String($m;"00")+String($y;"00"): ($y>1900)$y:=$y-1900$Item93C:=String($m;"00")+String($y;"00"): ($y=0)$Item93C:=" "*4End case Else $crit:="N  "$Item93C:="    "End if $Item92:=$Item92+$crit$Item94:=String([Bridge MHD NBIS]Item94;"000000")$Item95:=String([Bridge MHD NBIS]Item95;"000000")$Item96:=String([Bridge MHD NBIS]Item96;"000000")$Item97:=String([Bridge MHD NBIS]Item97;"0000")If (($igItem97=True) & ($Item97="0000"))$Item97:=String(Year of(Current date(*));"0000")End if If ([Bridge MHD NBIS]Item103=True)$Item103:="T"Else $Item103:=" "End if If ([Bridge MHD NBIS]Item104=True)$Item104:="1"Else $Item104:="0"End if $Item105:=" "  `Added 3/10/98 by Tom Nee.$Item105:=Change string($Item105;[Bridge MHD NBIS]Item 105;1)$Item106:=String([Bridge MHD NBIS]Item106;"0000")$Item109:=String([Bridge MHD NBIS]Item109;"00")If ([Bridge MHD NBIS]Item110=True)$Item110:="1"Else $Item110:="0"End if $Item111:=" "  `Added 3/10/98 by Tom Nee.$Item111:=Change string($Item111;[Bridge MHD NBIS]Item111;1)If ([Bridge MHD NBIS]Item112=True)$Item112:="Y"Else $Item112:="N"End if $Item113:=[Bridge MHD NBIS]Item113If ($Item113="D")$Item113:="6"End if $Item114:=String([Bridge MHD NBIS]Item114;"000000")$Item115:=String([Bridge MHD NBIS]Item115;"0000")$Item116:=String([Bridge MHD NBIS]Item116*10;"0000")$item8_txt:=[Bridge MHD NBIS]Item8If ([Bridge MHD NBIS]FHWAItem8#"")$item8_txt:=[Bridge MHD NBIS]FHWAItem8End if $t:="251"+$item8_txt+[Bridge MHD NBIS]Item5+[Bridge MHD NBIS]Item2$t:=$t+[Bridge MHD NBIS]Item3+[Bridge MHD NBIS]Item4+$Item6A+$Item6B+$Item7$t:=$t+$Item9+$Item10+$Item11+$Item12+$Item13$t:=$t+$Item16+$Item17+$Item19+[Bridge MHD NBIS]Item20+[Bridge MHD NBIS]Item21+[Bridge MHD NBIS]Item22$t:=$t+[Bridge MHD NBIS]Item26+$Item27+$Item28+$Item29+$Item30+SIA_DesignLoadTrans ([Bridge MHD NBIS]Item31)+$Item32$t:=$t+[Bridge MHD NBIS]Item33+$Item34+$Item35+[Bridge MHD NBIS]Item36A+[Bridge MHD NBIS]Item36B+[Bridge MHD NBIS]Item36C+[Bridge MHD NBIS]Item36D$t:=$t+$Item37+[Bridge MHD NBIS]Item38+$Item39+$Item40+[Bridge MHD NBIS]Item41+[Bridge MHD NBIS]Item42$t:=$t+[Bridge MHD NBIS]Item43+$Item44+$Item45+$Item46+$Item47+$Item48+$Item49$t:=$t+$Item50+$Item51+$Item52+$Item53+$Item54+$Item55+$Item56+[Bridge MHD NBIS]Item58+[Bridge MHD NBIS]Item59$t:=$t+[Bridge MHD NBIS]Item60+[Bridge MHD NBIS]Item61+[Bridge MHD NBIS]Item62+$Item63+$Item64$t:=$t+$Item65+$Item66+[Bridge MHD NBIS]Item67+[Bridge MHD NBIS]Item68$t:=$t+[Bridge MHD NBIS]Item69+[Bridge MHD NBIS]Item70+[Bridge MHD NBIS]Item71+[Bridge MHD NBIS]Item72$t:=$t+$Item75+$Item76+$Item90+$Item91+$Item92+$Item93A+$Item93B+$Item93C$t:=$t+$Item94+$Item95+$Item96+$Item97+[Bridge MHD NBIS]Item98A+[Bridge MHD NBIS]Item98B+[Bridge MHD NBIS]Item99$t:=$t+[Bridge MHD NBIS]Item100+[Bridge MHD NBIS]Item101+[Bridge MHD NBIS]Item102+$Item103+$Item104+$Item105$t:=$t+$Item106+[Bridge MHD NBIS]Item107+[Bridge MHD NBIS]Item108A+[Bridge MHD NBIS]Item108B+[Bridge MHD NBIS]Item108C$t:=$t+$Item109+$Item110+$Item111+$Item112+$Item113+$Item114+$Item115+$Item116+$fill+◊sCR+◊sLFIf (Length($t)#434)  `Includes CR and LF  ` Do some checks for data length and write any errors to the error file$et:=""If (Length([Bridge MHD NBIS]Item5)<9)$et:=$et+"5 < 9 : -"+[Bridge MHD NBIS]Item5+"-"+◊sCR+◊sLFEnd if If (Length($Item9)<25)$et:=$et+"9 : blank : -"+[Bridge MHD NBIS]Item9+"-"+◊sCR+◊sLFEnd if If (Length([Bridge MHD NBIS]Item20)<1)$et:=$et+"20 < 1 : -"+[Bridge MHD NBIS]Item20+"-"+◊sCR+◊sLFEnd if If (Length([Bridge MHD NBIS]Item21)<2)$et:=$et+"21 < 2 : -"+[Bridge MHD NBIS]Item21+"-"+◊sCR+◊sLFEnd if If (Length([Bridge MHD NBIS]Item22)<2)$et:=$et+"22 < 2 : -"+[Bridge MHD NBIS]Item22+"-"+◊sCR+◊sLFEnd if If (Length([Bridge MHD NBIS]Item26)<2)$et:=$et+"26 < 2 : -"+[Bridge MHD NBIS]Item26+"-"+◊sCR+◊sLFEnd if If (Length([Bridge MHD NBIS]Item31)<1)$et:=$et+"31 < 1 : -"+[Bridge MHD NBIS]Item31+"-"+◊sCR+◊sLFEnd if If (Length([Bridge MHD NBIS]Item33)<1)$et:=$et+"33 < 1 : -"+[Bridge MHD NBIS]Item33+"-"+◊sCR+◊sLFEnd if If (Length([Bridge MHD NBIS]Item36A)<1)$et:=$et+"36A < 1 : -"+[Bridge MHD NBIS]Item36A+"-"+◊sCR+◊sLFEnd if If (Length([Bridge MHD NBIS]Item36B)<1)$et:=$et+"36B < 1 : -"+[Bridge MHD NBIS]Item36B+"-"+◊sCR+◊sLFEnd if If (Length([Bridge MHD NBIS]Item36C)<1)$et:=$et+"36C < 1 : -"+[Bridge MHD NBIS]Item36C+"-"+◊sCR+◊sLFEnd if If (Length([Bridge MHD NBIS]Item36D)<1)$et:=$et+"36D < 1 : -"+[Bridge MHD NBIS]Item36D+"-"+◊sCR+◊sLFEnd if If (Length([Bridge MHD NBIS]Item38)<1)$et:=$et+"38 < 1 : -"+[Bridge MHD NBIS]Item38+"-"+◊sCR+◊sLFEnd if If (Length([Bridge MHD NBIS]Item41)<1)$et:=$et+"41 < 1 : -"+[Bridge MHD NBIS]Item41+"-"+◊sCR+◊sLFEnd if If (Length([Bridge MHD NBIS]Item42)<2)$et:=$et+"42 < 2 : -"+[Bridge MHD NBIS]Item42+"-"+◊sCR+◊sLFEnd if If (Length([Bridge MHD NBIS]Item43)<3)$et:=$et+"43 < 3 : -"+[Bridge MHD NBIS]Item43+"-"+◊sCR+◊sLFEnd if If (Length($Item54)<5)$et:=$et+"54 < 5 : -"+$Item54+"-"+◊sCR+◊sLFEnd if If (Length($Item55)<4)$et:=$et+"55 < 4 : -"+$Item55+"-"+◊sCR+◊sLFEnd if If (Length([Bridge MHD NBIS]Item58)<1)$et:=$et+"58 < 1 : -"+[Bridge MHD NBIS]Item58+"-"+◊sCR+◊sLFEnd if If (Length([Bridge MHD NBIS]Item59)<1)$et:=$et+"59 < 1 : -"+[Bridge MHD NBIS]Item59+"-"+◊sCR+◊sLFEnd if If (Length([Bridge MHD NBIS]Item60)<1)$et:=$et+"60 < 1 : -"+[Bridge MHD NBIS]Item60+"-"+◊sCR+◊sLFEnd if If (Length([Bridge MHD NBIS]Item61)<1)$et:=$et+"61 < 1 : -"+[Bridge MHD NBIS]Item61+"-"+◊sCR+◊sLFEnd if If (Length([Bridge MHD NBIS]Item62)<1)$et:=$et+"62 < 1 : -"+[Bridge MHD NBIS]Item62+"-"+◊sCR+◊sLFEnd if If (Length([Bridge MHD NBIS]Item71)<1)$et:=$et+"71 < 1 : -"+[Bridge MHD NBIS]Item71+"-"+◊sCR+◊sLFEnd if If (Length([Bridge MHD NBIS]Item72)<1)$et:=$et+"72 < 1 : -"+[Bridge MHD NBIS]Item72+"-"+◊sCR+◊sLFEnd if If (Length([Bridge MHD NBIS]Item98A)<3)$et:=$et+"98A < 3 : -"+[Bridge MHD NBIS]Item98A+"-"+◊sCR+◊sLFEnd if If (Length([Bridge MHD NBIS]Item98B)<2)$et:=$et+"98b < 2 : -"+[Bridge MHD NBIS]Item98B+"-"+◊sCR+◊sLFEnd if If (Length([Bridge MHD NBIS]Item99)<15)$et:=$et+"99 < 15 : -"+[Bridge MHD NBIS]Item99+"-"+◊sCR+◊sLFEnd if If (Length([Bridge MHD NBIS]Item100)<1)$et:=$et+"100 < 1 : -"+[Bridge MHD NBIS]Item100+"-"+◊sCR+◊sLFEnd if If (Length([Bridge MHD NBIS]Item101)<1)$et:=$et+"101 < 1 : -"+[Bridge MHD NBIS]Item101+"-"+◊sCR+◊sLFEnd if If (Length([Bridge MHD NBIS]Item102)<1)$et:=$et+"102 < 1 : -"+[Bridge MHD NBIS]Item102+"-"+◊sCR+◊sLFEnd if If (Length([Bridge MHD NBIS]Item107)<1)$et:=$et+"107 < 1 : -"+[Bridge MHD NBIS]Item107+"-"+◊sCR+◊sLFEnd if If (Length([Bridge MHD NBIS]Item108A)<1)$et:=$et+"108A < 1 : -"+[Bridge MHD NBIS]Item108A+"-"+◊sCR+◊sLFEnd if If (Length([Bridge MHD NBIS]Item108B)<1)$et:=$et+"108B < 1 : -"+[Bridge MHD NBIS]Item108B+"-"+◊sCR+◊sLFEnd if If (Length([Bridge MHD NBIS]Item108C)<1)$et:=$et+"108C < 1 : -"+[Bridge MHD NBIS]Item108C+"-"+◊sCR+◊sLFEnd if If (Length($Item113)<1)$et:=$et+"113 < 1 : -"+$Item113+"-"+◊sCR+◊sLFEnd if If ($et#"")SEND PACKET($dErrFile;("Item Length Errors found for BIN : "+[Bridge MHD NBIS]BIN+◊sCR+◊sLF))SEND PACKET($dErrFile;("(Item) < (Required Length) : -(Actual Item Value)- "+◊sCR+◊sLF))SEND PACKET($dErrFile;$et)End if SEND PACKET($dErrFile;$t)$l:=$l+1Else $et:=SIA_DataCheck If ($et#"")SEND PACKET($dErrFile;("DATA CHECK Errors found for BIN : "+[Bridge MHD NBIS]BIN+◊sCR+◊sLF))SEND PACKET($dErrFile;$et)SEND PACKET($dErrFile;$t)$l:=$l+1Else SEND PACKET($dExportFile;$t)$k:=$k+1End if End if   `Check to see if there is a secondary recordRELATE MANY([Bridge MHD NBIS])FIRST RECORD([NBIS Secondary])For ($j;1;Records in selection([NBIS Secondary]))$Item6A:=" "*24$Item6A:=Change string($Item6A;[NBIS Secondary]Item6A;1)If ([NBIS Secondary]Item6B=True)$Item6B:="*"Else $Item6B:=" "End if $Item7:=" "*18$Item7:=Change string($Item7;[NBIS Secondary]Item7;1)$Item9:=" "*25$Item9:=Change string($Item9;[NBIS Secondary]Item9;1)$Item10:=String([NBIS Secondary]Item10*100;"0000")$Item11:=String([NBIS Secondary]Item11*1000;"0000000")$Item16:=String([NBIS Secondary]Item16A;"00")+String([NBIS Secondary]Item16B;"00")+String([NBIS Secondary]Item16C*100;"0000")$Item17:=String([NBIS Secondary]Item17A;"000")+String([NBIS Secondary]Item17B;"00")+String([NBIS Secondary]Item17C*100;"0000")$Item19:=String([NBIS Secondary]Item19;"000")$Item27:=String([NBIS Secondary]Item27;"0000")$Item28:=String([NBIS Secondary]Item28A;"00")+String([NBIS Secondary]Item28B;"00")$Item29:=String([NBIS Secondary]Item29;"000000")$Item30:=String([NBIS Secondary]Item30;"0000")$Item47:=String([NBIS Secondary]Item47*10;"000")$Item48:=String([NBIS Secondary]Item48*10;"00000")$Item49:=String([NBIS Secondary]Item49*10;"000000")If ([NBIS Secondary]Item103=True)$Item103:="T"Else $Item103:=" "End if If ([NBIS Secondary]Item104=True)$Item104:="1"Else $Item104:="0"End if $Item109:=String([NBIS Secondary]Item109;"00")If ([NBIS Secondary]Item110=True)$Item110:="1"Else $Item110:="0"End if $t:="251"+$item8_txt+[NBIS Secondary]Item5+(" "*2)$t:=$t+[NBIS Secondary]Item3+[NBIS Secondary]Item4+$Item6A+$Item6B+$Item7$t:=$t+$Item9+$Item10+$Item11+(" "*13)$t:=$t+$Item16+$Item17+$Item19+[NBIS Secondary]Item20+(" "*4)$t:=$t+[NBIS Secondary]Item26+$Item27+$Item28+$Item29+$Item30+(" "*5)$t:=$t+(" "*8)$t:=$t+(" "*12)+[NBIS Secondary]Item42$t:=$t+[NBIS Secondary]Item43+(" "*10)+$Item47+$Item48+$Item49$t:=$t+(" "*127)$t:=$t+[NBIS Secondary]Item100+[NBIS Secondary]Item101+[NBIS Secondary]Item102+$Item103+$Item104$t:=$t+(" "*9)$t:=$t+$Item109+$Item110+(" "*17)+$fill+◊sCR+◊sLFIf (Length($t)#434)  `Includes CR and LF  ` ALERT("Data length not 434 for BIN Secondary Record "+[NBIS Secondary]BIN+  `" (="+String(Length($t))+")."+(2*◊sCR)+"Export aborted.")  ` UNLOAD RECORD([NBIS Secondary])  `CLOSE DOCUMENT($dExportFile)  ` Do some data checks and export error message to error file.    $et:=""If (Length([NBIS Secondary]Item20)<1)$et:=$et+"20 < 1 : -"+[NBIS Secondary]Item20+"-"+◊sCR+◊sLFEnd if If (Length([NBIS Secondary]Item26)<2)$et:=$et+"26 < 2 : -"+[NBIS Secondary]Item26+"-"+◊sCR+◊sLFEnd if If (Length([NBIS Secondary]Item42)<2)$et:=$et+"42 < 2 : -"+[NBIS Secondary]Item42+"-"+◊sCR+◊sLFEnd if If (Length([NBIS Secondary]Item43)<3)$et:=$et+"43 < 3 : -"+[NBIS Secondary]Item43+"-"+◊sCR+◊sLFEnd if If (Length([NBIS Secondary]Item100)<1)$et:=$et+"100 < 1 : -"+[NBIS Secondary]Item100+"-"+◊sCR+◊sLFEnd if If (Length([NBIS Secondary]Item101)<1)$et:=$et+"101 < 1 : -"+[NBIS Secondary]Item101+"-"+◊sCR+◊sLFEnd if If (Length([NBIS Secondary]Item102)<1)$et:=$et+"102 < 1 : -"+[NBIS Secondary]Item102+"-"+◊sCR+◊sLFEnd if If ($et#"")SEND PACKET($dErrFile;("Errors found for Secondary BIN : "+[Bridge MHD NBIS]BIN+◊sCR+◊sLF))SEND PACKET($dErrFile;$et)End if SEND PACKET($dErrFile;$t)$l:=$l+1  `ABORTElse SEND PACKET($dExportFile;$t)$k:=$k+1End if NEXT RECORD([NBIS Secondary])End for NEXT RECORD([Bridge MHD NBIS])If ($k%$Interval=0)  `Don't slow down things just to displayUpdateProgress ($i;$Recs)End if   ` check to see if aborted from the Progress windowIf (◊Abort)$i:=$Recs+1End if End for CALL PROCESS(◊ProgressPID)CLOSE DOCUMENT($dExportFile)CLOSE DOCUMENT($dErrFile)ALERT(String($k;"##,##0")+" total records (primary & secondary) exported successfully to "+$vsOutputFolder+$NBfile)If ($l>0)ALERT(String($l;"##,##0")+" total records (primary & secondary) with errors placed in "+$vsOutputFolder+$NBErrfile)ut_OpenDocument ($vsOutputFolder+$NBErrfile)End if End if End if   `NO TRACE