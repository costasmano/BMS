  ` ----------------------------------------------------  ` Method: ARCHIVE_OutOfFreq  ` Description  ` Copied from M_InspSchedule  ` **************  `  N O T    I M P L E M E N T E D     Y E T   !!!!!!!!!  `  FUNCTIONS  fCombineInsp fUpforInsp fCombineUWInsp DO NOT WORK WITH THE ARCHIVE TABLE !!!!!!!!!  ` **************If (False)  ` ----------------------------------------------------  ` User name (OS): costasmanousakis  ` User name (4D): Designer  ` Date and time: 10/24/11, 12:02:46  ` First ReleaseMods_2011_10 End if If (False)  `GP: M_inspSchedule  `Copyright © 1995-1996,  Albert S. Leung, All Rights Reserved.Mods_2004_CM11   ` Modified by: costasmanousakis-(Designer)-(4/4/08 17:00:33)Mods_2008_CM_5403   `Apply sortMods_2009_03   `CJM  r001   `03/06/09, 12:55:45`Upgrade from open form window to open window  ` Modified by: costasmanousakis-(Designer)-(12/30/09 12:47:49)Mods_2009_12   `  ` Include NonNfCombineUWInspBI bridges needing inspections - added var o8=UW routine, o9=UWSpec -  `  ` use new method fCombineUWInsp ;  `  ` Added var SIA_INSPECTIONMONTH_d to be used in a quick report when using SIA_NextInspDateEnd if C_INTEGER($t)C_INTEGER($leeway)C_BOOLEAN($Waive)C_DATE($d)C_INTEGER($Month)C_INTEGER($Year)C_LONGINT($tempwin)C_INTEGER(n1;n2;n3;n4;o1;o2;o3;o4;o5;o6;o7;o8;o9;p1;p2;p3)C_INTEGER(CB_NBI;CBComplexBrg;CBWaiver)  `CENTER_WINDOW (420;340;4)  `Run it only if we have single Reason and DateARRAY TEXT($Reasons_atxt;0)ARRAY DATE($ReasonDates_ad;0)DISTINCT VALUES([BridgeMHDNBISArchive]ArchiveReason_s;$Reasons_atxt)DISTINCT VALUES([BridgeMHDNBISArchive]ArchiveDate_d;$ReasonDates_ad)If (Size of array($Reasons_atxt)#1) | (Size of array($ReasonDates_ad)#1)C_TEXT($Ermsg_txt)$Ermsg_txt:="This can only work if there is a single set of Archived records! There are "$Ermsg_txt:=$Ermsg_txt+String(Size of array($Reasons_atxt))+" different archive reasons and "$Ermsg_txt:=$Ermsg_txt+String(Size of array($ReasonDates_ad))+" different dates!"ALERT($Ermsg_txt)Else C_LONGINT($Width_l;$Height_l;$Win_l;$Pages_l)C_BOOLEAN($FixedWidth_b;$FixedHeight_b)C_TEXT($Title_txt)GET FORM PROPERTIES([Dialogs];"InspDialog1";$Width_l;$Height_l;$Pages_l;$FixedWidth_b;$FixedHeight_b;$Title_txt)$Win_l:=ut_OpenNewWindow ($Width_l;$Height_l;0;4;$Title_txt;"ut_CloseCancel")  `$tempwin:=Open form window([Dialogs];"InspDialog1";4)DIALOG([Dialogs];"InspDialog1")CLOSE WINDOW($Win_l)C_DATE(SIA_INSPECTIONMONTH_d)SIA_INSPECTIONMONTH_d:=!00/00/00!If (Ok=1)  `Get current date from server$d:=Date(Request("Enter Effective date";String($ReasonDates_ad{1})))$Month:=Month of($d)$Year:=Year of($d)$Waive:=(CBWaiver=1)  `Fix scopeCase of : (n1=1)  `Get any bridge      : (n2=1)  `Get State BridgesALERT("Wiil Not Search for State Bridges! Search must be performed before this method is"+" called!")  `QUERY SELECTION BY FORMULA([BridgeMHDNBISArchive];fStateBridge ): (n3=1)  `Get State or NBI BridgesALERT("Wiil Not Search for State or NBI Bridges! Search must be performed before this me"+"thod is"+" called!")  `QUERY SELECTION BY FORMULA([BridgeMHDNBISArchive];(fStateBridge  | [BridgeMHDNBISArchive]FHWARecord)): (n4=1)  `Get Town and MUN BridgesALERT("Wiil Not Search for Town and MUN Bridges! Search must be performed before this me"+"thod is"+" called!")  `QUERY SELECTION BY FORMULA([BridgeMHDNBISArchive];fMUNBridge )  `      QUERY SELECTION BY FORMULA([BridgeMHDNBISArchive];fMUNBridge  | fTWNBridge ): (n4=1)  `Get MUN BridgesALERT("Wiil Not Search for MUN Bridges! Search must be performed before this method is"+" called!")  `QUERY SELECTION BY FORMULA([BridgeMHDNBISArchive];fMUNBridge ): (n5=1)  `Get TWN BridgesALERT("Wiil Not Search for Town Bridges! Search must be performed before this method is"+" called!")  `QUERY SELECTION BY FORMULA([BridgeMHDNBISArchive];([BridgeMHDNBISArchive]Item8 Owner="MUN"))End case CREATE EMPTY SET([BridgeMHDNBISArchive];"SCHEDINSPREQDSET")If (CBInspReqd=1)SET QUERY DESTINATION(Into set ;"SCHEDINSPREQDSET")QUERY SELECTION([BridgeMHDNBISArchive];[BridgeMHDNBISArchive]InspRequired=True)SET QUERY DESTINATION(Into current selection )End if If (CB_NBI=1)QUERY SELECTION([BridgeMHDNBISArchive];[BridgeMHDNBISArchive]FHWARecord=True)End if If (CBComplexBrg=1)QUERY SELECTION([BridgeMHDNBISArchive];[BridgeMHDNBISArchive]Complex Bridge=True)End if If (Records in set("SCHEDINSPREQDSET")>0)CREATE SET([BridgeMHDNBISArchive];"SCHEDINSPECTIONS")UNION("SCHEDINSPECTIONS";"SCHEDINSPREQDSET";"SCHEDINSPECTIONS")USE SET("SCHEDINSPECTIONS")CLEAR SET("SCHEDINSPECTIONS")End if CLEAR SET("SCHEDINSPREQDSET")  `Determine inspection typeCase of : (o1=1)  `Combined inspection$t:=7: (o2=1)  `Routine inspection$t:=1: (o3=1)  `Fracture critical inspection$t:=2: (o4=1)  `Other special inspection$t:=3: (o5=1)  `Critical Member$t:=4: (o6=1)  `Closed bridge$t:=5: (o7=1)  `Combined UW Underwater$t:=6End case Case of : (p1=1)  `Out of frequencyCENTER_WINDOW (220;250;4)DIALOG([Dialogs];"InspDialog3")CLOSE WINDOW$leeway:=vLeewayIf (Ok=1)QUERY SELECTION BY FORMULA([BridgeMHDNBISArchive];ARCHIVE_fOutOfFreq ($t;$leeway;$Waive;$d))End if : (p2=1)  `This month's inspectionALERT("This Method work only for Out of Frequency checks. !!")If (False)SIA_INSPECTIONMONTH_d:=Date(String($Month)+"/1/"+String($Year))Case of : ($t=7)QUERY SELECTION BY FORMULA([BridgeMHDNBISArchive];fCombineInsp ($Year;$Month;0;0;$Waive)): ($t=6)QUERY SELECTION BY FORMULA([BridgeMHDNBISArchive];fCombineUWInsp ($Year;$Month;0;0;$Waive))Else QUERY SELECTION BY FORMULA([BridgeMHDNBISArchive];fUpforInsp ($Year;$Month;0;0;$t;$Waive))End case End if : (p3=1)  `User specified inspection      ALERT("This Method work only for Out of Frequency checks. !!")If (False)CENTER_WINDOW (260;200;4)DIALOG([Dialogs];"InspDialog2")CLOSE WINDOWIf (Ok=1)$Year:=vYear$Month:=aMonthsSIA_INSPECTIONMONTH_d:=Date(String($Month)+"/1/"+String($Year))If (CBwholeyear=1)$Month:=0SIA_INSPECTIONMONTH_d:=Date("1/1/"+String($Year))End if Case of : ($t=7)QUERY SELECTION BY FORMULA([BridgeMHDNBISArchive];fCombineInsp ($Year;$Month;0;0;$Waive)): ($t=6)QUERY SELECTION BY FORMULA([BridgeMHDNBISArchive];fCombineUWInsp ($Year;$Month;0;0;$Waive))Else QUERY SELECTION BY FORMULA([BridgeMHDNBISArchive];fUpforInsp ($Year;$Month;0;0;$t;$Waive))End case End if End if End case   ` End if End if 