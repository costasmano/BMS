If (False)  ` ----------------------------------------------------  ` PRINT_ROUTINE_F  ` User name (OS): cjmiller  ` Date and time: 03/29/05, 16:02:54  ` ----------------------------------------------------  ` Description  `   `  ` Parameters  ` ----------------------------------------------------  `GP: PRINT_ROUTINE_F  `Copyright © 1995-1996,  Albert S. Leung, All Rights Reserved.Mods_2004_CM01 Mods_2005_CM06 Mods_2005_CJM02   `03/29/05, 16:02:48Mods_2007_CM04   ` Modified by: costasmanousakis-(Designer)-(1/8/2007 13:55:13)Mods_2007_CM02   ` Modified by: costasmanousakis-(Designer)-(1/26/2007 11:06:29)Mods_2007_CM05a   ` Modified by: costasmanousakis-(Designer)-(4/13/2007 16:26:17)Mods_2007_CM07   ` Modified by: costasmanousakis-(Designer)-(9/12/2007 11:19:20)Mods_2007_CM12_5301 Mods_2009_03   `CJM  r001   `03/06/09, 13:03:39`Upgrade from open form window to open window  ` Modified by: costasmanousakis-(Designer)-(12/10/09 08:28:21)Mods_2009_12   `Use method INSP_PRINTPontis  ` Modified by: costasmanousakis-(Designer)-(1/19/11 08:50:57)Mods_2011_01 Mods_2012_09   `r001 `Add compiler method Compiler_InspReports  `Modified by: Charles Miller (9/13/12 15:15:56)  `` RR  ` Modified by: Costas Manousakis-(Designer)-(9/14/12 15:42:18)Mods_2012_09   `  `moved 2nd G_PrintOptions call after the 2nd  If (OK=1)  `user can cancel from the print settings  Mods_2012_12   `r001 ` More changes for new inspection types  `Modified by: Charles Miller (12/4/12 13:45:04)End if C_STRING(255;$oldWinTitle;$newWinTitle;$prevSpoolDocName)C_LONGINT($FormWindow)INSP_PRN_InitVars   `2005-01-04 ASL  `Guarantee this.SET PRINT PREVIEW(False)  `This creates a job name for the print jobs to follow$oldWinTitle:=Get window title$newWinTitle:="Routine Inspection "+[Bridge MHD NBIS]BIN+" "SET WINDOW TITLE($newWinTitle)  `added call to font setup - Oct-2002G_SetInspFont G_InitInspVars sInspDATE:=Uppercase(String([Inspections]Insp Date;Internal date abbreviated ))  `Save the current selection of safety elements and imagesCUT NAMED SELECTION([ElementsSafety];"Temp_PR_RTN_ELMTS")CUT NAMED SELECTION([Standard Photos];"Temp_PR_RTN_IMGS")  `1st pass is done to figure out total number of pages....PrintFlag:=FalsevPrintPhotos:=0  `these are needed to initialize variables used in Print photos methodvPrintSketches:=0vPrintCharts:=0vPrintSpMemPgs:=0G_CountRTNInspPgs   ` this updates selectionsbCmtsFlag:=(viNumCmtsPgs>0)  `found comments bSketchFlag:=(viNumSkPgs>0)bChartFlag:=(viNumChPgs>0)bPhotoFlag:=(viNumPhPgs>0)bSpecMemPgsFlag:=(viNumSpMPages>0)bInvPhotoFlag:=([Inspections]InitialInsp)  `chng.2007..ARRAY DATE(aInvPhotoDate_aD;0)If (bInvPhotoFlag)READ ONLY([InventoryPhotoInsp])QUERY([InventoryPhotoInsp];[InventoryPhotoInsp]BIN=[Inspections]BIN)SELECTION TO ARRAY([InventoryPhotoInsp]InvPhotoDate_D;aInvPhotoDate_aD)If (Size of array(aInvPhotoDate_aD)>0)SORT ARRAY(aInvPhotoDate_aD;<)INSERT IN ARRAY(aInvPhotoDate_aD;1;1)Else bInvPhotoFlag:=FalseEnd if Else End if bPontisFlag:=([Combined Inspections]BMSInspID>0)  ` get/update total number of pages for report and choose what is to be printedC_LONGINT($Width_l;$Height_l;$Win_l;$Pages_l)C_BOOLEAN($FixedWidth_b;$FixedHeight_b)C_TEXT($Title_txt)GET FORM PROPERTIES([Dialogs];"PrintInspRpt2";$Width_l;$Height_l;$Pages_l;$FixedWidth_b;$FixedHeight_b;$Title_txt)$Win_l:=ut_OpenNewWindow ($Width_l;$Height_l;0;Plain form window ;$Title_txt;"ut_CloseCancel")  `$FormWindow:=Open form window([Dialogs];"PrintInspRpt2")DIALOG([Dialogs];"PrintInspRpt2")CLOSE WINDOW($Win_l)If (OK=1)If (vPrintPreview=1)SET PRINT PREVIEW(True)ON ERR CALL("G_PrintError")  `Set error handler for quiting from PreviewEnd if   `PAGE SETUP([Inspections];"Dive Pr Pg 1")G_PrintOptions If (◊ShowPrint)PRINT SETTINGSEnd if If (OK=1)  `user can cancel from the print settings  G_PrintOptions BRING TO FRONT(Current process)  ` 1st  and second page  `initialize Page NumbervPageNo:=2GET PRINT OPTION(Spooler document name option ;$prevSpoolDocName)  `SET PRINT OPTION(Spooler document name option ;"Routine-"+[Inspections]BIN+"-"+St  `ring([Inspections]Insp Date))  `MODS_XXXX_CMIf (vPrintPage1=1)Case of : ([Inspections]Insp Type="RTN")Print form([Inspections];"Routine Pr Pg 1"): ([Inspections]Insp Type="RRR")Print form([Inspections];"RailRoutinePrPg1"): ([Inspections]Insp Type="RTA")Print form([Inspections];"Routine Arch Pr Pg 1"): ([Inspections]Insp Type="PED")Print form([Inspections];"PedBridge_p1"): ([Inspections]Insp Type="RRA")Print form([Inspections];"RailRoutine Arch Pr Pg 1")End case If ((vPrintPage2=1) | (vPrintSpMemPgs=1))  `MODS_XXXX_CM  `PAGE BREAK(>)`MODS_XXXX_CMElse   `PAGE BREAK(>)End if End if If ((vPrintPage2=1) & (viInspPreviewErr=0))PAGE BREAK(>)  `MODS_XXXX_CMCase of : ([Inspections]Insp Type="RRR")Print form([Inspections];"RailRoutinePrPg2"): ([Inspections]Insp Type="PED")Print form([Inspections];"PedBridge_p2"): ([Inspections]Insp Type="RRA")Print form([Inspections];"RailRoutine Arch Pr Pg 2"): ([Inspections]Insp Date<=◊InspFormRevDate_4)Print form([Inspections];"Routine Pr Pg 2")Else Print form([Inspections];"RoutinePrPg2_v2")End case If ((vPrintSpMemPgs=1) & (viInspPreviewErr=0))  `MODS_XXXX_CM  `PAGE BREAK(>)Else   `PAGE BREAK(>)End if End if If ((vPrintSpMemPgs=1) & (viInspPreviewErr=0))  `PAGE BREAK(>)`MODS_XXXX_CMPrint_SpecMem_pg3 End if vPageNo:=viCmtsPgStart-1  `Comments pagesIf ((vPrintCmts=1) & (Ok=1) & (viInspPreviewErr=0))PrintFlag:=TrueviNumCmtsPgs:=Print_RTN_Cmts   ` need to call it to set page numbers straightElse vPageNo:=viCmtsPgStart+viNumCmtsPgs-1End if   `print photo pagesIf (((vPrintPhotos=1) | (vPrintSketches=1) | (vPrintCharts=1)) & (viInspPreviewErr=0))PrintFlag:=TruePrint_Dive_photos Else vPageNo:=2+viNumSpMPages+viNumCmtsPgs+viNumSkPgs+viNumChPgs+viNumPhPgsEnd if   `Print inventory photoIf (vPrintInvPhotos=1)SET AUTOMATIC RELATIONS(False;False)QUERY([InventoryPhotoInsp];[InventoryPhotoInsp]BIN=[Inspections]BIN)QUERY SELECTION([InventoryPhotoInsp];[InventoryPhotoInsp]InvPhotoDate_D=aInvPhotoDate_aD{aInvPhotoDate_aD})If (Records in selection([InventoryPhotoInsp])=1)QUERY([InventoryPhotos];[InventoryPhotos]InvPhotoInsp_ID=[InventoryPhotoInsp]InvPhotoInspID_L)ORDER BY([InventoryPhotos];[InventoryPhotos]Sequence_I;>;[InventoryPhotos]PhotoDescr_txt;>)INV_PrintInvInsp (True)  `Bypass setting print settings in the methodEnd if   `SET AUTOMATIC RELATIONS(True;True)End if   `Print SI&A normal  If ((vPrintSIA=1) & (viInspPreviewErr=0))INSP_PrintSIA End if   `send a last page break to spool the jobC_BOOLEAN($vbLastbreak)$vbLastbreak:=((vPrintPage1=1) | (vPrintPage2=1) | (vPrintSpMemPgs=1) | (vPrintCmts=1))$vbLastbreak:=$vbLastbreak | ((vPrintSketches=1) | (vPrintCharts=1) | (vPrintPhotos=1) | (vPrintSIA=1))If ($vbLastbreak)PAGE BREAKEnd if INSP_PRINTPontis If (vPrintPreview=1)SET PRINT PREVIEW(False)End if   `SET PRINT OPTION(Spooler document name option ;$prevSpoolDocName)  `MODS_XXXX_CMEnd if End if ON ERR CALL("")  `reset the error handlerUSE NAMED SELECTION("Temp_PR_RTN_ELMTS")USE NAMED SELECTION("Temp_PR_RTN_IMGS")SET WINDOW TITLE($oldWinTitle)