If (False)ÊÊ`G_Insp_SetPersUI ÊÊ`general method to set the arrays and variablesÊÊ`for popup/popdown buttons for Personnel and inspectionÊÊ`agency in inspection input forms.Mods_2005_CM06 Mods_2005_CM08 Mods_2005_CM12 ÊÊ` Modified by: costasmanousakis-(Designer)-(12/16/2005 11:32:44)Mods_2005_CM20 ÊÊ` Modified by: costasmanousakis-(Designer)-(4/18/2006 15:14:20)Mods_2006_CMy2 ÊÊ` Modified by: costasmanousakis-(Designer)-(2/27/09 10:23:30)Mods_2009_CM_5404 ÊÊ`When there is no team leader - will make the current person the team leaderÊÊ` Modified by: Costas Manousakis-(Designer)-(2/20/14 10:51:28)Mods_2014_02_bug ÊÊ`ÊÊ`added call to set the tunnel and proj mgr for Tunnel inspectionsEnd if C_INTEGER($i;$j;$k)C_STRING(80;$vstestUser;$vsUserName;$vsMyEmployer;$vsDivNo)C_INTEGER($viMyPersID)READ ONLY([Personnel])QUERY([Personnel];[Personnel]UserID_4D=×CurrentUser_UID)If (Records in selection([Personnel])#1)$vsUserName:=Current user$vstestUser:=Replace string($vsUserName;" ";"@")$i:=Find in array(aPeople;$vstestUser)If ($i>0)$j:=aPeople_ID{$i}Else $j:=-1End if QUERY([Personnel];[Personnel]Person ID=$j)End if If (Records in selection([Personnel])=1)LOAD RECORD([Personnel])$vsMyEmployer:=[Personnel]Employer$viMyPersID:=[Personnel]Person IDElse $vsMyEmployer:=""$viMyPersID:=0End if INSP_CheckLinks If (Is record loaded([BMS Inspections]))QUERY([BMS Field Trip];[BMS Field Trip]Inspection ID=[BMS Inspections]Inspection ID)End if QUERY([Field Trip];[Field Trip]InspID=[Inspections]InspID)Case of : ([Bridge MHD NBIS]InspResp="DIST@")$vsDivNo:="044"+Substring([Bridge MHD NBIS]InspResp;5;1): ([Bridge MHD NBIS]InspResp="MDC@")$vsDivNo:="DCR": ([Bridge MHD NBIS]InspResp="MBTA@")$vsDivNo:="MBTA": ([Bridge MHD NBIS]InspResp="MTA@")$vsDivNo:="MTA"Else $vsDivNo:="044"+String(Num([Bridge MHD NBIS]Item2))End case Case of : ([Inspections]Insp Type#"PON")If (([Inspections]DBrInspEngr=0)Ê&ÊNot(vbInspectionLocked))ÊÊ`This is a new record.    QUERY([Personnel];[Personnel]Job Code=1;*)QUERY([Personnel];Ê&Ê;[Personnel]Active=True;*)QUERY([Personnel];Ê&Ê;[Personnel]Division No=$vsDivNo)If (Records in selection([Personnel])=1)[Inspections]DBrInspEngr:=[Personnel]Person IDIf (Substring(×Version;1;(Position(" ";×Version)-1))<×LNK_CHANGE_Vers)PushChange (1;->[Inspections]DBrInspEngr)Else LogLink (->[Inspections]DBrInspEngr;->[Bridge MHD NBIS]BIN;->[Inspections]BIN;->[Inspections]InspID;1;->[Personnel]Person ID)End if POPUPMENUC (->aBIE;->aBIE_ID;->[Inspections]DBrInspEngr)If (Is record loaded([BMS Inspections]))[BMS Inspections]DBrInspEngr:=[Personnel]Person IDIf (Substring(×Version;1;(Position(" ";×Version)-1))<×LNK_CHANGE_Vers)PushChange (3;->[BMS Inspections]DBrInspEngr)Else LogLink (->[BMS Inspections]DBrInspEngr;->[Bridge MHD NBIS]BIN;->[BMS Inspections]BIN;->[BMS Inspections]Inspection ID;1;->[Personnel]Person ID)End if SAVE RECORD([BMS Inspections])End if End if End if $k:=Find in array(aPeople_ID;[Inspections]DBrInspEngr)If ($k>0)vBIE:=aPeople{$k}Else If ([Inspections]DBrInspEngr>0)vBIE:="UnKnown Insp. Engineer"Else vBIE:="Select Insp. Engineer"End if End if ÊÊ`Set up the Agency display variable.If (([Inspections]Agency="")Ê&ÊNot(vbInspectionLocked))Case of : ($vsMyEmployer#"")[Inspections]Agency:=$vsMyEmployer: ([Bridge MHD NBIS]InspResp="DIST@")[Inspections]Agency:="Mass. Highway Dept.": ([Bridge MHD NBIS]InspResp="MDC@")[Inspections]Agency:="DCR": ([Bridge MHD NBIS]InspResp="MBTA@")[Inspections]Agency:="MBTA": ([Bridge MHD NBIS]InspResp="MTA@")[Inspections]Agency:="MTA"Else [Inspections]Agency:=""End case PushChange (1;->[Inspections]Agency)POPUPMENUC (->aAgency;->aAgency;->[Inspections]Agency)If (Is record loaded([BMS Inspections]))[BMS Inspections]Agency:=[Inspections]AgencyPushChange (3;->[BMS Inspections]Agency)SAVE RECORD([BMS Inspections])End if End if If (([Inspections]Agency="MDC")Ê&ÊNot(vbInspectionLocked))Case of : ($vsMyEmployer#"")[Inspections]Agency:=$vsMyEmployer: ([Bridge MHD NBIS]InspResp="DIST@")[Inspections]Agency:="Mass. Highway Dept.": ([Bridge MHD NBIS]InspResp="MDC@")[Inspections]Agency:="DCR": ([Bridge MHD NBIS]InspResp="MBTA@")[Inspections]Agency:="MBTA": ([Bridge MHD NBIS]InspResp="MTA@")[Inspections]Agency:="MTA"Else [Inspections]Agency:=""End case PushChange (1;->[Inspections]Agency)POPUPMENUC (->aAgency;->aAgency;->[Inspections]Agency)If (Is record loaded([BMS Inspections]))[BMS Inspections]Agency:=[Inspections]AgencyPushChange (3;->[BMS Inspections]Agency)SAVE RECORD([BMS Inspections])End if End if ÊÊ`Set up the team leader and team member arrays.vAgency:=[Inspections]AgencyInitPers ([Inspections]Agency)If (([Inspections]TeamLeader=0)Ê&ÊNot(vbInspectionLocked))If ($viMyPersID>0)[Inspections]TeamLeader:=$viMyPersIDLogLink (->[Inspections]TeamLeader;->[Bridge MHD NBIS]BIN;->[Inspections]BIN;->[Inspections]InspID;1;->[Personnel]Person ID)[Inspections]DateModified:=Current datePushChange (1;->[Inspections]DateModified)If ([BMS Inspections]Inspection ID>0)[BMS Inspections]TeamLeader:=[Inspections]TeamLeader[BMS Inspections]DateModified:=[Inspections]DateModifiedLogLink (->[BMS Inspections]TeamLeader;->[Bridge MHD NBIS]BIN;->[BMS Inspections]BIN;->[BMS Inspections]Inspection ID;1;->[Personnel]Person ID)PushChange (3;->[BMS Inspections]DateModified)SAVE RECORD([BMS Inspections])End if End if End if ÊÊ`InitPers recreates the Team Leader array; reset it.  aTeamLeader:=Find in array(aTeamLdrID;[Inspections]TeamLeader)If (aTeamLeader<=0)ÊÊ`Just in case nothing was found in arrayaTeamLeader:=0End if $k:=Find in array(aPeople_ID;[Inspections]TeamLeader)If ($k>0)vTmLeader:=aPeople{$k}Else If ([Inspections]TeamLeader>0)vTmLeader:="UnKnown Team Leader"Else vTmLeader:="Select Team Leader"End if End if INSP_BuildTmMbrArea ÊÊ`Make sure [BMS Inspection] has same Personnel as [Inspection] recIf (([Combined Inspections]BMSInspID>0)Ê&ÊNot(vbInspectionLocked))ÊÊ`[Bms Inspection] record should be loaded already... but..If ([BMS Inspections]Agency#[Inspections]Agency)[BMS Inspections]Agency:=[Inspections]AgencyPushChange (3;->[BMS Inspections]Agency)SAVE RECORD([BMS Inspections])End if If ([BMS Inspections]DBrInspEngr#[Inspections]DBrInspEngr)[BMS Inspections]DBrInspEngr:=[Inspections]DBrInspEngrIf (Substring(×Version;1;(Position(" ";×Version)-1))<×LNK_CHANGE_Vers)PushChange (3;->[BMS Inspections]DBrInspEngr)Else LogLink (->[BMS Inspections]DBrInspEngr;->[Bridge MHD NBIS]BIN;->[BMS Inspections]BIN;->[BMS Inspections]Inspection ID;1;->[Personnel]Person ID)End if SAVE RECORD([BMS Inspections])End if If ([BMS Inspections]TeamLeader#[Inspections]TeamLeader)[BMS Inspections]TeamLeader:=[Inspections]TeamLeaderIf (Substring(×Version;1;(Position(" ";×Version)-1))<×LNK_CHANGE_Vers)PushChange (3;->[BMS Inspections]TeamLeader)Else LogLink (->[BMS Inspections]TeamLeader;->[Bridge MHD NBIS]BIN;->[BMS Inspections]BIN;->[BMS Inspections]Inspection ID;1;->[Personnel]Person ID)End if SAVE RECORD([BMS Inspections])End if ARRAY INTEGER(aBMSInspTeamID;0)ARRAY INTEGER(aNBIInspTeamID;0)SELECTION TO ARRAY([BMS Field Trip]Person ID;aBMSInspTeamID)SELECTION TO ARRAY([Field Trip]Person ID;aNBIInspTeamID)CREATE EMPTY SET([BMS Field Trip];"FieldTripstobeDel")C_INTEGER($i;$k)For ($i;1;Size of array(aBMSInspTeamID))$k:=Find in array(aNBIInspTeamID;aBMSInspTeamID{$i})If ($k<=0)GOTO SELECTED RECORD([BMS Field Trip];$i)LOAD RECORD([BMS Field Trip])LogDeletion (->[BMS Inspections]Inspection ID;->[BMS Field Trip]Inspection ID;->[BMS Field Trip]Person ID;3;->[Personnel]Person ID)ADD TO SET([BMS Field Trip];"FieldTripstobeDel")End if End for If (Records in set("FieldTripstobeDel")>0)USE SET("FieldTripstobeDel")DELETE SELECTION([BMS Field Trip])End if CLEAR SET("FieldTripstobeDel")For ($i;1;Size of array(aNBIInspTeamID))$k:=Find in array(aBMSInspTeamID;aNBIInspTeamID{$i})If ($k<=0)CREATE RECORD([BMS Field Trip])[BMS Field Trip]Inspection ID:=[BMS Inspections]Inspection ID[BMS Field Trip]Person ID:=aNBIInspTeamID{$i}LogNewRecord (->[BMS Inspections]Inspection ID;->[BMS Field Trip]Inspection ID;->[BMS Field Trip]Person ID;3;"";->[Personnel]Person ID)SAVE RECORD([BMS Field Trip])End if End for ÊÊ`re-load Field trip records      QUERY([BMS Field Trip];[BMS Field Trip]Inspection ID=[BMS Inspections]Inspection ID)End if If ([Inspections]Insp Type="T@")ÊÊ`Tunnel InspectionsINSP_ConsProjMgr_OM INSP_DIE_OM End if : ([Inspections]Insp Type="PON")If (([BMS Inspections]DBrInspEngr=0)Ê&ÊNot(vbInspectionLocked))ÊÊ`This is a new record.    QUERY([Personnel];[Personnel]Job Code=1;*)QUERY([Personnel];Ê&Ê;[Personnel]Active=True;*)QUERY([Personnel];Ê&Ê;[Personnel]Division No=$vsDivNo)If (Records in selection([Personnel])=1)[BMS Inspections]DBrInspEngr:=[Personnel]Person IDIf (Substring(×Version;1;(Position(" ";×Version)-1))<×LNK_CHANGE_Vers)PushChange (3;->[BMS Inspections]DBrInspEngr)Else LogLink (->[BMS Inspections]DBrInspEngr;->[Bridge MHD NBIS]BIN;->[BMS Inspections]BIN;->[BMS Inspections]Inspection ID;1;->[Personnel]Person ID)End if SAVE RECORD([BMS Inspections])POPUPMENUC (->aBIE;->aBIE_ID;->[BMS Inspections]DBrInspEngr)If (Is record loaded([Inspections]))[Inspections]DBrInspEngr:=[Personnel]Person IDIf (Substring(×Version;1;(Position(" ";×Version)-1))<×LNK_CHANGE_Vers)PushChange (1;->[Inspections]DBrInspEngr)Else LogLink (->[Inspections]DBrInspEngr;->[Bridge MHD NBIS]BIN;->[Inspections]BIN;->[Inspections]InspID;1;->[Personnel]Person ID)End if End if End if End if $k:=Find in array(aPeople_ID;[BMS Inspections]DBrInspEngr)If ($k>0)vBIE:=aPeople{$k}Else vBIE:="Select Insp. Engineer"End if ÊÊ`Set up the Agency display variable.If (([BMS Inspections]Agency="")Ê&ÊNot(vbInspectionLocked))Case of : ($vsMyEmployer#"")[BMS Inspections]Agency:=$vsMyEmployer: ([Bridge MHD NBIS]InspResp="DIST@")[BMS Inspections]Agency:="Mass. Highway Dept.": ([Bridge MHD NBIS]InspResp="MDC@")[BMS Inspections]Agency:="DCR": ([Bridge MHD NBIS]InspResp="MBTA@")[BMS Inspections]Agency:="MBTA": ([Bridge MHD NBIS]InspResp="MTA@")[BMS Inspections]Agency:="MTA"Else [BMS Inspections]Agency:=""End case PushChange (3;->[BMS Inspections]Agency)SAVE RECORD([BMS Inspections])POPUPMENUC (->aAgency;->aAgency;->[BMS Inspections]Agency)If (Is record loaded([Inspections]))[Inspections]Agency:=[BMS Inspections]AgencyPushChange (1;->[Inspections]Agency)End if End if If (([BMS Inspections]Agency="MDC")Ê&ÊNot(vbInspectionLocked))Case of : ($vsMyEmployer#"")[BMS Inspections]Agency:=$vsMyEmployer: ([Bridge MHD NBIS]InspResp="DIST@")[BMS Inspections]Agency:="Mass. Highway Dept.": ([Bridge MHD NBIS]InspResp="MDC@")[BMS Inspections]Agency:="DCR": ([Bridge MHD NBIS]InspResp="MBTA@")[BMS Inspections]Agency:="MBTA": ([Bridge MHD NBIS]InspResp="MTA@")[BMS Inspections]Agency:="MTA"Else [BMS Inspections]Agency:=""End case PushChange (3;->[BMS Inspections]Agency)SAVE RECORD([BMS Inspections])POPUPMENUC (->aAgency;->aAgency;->[BMS Inspections]Agency)If (Is record loaded([Inspections]))[Inspections]Agency:=[BMS Inspections]AgencyPushChange (1;->[Inspections]Agency)End if End if ÊÊ`Set up the team leader and team member arrays.vAgency:=[BMS Inspections]AgencyInitPers ([BMS Inspections]Agency)ÊÊ`InitPers recreates the Team Leader array; reset it.  aTeamLeader:=Find in array(aTeamLdrID;[BMS Inspections]TeamLeader)If (aTeamLeader<=0)ÊÊ`Just in case nothing was found in arrayaTeamLeader:=0End if $k:=Find in array(aPeople_ID;[BMS Inspections]TeamLeader)If ($k>0)vTmLeader:=aPeople{$k}Else vTmLeader:="Select Team Leader"End if INSP_BuildTmMbrArea (->[BMS Field Trip]Person ID)End case 