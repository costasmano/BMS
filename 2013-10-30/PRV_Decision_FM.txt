  ` Method: PRV_Decision_FM  ` Description  `   `   ` Parameters  ` $1 : $FormEvent_L  ` ----------------------------------------------------If (False)  ` User name (OS): Costas Manousakis  ` User name (4D): Designer  ` Date and time: 08/23/12, 21:32:42  ` ----------------------------------------------------  ` First ReleaseMods_2012_08   ` Modified by: Costas Manousakis-(Designer)-(9/25/13 15:02:54)Mods_2013_09   `  `Copied to DEVEnd if C_LONGINT($FormEvent_L)C_LONGINT($RecalcDecision_L;$UpdateBINInfo_L;$ShowTree_L;$VarsToFields_L;$FieldsToVars)$RecalcDecision_L:=15200$UpdateBINInfo_L:=15201$ShowTree_L:=15202$VarsToFields_L:=15203$FieldsToVars:=15204If (Count parameters>0)C_LONGINT($1)$FormEvent_L:=$1Else $FormEvent_L:=Form eventEnd if Case of : ($FormEvent_L=On Close Detail ): (($FormEvent_L=On Clicked ) | ($FormEvent_L=On Data Change ))C_POINTER($cliickedone_ptr)$cliickedone_ptr:=Focus objectC_TEXT($varName_txt)C_LONGINT($tbl_L;$Fld_L)RESOLVE POINTER($cliickedone_ptr;$varName_txt;$tbl_L;$Fld_L)PRV_Decision_FM ($VarsToFields_L)If ($tbl_L=Table(->[Contract_Project_Maintenance]))PRV_Decision_FM ($RecalcDecision_L)End if If ($varName_txt="PRV_DEC_@")PRV_Decision_FM ($RecalcDecision_L)End if If ($varName_txt="PRV_RecommMethod_txt")[Contract_Project_Maintenance]RecommConstr_txt:=PRV_RecommMethod_txtEnd if : ($FormEvent_L=On Load )PRV_CTRLSelections ("INSPECT")C_INTEGER(vApproveLvl)vApproveLvl:=0  `Cannot approve inspections from this point of entry. PRV_CTRLListBoxes ("INSPECT")PRV_Decision_FM ($FieldsToVars)  `Load the fields into variables  `Load the Decision treeIf (Read only state([Contract_Assignment_Maintenance]))SET ENTERABLE(*;"DE@";False)SET VISIBLE(*;"DE@btn";False)Else C_LONGINT($LoadRecResult_L)$LoadRecResult_L:=ut_LoadRecordInteractiveV2 (->[Contract_Project_Maintenance])Case of : ($LoadRecResult_L=1)PRV_Decision_FM ($UpdateBINInfo_L)PRV_Decision_FM ($FieldsToVars)  `Load the fields into variablesIf (Modified record([Contract_Project_Maintenance]))PRV_Decision_FM ($RecalcDecision_L)End if : ($LoadRecResult_L=2)SET ENTERABLE(*;"DE@";False)SET VISIBLE(*;"DE@btn";False)End case End if PRV_Decision_FM ($ShowTree_L)PRV_RecommMethod_txt:=[Contract_Project_Maintenance]RecommConstr_txt: ($FormEvent_L=On Validate ): ($FormEvent_L=On Unload ): ($FormEvent_L=$ShowTree_L)SET VISIBLE(*;"FLOW@";False)If ([Contract_Project_Maintenance]PrelimDecisValue_r<7)SET VISIBLE(*;"@LT7@";True)Else SET VISIBLE(*;"@GT7@";True)SET VISIBLE(*;"@PCOSTLY@";[Contract_Project_Maintenance]PrefabCostLess_b)SET VISIBLE(*;"@PCOSTLN@";Not([Contract_Project_Maintenance]PrefabCostLess_b))SET VISIBLE(*;"@PJUSY@";[Contract_Project_Maintenance]PrefabJustif_b)SET VISIBLE(*;"@PJUSN@";Not([Contract_Project_Maintenance]PrefabJustif_b))If (Not([Contract_Project_Maintenance]PrefabJustif_b))SET VISIBLE(*;"@PCOSTL@";False)End if SET VISIBLE(*;"@PDELY@";[Contract_Project_Maintenance]PrefabDeliv_b)SET VISIBLE(*;"@PDELN@";Not([Contract_Project_Maintenance]PrefabDeliv_b))If (Not([Contract_Project_Maintenance]PrefabDeliv_b))SET VISIBLE(*;"@PCOSTL@";False)SET VISIBLE(*;"@PJUS@";False)End if SET VISIBLE(*;"@STGY@";[Contract_Project_Maintenance]StagingAvail_b)SET VISIBLE(*;"@STGN@";Not([Contract_Project_Maintenance]StagingAvail_b))If ([Contract_Project_Maintenance]StagingAvail_b)SET VISIBLE(*;"@PCOSTL@";False)SET VISIBLE(*;"@PJUS@";False)SET VISIBLE(*;"@PDEL@";False)SET VISIBLE(*;"@ABCY@";[Contract_Project_Maintenance]ABCOver30_b)SET VISIBLE(*;"@ABCN@";Not([Contract_Project_Maintenance]ABCOver30_b))If ([Contract_Project_Maintenance]ABCOver30_b)SET VISIBLE(*;"@PCOSTLY@";[Contract_Project_Maintenance]PrefabCostLess_b)SET VISIBLE(*;"@PCOSTLN@";Not([Contract_Project_Maintenance]PrefabCostLess_b))SET VISIBLE(*;"@PJUSY@";[Contract_Project_Maintenance]PrefabJustif_b)SET VISIBLE(*;"@PJUSN@";Not([Contract_Project_Maintenance]PrefabJustif_b))If (Not([Contract_Project_Maintenance]PrefabJustif_b))SET VISIBLE(*;"@PCOSTL@";False)End if SET VISIBLE(*;"@PDELY@";[Contract_Project_Maintenance]PrefabDeliv_b)SET VISIBLE(*;"@PDELN@";Not([Contract_Project_Maintenance]PrefabDeliv_b))If (Not([Contract_Project_Maintenance]PrefabDeliv_b))SET VISIBLE(*;"@PCOSTL@";False)SET VISIBLE(*;"@PJUS@";False)End if End if SET VISIBLE(*;"@CLBY@";[Contract_Project_Maintenance]BridgeClose_b)SET VISIBLE(*;"@CLBN@";Not([Contract_Project_Maintenance]BridgeClose_b))If (Not([Contract_Project_Maintenance]BridgeClose_b))SET VISIBLE(*;"@ABC@";False)SET VISIBLE(*;"@PCOSTLY@";[Contract_Project_Maintenance]PrefabCostLess_b)SET VISIBLE(*;"@PCOSTLN@";Not([Contract_Project_Maintenance]PrefabCostLess_b))SET VISIBLE(*;"@PJUSY@";[Contract_Project_Maintenance]PrefabJustif_b)SET VISIBLE(*;"@PJUSN@";Not([Contract_Project_Maintenance]PrefabJustif_b))If (Not([Contract_Project_Maintenance]PrefabJustif_b))SET VISIBLE(*;"@PCOSTL@";False)End if SET VISIBLE(*;"@PDELY@";[Contract_Project_Maintenance]PrefabDeliv_b)SET VISIBLE(*;"@PDELN@";Not([Contract_Project_Maintenance]PrefabDeliv_b))If (Not([Contract_Project_Maintenance]PrefabDeliv_b))SET VISIBLE(*;"@PCOSTL@";False)SET VISIBLE(*;"@PJUS@";False)End if End if SET VISIBLE(*;"@UTY@";[Contract_Project_Maintenance]UtilRelocate_b)SET VISIBLE(*;"@UTN@";Not([Contract_Project_Maintenance]UtilRelocate_b))If (Not([Contract_Project_Maintenance]UtilRelocate_b))SET VISIBLE(*;"@ABC@";False)SET VISIBLE(*;"@CLB@";False)SET VISIBLE(*;"@PCOSTLY@";[Contract_Project_Maintenance]PrefabCostLess_b)SET VISIBLE(*;"@PCOSTLN@";Not([Contract_Project_Maintenance]PrefabCostLess_b))SET VISIBLE(*;"@PJUSY@";[Contract_Project_Maintenance]PrefabJustif_b)SET VISIBLE(*;"@PJUSN@";Not([Contract_Project_Maintenance]PrefabJustif_b))If (Not([Contract_Project_Maintenance]PrefabJustif_b))SET VISIBLE(*;"@PCOSTL@";False)End if SET VISIBLE(*;"@PDELY@";[Contract_Project_Maintenance]PrefabDeliv_b)SET VISIBLE(*;"@PDELN@";Not([Contract_Project_Maintenance]PrefabDeliv_b))If (Not([Contract_Project_Maintenance]PrefabDeliv_b))SET VISIBLE(*;"@PCOSTL@";False)SET VISIBLE(*;"@PJUS@";False)End if End if Else SET VISIBLE(*;"@CLB@";False)SET VISIBLE(*;"@UT@";False)SET VISIBLE(*;"@ABC@";False)End if End if : ($FormEvent_L=$RecalcDecision_L)C_LONGINT($adtVal_L;$DetVal_L;$ClassVal_L;$otherVal_L;$EmerPts_L;$ActiveRRPts_L;$EvacPts_L)C_REAL($HwyEval_r;$OtherF_r;$PrelimValue_r)$adtVal_L:=PRV_LimitTableValue (PRV_ADTTABLETREE_txt;[Contract_Project_Maintenance]ADT_L)If ($adtVal_L#[Contract_Project_Maintenance]ADTValue_L)[Contract_Project_Maintenance]ADTValue_L:=$adtVal_LEnd if $DetVal_L:=PRV_LimitTableValue (PRV_DETOURTABLETREE_txt;[Contract_Project_Maintenance]Detour_L)If ($DetVal_L#[Contract_Project_Maintenance]DetourValue_L)[Contract_Project_Maintenance]DetourValue_L:=$DetVal_LEnd if $ClassVal_L:=PRV_ListTableValue (PRV_CLASSTABLETREE_txt;[Contract_Project_Maintenance]Classification_s)If ($ClassVal_L#[Contract_Project_Maintenance]ClassificationValue_L)[Contract_Project_Maintenance]ClassificationValue_L:=$ClassVal_LEnd if $HwyEval_r:=([Contract_Project_Maintenance]ADTValue_L*PRV_ADTFactor_r)+([Contract_Project_Maintenance]DetourValue_L*PRV_DetourFactor_r)+([Contract_Project_Maintenance]ClassificationValue_L*PRV_ClassFactor_r)$HwyEval_r:=Round($HwyEval_r;2)If ($HwyEval_r#[Contract_Project_Maintenance]HWYEvalValue_r)[Contract_Project_Maintenance]HWYEvalValue_r:=$HwyEval_rEnd if $EmerPts_L:=0$ActiveRRPts_L:=0$EvacPts_L:=0If ([Contract_Project_Maintenance]EmergRepl_b)$EmerPts_L:=PRV_EmergRepPoints_LEnd if If ($EmerPts_L#[Contract_Project_Maintenance]EmergReplPts_L)[Contract_Project_Maintenance]EmergReplPts_L:=$EmerPts_LEnd if If ([Contract_Project_Maintenance]ActiveRR_b)$ActiveRRPts_L:=PRV_ActiveRRPoints_LEnd if If ($ActiveRRPts_L#[Contract_Project_Maintenance]ActiveRRPts_L)[Contract_Project_Maintenance]ActiveRRPts_L:=$ActiveRRPts_LEnd if If ([Contract_Project_Maintenance]EvacRoute_b)$EvacPts_L:=PRV_EvacRoutePoints_LEnd if If ($EvacPts_L#[Contract_Project_Maintenance]EvacRoutePts_L)[Contract_Project_Maintenance]EvacRoutePts_L:=$EvacPts_LEnd if $OtherF_r:=([Contract_Project_Maintenance]EmergReplPts_L*PRV_EmergRepFactor_r)+([Contract_Project_Maintenance]ActiveRRPts_L*PRV_ActiveRRFactor_r)+([Contract_Project_Maintenance]EvacRoutePts_L*PRV_EvacRouteFactor_r)$OtherF_r:=Round($OtherF_r;2)If ($OtherF_r#[Contract_Project_Maintenance]OtherFactorsValue_r)[Contract_Project_Maintenance]OtherFactorsValue_r:=$OtherF_rEnd if $PrelimValue_r:=([Contract_Project_Maintenance]HWYEvalValue_r*PRV_HWYEvalFactor_r)+([Contract_Project_Maintenance]OtherFactorsValue_r*PRV_OtherFactor_r)$PrelimValue_r:=Round($PrelimValue_r;2)If ($PrelimValue_r#[Contract_Project_Maintenance]PrelimDecisValue_r)[Contract_Project_Maintenance]PrelimDecisValue_r:=$PrelimValue_rEnd if If ([Contract_Project_Maintenance]PrelimDecisValue_r<7)[Contract_Project_Maintenance]RecommConstr_txt:=PRV_ConsMethod1_txtElse If ([Contract_Project_Maintenance]StagingAvail_b & [Contract_Project_Maintenance]UtilRelocate_b & [Contract_Project_Maintenance]BridgeClose_b & Not([Contract_Project_Maintenance]ABCOver30_b))[Contract_Project_Maintenance]RecommConstr_txt:=PRV_ConsMethod3_txtElse If ([Contract_Project_Maintenance]PrefabDeliv_b & [Contract_Project_Maintenance]PrefabJustif_b & [Contract_Project_Maintenance]PrefabCostLess_b)[Contract_Project_Maintenance]RecommConstr_txt:=PRV_ConsMethod2_txtElse [Contract_Project_Maintenance]RecommConstr_txt:=PRV_ConsMethod1_txtEnd if End if End if PRV_RecommMethod_txt:=[Contract_Project_Maintenance]RecommConstr_txtPRV_Decision_FM ($ShowTree_L): ($FormEvent_L=$UpdateBINInfo_L)READ ONLY([Bridge MHD NBIS])QUERY([Bridge MHD NBIS];[Bridge MHD NBIS]BIN=[Contract_Project_Maintenance]BIN)If ([Contract_Project_Maintenance]ADT_L<=0)[Contract_Project_Maintenance]ADT_L:=[Bridge MHD NBIS]Item29End if If ([Contract_Project_Maintenance]Detour_L<=0)[Contract_Project_Maintenance]Detour_L:=[Bridge MHD NBIS]Item19End if If ([Contract_Project_Maintenance]Classification_s="")[Contract_Project_Maintenance]Classification_s:=[Bridge MHD NBIS]Item26End if : ($FormEvent_L=$FieldsToVars)PRV_DEC_ADT_L:=[Contract_Project_Maintenance]ADT_LPRV_DEC_Detour_L:=[Contract_Project_Maintenance]Detour_LPRV_DEC_Classification_s:=[Contract_Project_Maintenance]Classification_sPRV_DEC_NeedSnowFence_b:=f_boolean2Num ([Contract_Project_Maintenance]NeedSnowFence_b)PRV_DEC_StagingAvail_b:=f_boolean2Num ([Contract_Project_Maintenance]StagingAvail_b)PRV_DEC_UtilRelocate_b:=f_boolean2Num ([Contract_Project_Maintenance]UtilRelocate_b)PRV_DEC_BridgeClose_b:=f_boolean2Num ([Contract_Project_Maintenance]BridgeClose_b)PRV_DEC_ABCOver30_b:=f_boolean2Num ([Contract_Project_Maintenance]ABCOver30_b)PRV_DEC_PrefabDeliv_b:=f_boolean2Num ([Contract_Project_Maintenance]PrefabDeliv_b)PRV_DEC_PrefabJustif_b:=f_boolean2Num ([Contract_Project_Maintenance]PrefabJustif_b)PRV_DEC_PrefabCostLess_b:=f_boolean2Num ([Contract_Project_Maintenance]PrefabCostLess_b)PRV_DEC_EmergRepl_b:=f_boolean2Num ([Contract_Project_Maintenance]EmergRepl_b)PRV_DEC_ActiveRR_b:=f_boolean2Num ([Contract_Project_Maintenance]ActiveRR_b)PRV_DEC_EvacRoute_b:=f_boolean2Num ([Contract_Project_Maintenance]EvacRoute_b): ($FormEvent_L=$VarsToFields_L)[Contract_Project_Maintenance]ADT_L:=PRV_DEC_ADT_L[Contract_Project_Maintenance]Detour_L:=PRV_DEC_Detour_L[Contract_Project_Maintenance]Classification_s:=PRV_DEC_Classification_s[Contract_Project_Maintenance]NeedSnowFence_b:=(PRV_DEC_NeedSnowFence_b=1)[Contract_Project_Maintenance]StagingAvail_b:=(PRV_DEC_StagingAvail_b=1)[Contract_Project_Maintenance]UtilRelocate_b:=(PRV_DEC_UtilRelocate_b=1)[Contract_Project_Maintenance]BridgeClose_b:=(PRV_DEC_BridgeClose_b=1)[Contract_Project_Maintenance]ABCOver30_b:=(PRV_DEC_ABCOver30_b=1)[Contract_Project_Maintenance]PrefabDeliv_b:=(PRV_DEC_PrefabDeliv_b=1)[Contract_Project_Maintenance]PrefabJustif_b:=(PRV_DEC_PrefabJustif_b=1)[Contract_Project_Maintenance]PrefabCostLess_b:=(PRV_DEC_PrefabCostLess_b=1)[Contract_Project_Maintenance]EmergRepl_b:=(PRV_DEC_EmergRepl_b=1)[Contract_Project_Maintenance]ActiveRR_b:=(PRV_DEC_ActiveRR_b=1)[Contract_Project_Maintenance]EvacRoute_b:=(PRV_DEC_EvacRoute_b=1)End case 