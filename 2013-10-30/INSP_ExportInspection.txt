If (False)ÊÊ` ----------------------------------------------------ÊÊ` User name (OS): costasmanousakisÊÊ` User name (4D): DesignerÊÊ` Date and time: 11/18/05, 09:17:56ÊÊ` ----------------------------------------------------ÊÊ` Method: Method: INSP_ExportInspectionÊÊ` DescriptionÊÊ` Export an inspection into a binary file.ÊÊ`ÊÊ` ParametersÊÊ` ----------------------------------------------------Mods_2005_CM19 ÊÊ` Modified by: costasmanousakis-(Designer)-(5/19/2006 15:49:50)Mods_2006_CM04 ÊÊ` Modified by: costasmanousakis-(Designer)-(8/22/2007 08:36:11)Mods_2007_CM12_5301 ÊÊ` Modified by: Costas Manousakis-(Designer)-(10/30/13 16:34:38)Mods_2013_10 ÊÊ`ÊÊ`Expanded export to the Tunnelinspection table - if it existsEnd if C_BOOLEAN($vExport)If (Not(Is record loaded([Inspections])))GOTO SELECTED RECORD([Inspections];1)ÊÊ`get the 1st one on the llstLOAD RECORD([Inspections])Else End if CONFIRM("Export current inspection (Type "+[Inspections]Insp Type+" BIN "+[Inspections]BIN+" Date "+String([Inspections]Insp Date)+") ?")$vExport:=(OK=1)If ($vExport)If (Table(Current form table)=Table(->[Inspections]))CUT NAMED SELECTION([ElementsSafety];"INSPEXP_ELMTSEL")CUT NAMED SELECTION([Standard Photos];"INSPEXP_IMGSEL")CUT NAMED SELECTION([Field Trip];"INSPEXP_FLDTRIPSEL")End if C_TEXT($ExportFile;$ExportHeader;$TargetDir)C_LONGINT($NumTeam_L;$NumElmts_L;$NumPhotos_L;$NumPontisElmt_L;$NumPontisTm_L;$i)$ExportFile:="Insp_"+[Inspections]BIN+"_"+[Inspections]Insp Type+"_"+String([Inspections]Insp Date)+".export"$ExportFile:=Replace string($ExportFile;"/";"_")$TargetDir:=Select folder("Select folder for Export file")SET CHANNEL(10;$TargetDir+$ExportFile)ÊÊ`Open a channel for a document$ExportHeader:="InspectionExport"SEND VARIABLE($ExportHeader)SEND RECORD([Inspections])QUERY([Field Trip];[Field Trip]InspID=[Inspections]InspID)$NumTeam_L:=Records in selection([Field Trip])SEND VARIABLE($NumTeam_L)For ($i;1;$NumTeam_L)GOTO SELECTED RECORD([Field Trip];$i)LOAD RECORD([Field Trip])SEND RECORD([Field Trip])End for QUERY([ElementsSafety];[ElementsSafety]InspID=[Inspections]InspID)$NumElmts_L:=Records in selection([ElementsSafety])SEND VARIABLE($NumElmts_L)For ($i;1;$NumElmts_L)GOTO SELECTED RECORD([ElementsSafety];$i)LOAD RECORD([ElementsSafety])SEND RECORD([ElementsSafety])End for QUERY([Standard Photos];[Standard Photos]InspID=[Inspections]InspID)$NumPhotos_L:=Records in selection([Standard Photos])SEND VARIABLE($NumPhotos_L)For ($i;1;$NumPhotos_L)GOTO SELECTED RECORD([Standard Photos];$i)LOAD RECORD([Standard Photos])SEND RECORD([Standard Photos])End for QUERY([Combined Inspections];[Combined Inspections]NBISInspID=[Inspections]InspID)C_LONGINT($BMSInspID_L)$BMSInspID_L:=[Combined Inspections]BMSInspIDIf ([Combined Inspections]BMSInspID>0)ÊÊ`send PontisQUERY([BMS Inspections];[BMS Inspections]Inspection ID=[Combined Inspections]BMSInspID)If (Records in selection([BMS Inspections])=1)SEND VARIABLE($BMSInspID_L)ÊÊ`send this as markerLOAD RECORD([BMS Inspections])SEND RECORD([BMS Inspections])QUERY([Cond Units];[Cond Units]Inspection ID=[BMS Inspections]Inspection ID)$NumElmts_L:=Records in selection([Cond Units])SEND VARIABLE($NumElmts_L)For ($i;1;$NumElmts_L)GOTO SELECTED RECORD([Cond Units];$i)LOAD RECORD([Cond Units])SEND RECORD([Cond Units])End for QUERY([BMS Field Trip];[BMS Field Trip]Inspection ID=[BMS Inspections]Inspection ID)$NumTeam_L:=Records in selection([BMS Field Trip])SEND VARIABLE($NumTeam_L)For ($i;1;$NumTeam_L)GOTO SELECTED RECORD([BMS Field Trip];$i)LOAD RECORD([BMS Field Trip])SEND RECORD([BMS Field Trip])End for Else $BMSInspID_L:=-1SEND VARIABLE($BMSInspID_L)End if Else $BMSInspID_L:=-1ÊÊ`set it to -1 for safetySEND VARIABLE($BMSInspID_L)End if LOAD RECORD([Combined Inspections])SEND RECORD([Combined Inspections])QUERY([TunnelInspection];[TunnelInspection]InspID=[Combined Inspections]NBISInspID)C_LONGINT($tunnelInspID_L)$tunnelInspID_L:=-1If (Records in selection([TunnelInspection])=1)LOAD RECORD([TunnelInspection])$tunnelInspID_L:=[TunnelInspection]TunnelInspID_LSEND VARIABLE($tunnelInspID_L)SEND RECORD([TunnelInspection])Else SEND VARIABLE($tunnelInspID_L)End if SET CHANNEL(11)ÊÊ`close fileIf (Table(Current form table)=Table(->[Inspections]))USE NAMED SELECTION("INSPEXP_ELMTSEL")USE NAMED SELECTION("INSPEXP_IMGSEL")USE NAMED SELECTION("INSPEXP_FLDTRIPSEL")End if ALERT("Created Export file "+Document)End if 