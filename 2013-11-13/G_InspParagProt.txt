ÊÊ`G_InspParagProtÊÊ`Aug-2003 : Provide paragraph protection for element comments.ÊÊ`   To attempt to keep element  or other comments in one page if possible.ÊÊ`$mainarea:=$1  : 4d write areÊÊ`$numpages:=$2  : Num of pages before ÊÊ`$vlLine:=$3       : Line number where label was placedÊÊ`$vlStartSel:=$4: Position of startÊÊ`$i:=$5               : Number of carriage returns to be removed.ÊÊ`$vElmTitle:=$6  : Title used to append the 'Cont'd'If (False)Mods_2005_CM03 Mods_2005_CM05 ÊÊ` Modified by: costasmanousakis-(Designer)-(12/2/11 16:11:11)Mods_2011_12 ÊÊ`ÊÊ`Make sure the continution header is in black and white by re-setting the default style sheet.ÊÊ` Modified by: Costas Manousakis-(Designer)-(2/25/12 15:33:19)Mods_2012_02 ÊÊ`ÊÊ`Fix code so that the second paragraph cut in half does not loose all formatting when the Apply stylesheet is doneÊÊ`ÊÊ`Also so that the remaining text does not get new bullet or a first line indent.End if C_LONGINT($1;$mainarea;$2;$numpages;$3;$vlLine;$4;$vlStartSel;$5;$i)C_STRING(132;$vElmTitle;$6)$mainarea:=$1$numpages:=$2ÊÊ`$numpages : page count at start$vlLine:=$3ÊÊ`$vlLine : first line where the label will be inserted$vlStartSel:=$4ÊÊ`$vlStartSel := gets where we are at start - at the end of the text inserted before.$i:=$5ÊÊ`number of CRs to be deleted later if the text goes into another page$vElmTitle:=$6C_LONGINT($vlPageSpan;$vlPageno;$vlEndLine;$vlLastLine;$vlLastPage;$newst;$newend;$vlCol;$vlPos;$numnewpages)C_LONGINT($lineSt;$lineEnd)C_BOOLEAN($vbMovetoTop)$vbMovetoTop:=FalseÊÊ`check where we are now.WR GET CURSOR POSITION ($mainarea;$vlLastPage;$vlCol;$vlLastLine;$vlPos)ÊÊ` this is at the end of the text insertedÊÊ`if the pages increase,WR SET CURSOR POSITION ($mainarea;($numpages+1);1;1;1)ÊÊ` go to next page  1st line 1st colWR GET SELECTION ($mainarea;$newst;$newend)WR SET SELECTION ($mainarea;($newst-1);($newst-1))ÊÊ`move back one char WR GET CURSOR POSITION ($mainarea;$vlPageno;$vlCol;$vlEndLine;$vlPos)ÊÊ`will move to next page if ÊÊ`  there are between 6 and 10 line on the 1st page andÊÊ`there is only one line on the next and last page.$vbMovetoTop:=((($vlEndLine-$vlLine)>5)Ê&Ê(($vlEndLine-$vlLine)<11))$vbMovetoTop:=($vbMovetoTopÊ&Ê($vlLastPage=($numpages+1))Ê&Ê($vlLastLine=1))ÊÊ` or less than 6 lines on prev page.$vbMovetoTop:=($vbMovetoTopÊ|Ê(($vlEndLine-$vlLine)<6))If ($vbMovetoTop)ÊÊ` will try to keep the element comments in one page.WR SET SELECTION ($mainarea;$vlStartSel;($vlStartSel+$i))ÊÊ`move to the start of the insertÊÊ`delete the 1st linefeed only - should leave oneWR DELETE SELECTION ($mainarea)ÊÊ`if there is no select ($i=0) nothing will be deletedWR GET CURSOR POSITION ($mainarea;$numnewpages;$vlCol;$vlLine;$vlPos)While ($numnewpages=$numpages)WR INSERT TEXT ($mainarea;×sCR)WR GET CURSOR POSITION ($mainarea;$numnewpages;$vlCol;$vlLine;$vlPos)End while WR BACKSPACE ($mainarea)ÊÊ`we have all linefeeds we needÊÊ`move to the end againWR SET SELECTION ($mainarea;WR Count ($mainarea;wr nb characters );WR Count ($mainarea;wr nb characters ))$vlLine:=1End if $numnewpages:=WR Count ($mainarea;wr nb pages )ÊÊ`get count again, in case we moved the commentsÊÊ`move to top of 1st page$vlPageSpan:=$numnewpages-$numpagesC_REAL($CurLeftMar_r;$CurFirstLMar_r;$curBullet_R)C_LONGINT($same_L)For ($i;1;$vlPageSpan)If (($i#1)Ê|Ê($vlLine#1))WR SET CURSOR POSITION ($mainarea;($numpages+$i);1;1;1)WR GET SELECTION ($mainarea;$newst;$newend)$CurLeftMar_r:=WR Get text property ($mainarea;wr left margin ;$same_L)$CurFirstLMar_r:=WR Get text property ($mainarea;wr first indent ;$same_L)$curBullet_R:=WR Get text property ($mainarea;wr bullet ;$same_L)WR SET SELECTION ($mainarea;($newst-1);($newst-1))WR INSERT TEXT ($mainarea;×sCR)WR GET CURSOR POSITION ($mainarea;$vlPageno;$vlCol;$vlLine;$vlPos)If ($vlPageno<($numpages+$i))WR INSERT TEXT ($mainarea;×sCR)End if WR GET SELECTION ($mainarea;$newst;$newend)ÊÊ`Get the begining of the lineWR INSERT TEXT ($mainarea;$vElmTitle)WR INSERT TEXT ($mainarea;"  (Cont'd) ")WR GET SELECTION ($mainarea;$lineEnd;$lineEnd)ÊÊ`Mark the end of the lineWR INSERT TEXT ($mainarea;×sCR)ÊÊ`add a line feed so that the apply stylesheet does not affect the rest of the textWR GET SELECTION ($mainarea;$lineSt;$lineSt)ÊÊ`Mark the end of the lineWR SET SELECTION ($mainarea;$newst;$lineEnd)ÊÊ` This is just the new line addedG_ApplySheet ($mainarea;1)WR SET TEXT PROPERTY ($mainarea;wr bold ;1)WR SET TEXT PROPERTY ($mainarea;wr underline ;1)WR SET SELECTION ($mainarea;$lineSt;$lineSt)ÊÊ`move to the new lineÊÊ`G_ApplySheet ($mainarea;1)ÊÊ`reapply style sheet to the blank lineWR SET TEXT PROPERTY ($mainarea;wr first indent ;0)WR SET TEXT PROPERTY ($mainarea;wr bullet ;0)WR GET CURSOR POSITION ($mainarea;$vlPageno;$vlCol;$vlLine;$vlPos)If ($vlLine=1)WR SET SELECTION ($mainarea;$newst;$newend)WR INSERT TEXT ($mainarea;×sCR)End if $numnewpages:=WR Count ($mainarea;wr nb pages )ÊÊ`count again$vlPageSpan:=$numnewpages-$numpagesEnd if End for WR SET SELECTION ($mainarea;WR Count ($mainarea;wr nb characters );WR Count ($mainarea;wr nb characters ))