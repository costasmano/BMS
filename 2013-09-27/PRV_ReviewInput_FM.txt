  ` Method: PRV_ReviewInput_FM  ` Description  `   `   ` Parameters  ` $1 : $FormEvent_L  ` ----------------------------------------------------If (False)  ` User name (OS): Costas Manousakis  ` User name (4D): Designer  ` Date and time: 06/06/12, 09:59:45  ` ----------------------------------------------------  ` First ReleaseMods_2012_06   ` Modified by: Costas Manousakis-(Designer)-(9/24/13 11:33:14)Mods_2013_09   `  `  ` Modified by: Costas Manousakis-(Designer)-(9/25/13 15:02:54)Mods_2013_09   `  `Copied to DEVEnd if C_LONGINT($FormEvent_L)If (Count parameters>0)C_LONGINT($1)$FormEvent_L:=$1Else $FormEvent_L:=Form eventEnd if C_TEXT(PRV_REVIEWTYPEDESC_TXT;PRV_NEWREVIEWTYPE_s;PRV_ApproveLabel_txt;PRV_SENDSUBMTO_txt)C_LONGINT(PRV_DOTHEFLOW_L;PRV_GETBRIDGEBININFO_L)PRV_DOTHEFLOW_L:=15001PRV_GETBRIDGEBININFO_L:=15002Case of : ($FormEvent_L=On Close Detail ): ($FormEvent_L=On Load )PRV_REVIEWTYPEDESC_TXT:="UNKNOWN PRESERVATION REVIEW"PRV_ReviewSCR_DateCheck_B:=FalseIf (Is new record(Current form table->))[Preservation_Reviews]AssignID:=[Contract_Assignment_Maintenance]AssignID[Preservation_Reviews]ReviewTYpe_s:=PRV_NEWREVIEWTYPE_sInc_Sequence ("PreservReview";->[Preservation_Reviews]Review_ID)End if C_TEXT($elmt_txt;$CertYN_txt;$CertTypeYN_txt;$SendTo_txt;$SubmRecdYN_txt)C_BOOLEAN(PRV_FIRSTSTEP_Recd_b)PRV_FIRSTSTEP_Recd_b:=TrueC_BOOLEAN($CertYN_b;$CertTypeYN_b)$CertYN_b:=False$CertTypeYN_b:=False$elmt_txt:=DOM Find XML element(PRV_REVIEWTYPESTREE_txt;"PRV_ReviewTypes/"+PRV_NEWREVIEWTYPE_s)If (OK=1)DOM GET XML ELEMENT VALUE($elmt_txt;PRV_REVIEWTYPEDESC_TXT)ON ERR CALL("Error Handler")DOM GET XML ATTRIBUTE BY NAME($elmt_txt;"CERT";$CertYN_b)DOM GET XML ATTRIBUTE BY NAME($elmt_txt;"CERTTYPE";$CertTypeYN_b)DOM GET XML ATTRIBUTE BY NAME($elmt_txt;"SENDTO";PRV_SENDSUBMTO_txt)DOM GET XML ATTRIBUTE BY NAME($elmt_txt;"SUBMRCD";PRV_FIRSTSTEP_Recd_b)ON ERR CALL("")End if   `PRV_ReviewInput_FM (PRV_DOTHEFLOW_L)If (Not(PRV_FIRSTSTEP_Recd_b))GOTO PAGE(2)ARRAY TEXT(PRV_Actions_atxt;3)If ($CertYN_b)PRV_Actions_atxt{1}:="Certificate Issued"Else PRV_Actions_atxt{1}:="Approved"End if PRV_Actions_atxt{2}:="Returned with comments No Re-Submission Required"  `Mods_2013_09PRV_Actions_atxt{3}:="Returned with comments Re-Submission Required"  `Mods_2013_09If ($CertTypeYN_b)SET VISIBLE(*;"@Certificate@";True)End if Else C_TEXT(PRV_Designer_txt)Case of : ([Contract_Assignment_Maintenance]DesignerDesignation_s="Boston@")PRV_Designer_txt:=[Contract_Assignment_Maintenance]DesignerDesignation_sGOTO PAGE(3): ([Contract_Assignment_Maintenance]DesignerDesignation_s="District@")PRV_Designer_txt:=[Contract_Assignment_Maintenance]DesignerDesignation_sGOTO PAGE(3)Else End case ARRAY TEXT(PRV_Actions_atxt;4)PRV_Actions_atxt{1}:="Sent back to Distr for revisions"PRV_Actions_atxt{2}:="Sent back to P.M. for Consultant revisions"PRV_Actions_atxt{3}:="Accepted, Send back to P.M."PRV_Actions_atxt{4}:="Other :"End if ENABLE BUTTON(*;"DE PRV_Actions_atxt@")If (PRV_LockedAssignment_b)SET ENTERABLE(*;"DE@";False)DISABLE BUTTON(*;"DE@")SET VISIBLE(*;"DE@btn";False)End if : ($FormEvent_L=On Data Change )  `PRV_ReviewInput_FM (PRV_DOTHEFLOW_L)C_POINTER($lastobj_ptr)$lastobj_ptr:=Focus objectC_TEXT($VarName_txt;$FldName_txt)C_LONGINT($tblNum_L;$FldNum_L;$FldType_L)RESOLVE POINTER($lastobj_ptr;$VarName_txt;$tblNum_L;$FldNum_L)If ($FldNum_L>0)ARRAY TEXT($fldnames_atxt;0)ARRAY LONGINT($FldNums_aL;0)GET FIELD TITLES(Table($tblNum_L)->;$fldnames_atxt;$FldNums_aL)$FldName_txt:=Field name($tblNum_L;$FldNum_L)$FldType_L:=Type(Field($tblNum_L;$FldNum_L)->)If ($FldType_L=Is Date )ARRAY POINTER($FldSeq_aptr;0)Case of : (Current form page=1)APPEND TO ARRAY($FldSeq_aptr;->[Preservation_Reviews]Received_d)APPEND TO ARRAY($FldSeq_aptr;->[Preservation_Reviews]SentToDistr_d)APPEND TO ARRAY($FldSeq_aptr;->[Preservation_Reviews]Deadline_d)APPEND TO ARRAY($FldSeq_aptr;->[Preservation_Reviews]CommentsRecd_d)APPEND TO ARRAY($FldSeq_aptr;->[Preservation_Reviews]SentToREviewer_d)APPEND TO ARRAY($FldSeq_aptr;->[Preservation_Reviews]ReviewerDeadline_d)APPEND TO ARRAY($FldSeq_aptr;->[Preservation_Reviews]DistrCmtsReviewed_d)APPEND TO ARRAY($FldSeq_aptr;->[Preservation_Reviews]SentBackToPM_d): (Current form page=2)APPEND TO ARRAY($FldSeq_aptr;->[Preservation_Reviews]SentToREviewer_d)APPEND TO ARRAY($FldSeq_aptr;->[Preservation_Reviews]CommentsRecd_d)APPEND TO ARRAY($FldSeq_aptr;->[Preservation_Reviews]SentBackToPM_d): (Current form page=3)APPEND TO ARRAY($FldSeq_aptr;->[Preservation_Reviews]Received_d)APPEND TO ARRAY($FldSeq_aptr;->[Preservation_Reviews]SentToREviewer_d)APPEND TO ARRAY($FldSeq_aptr;->[Preservation_Reviews]ReviewerDeadline_d)APPEND TO ARRAY($FldSeq_aptr;->[Preservation_Reviews]DistrCmtsReviewed_d)APPEND TO ARRAY($FldSeq_aptr;->[Preservation_Reviews]SentBackToPM_d)End case C_LONGINT($loop_L;$loop2_L)C_TEXT($msg_txt)$msg_txt:=""C_BOOLEAN(PRV_ReviewSCR_DateCheck_B)PRV_ReviewSCR_DateCheck_B:=FalseFor ($loop_L;Size of array($FldSeq_aptr);1;-1)If ($FldSeq_aptr{$loop_L}->#!00/00/00!)For ($loop2_L;($loop_L-1);1;-1)If ($FldSeq_aptr{$loop2_L}->#!00/00/00!)If ($FldSeq_aptr{$loop_L}-><$FldSeq_aptr{$loop2_L}->)$msg_txt:=$msg_txt+"Date entered "+String($FldSeq_aptr{$loop_L}->)+" for field ["+$fldnames_atxt{Find in array($FldNums_aL;Field($FldSeq_aptr{$loop_L}))}+"] is less than the date "+String($FldSeq_aptr{$loop2_L}->)+" for ["+$fldnames_atxt{Find in array($FldNums_aL;Field($FldSeq_aptr{$loop2_L}))}+"]"+Char(Carriage return )$loop2_L:=0End if End if End for End if End for If ($msg_txt#"")PRV_ReviewSCR_DateCheck_B:=True$msg_txt:="Date entry errors:"+Char(Carriage return )+$msg_txtALERT($msg_txt)End if End if End if : ($FormEvent_L=On Unload ): ($FormEvent_L=On Validate ): ($FormEvent_L=PRV_DOTHEFLOW_L)If (False)SET ENTERABLE([Preservation_Reviews]SentToDistr_d;False)SET ENTERABLE([Preservation_Reviews]Deadline_d;False)SET ENTERABLE([Preservation_Reviews]SentToREviewer_d;False)SET ENTERABLE([Preservation_Reviews]CommentsRecd_d;False)SET ENTERABLE([Preservation_Reviews]SentToREviewer_d;False)SET ENTERABLE([Preservation_Reviews]ReviewerDeadline_d;False)SET ENTERABLE([Preservation_Reviews]DistrCmtsReviewed_d;False)  `SET ENTERABLE([Preservation_Reviews]Reviewer_s;False)DISABLE BUTTON(PRV_Actions_atxt)SET ENTERABLE([Preservation_Reviews]SentBackToPM_d;False)SET ENTERABLE([Preservation_Reviews];False)If (PRV_FIRSTSTEP_Recd_b)If (([Contract_Assignment_Maintenance]DesignerDesignation_s="Boston@") | ([Contract_Assignment_Maintenance]DesignerDesignation_s="District@"))If ([Preservation_Reviews]Received_d#!00/00/00!)SET ENTERABLE([Preservation_Reviews]SentToREviewer_d;True)SET ENTERABLE([Preservation_Reviews]ReviewerDeadline_d;True)End if Else If ([Preservation_Reviews]Received_d#!00/00/00!)SET ENTERABLE([Preservation_Reviews]SentToDistr_d;True)End if If ([Preservation_Reviews]SentToDistr_d#!00/00/00!)SET ENTERABLE([Preservation_Reviews]Deadline_d;True)SET ENTERABLE([Preservation_Reviews]CommentsRecd_d;True)End if If ([Preservation_Reviews]CommentsRecd_d#!00/00/00!)SET ENTERABLE([Preservation_Reviews]SentToREviewer_d;True)SET ENTERABLE([Preservation_Reviews]ReviewerDeadline_d;True)End if End if If ([Preservation_Reviews]SentToREviewer_d#!00/00/00!)SET ENTERABLE([Preservation_Reviews]DistrCmtsReviewed_d;True)End if If ([Preservation_Reviews]DistrCmtsReviewed_d#!00/00/00!)ENABLE BUTTON(PRV_Actions_atxt)End if If ([Preservation_Reviews]Action_s#"")SET ENTERABLE([Preservation_Reviews]SentBackToPM_d;True)End if Else SET ENTERABLE([Preservation_Reviews]SentToREviewer_d;True)If ([Preservation_Reviews]SentToREviewer_d#!00/00/00!)SET ENTERABLE([Preservation_Reviews]CommentsRecd_d;True)End if If ([Preservation_Reviews]CommentsRecd_d#!00/00/00!)ENABLE BUTTON(PRV_Actions_atxt)End if If ([Preservation_Reviews]Action_s#"")SET ENTERABLE([Preservation_Reviews]SentBackToPM_d;True)SET ENTERABLE([Preservation_Reviews]CertificateType_s;True)End if End if End if End case 