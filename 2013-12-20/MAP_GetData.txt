  `Method: MAP_GetData  `Description  `  ` collect data in arrays from a list of bridge records to be passed on to a html template  ` Parameters  ` ----------------------------------------------------If (False)  ` ----------------------------------------------------  `User name (OS): Costas Manousakis  `User (4D) : Designer  `Date and time: 12/02/13, 11:01:30  ` ----------------------------------------------------  `Created : Mods_2013_12 End if   `C_LONGINT(MAP_BridgeCount_L)C_DATE(MAP_Date_d)C_REAL(MAP_CenterLat_r;MAP_CenterLon_r)ARRAY REAL(MAP_ArrayLat_ar;0)ARRAY REAL(MAP_ArrayLon_ar;0)ARRAY TEXT(MAP_ArrayDesc_atxt;0)ARRAY TEXT(MAP_ArrayInfoWin_atxt;0)ARRAY TEXT(MAP_ArrayBIN_atxt;0)ARRAY TEXT($Bdepts_atxt;0)ARRAY TEXT($item7_atxt;0)ARRAY TEXT($item6a_atxt;0)ARRAY INTEGER($it16a_aL;0)ARRAY INTEGER($it16b_aL;0)ARRAY REAL($it16c_ar;0)ARRAY INTEGER($it17a_aL;0)ARRAY INTEGER($it17b_aL;0)ARRAY REAL($it17c_ar;0)ARRAY TEXT($item8_atxt;0)ARRAY TEXT($Town_atxt;0)C_LONGINT($start_L;$end_L)$start_L:=1$end_L:=Records in selection([Bridge MHD NBIS])SELECTION RANGE TO ARRAY($start_L;$end_L;[Bridge MHD NBIS]BIN;MAP_ArrayBIN_atxt;[Bridge MHD NBIS]BDEPT;$Bdepts_atxt;[Bridge MHD NBIS]Item7;$item7_atxt;[Bridge MHD NBIS]Item6A;$item6a_atxt)SELECTION RANGE TO ARRAY($start_L;$end_L;[Bridge MHD NBIS]Item16A;$it16a_aL;[Bridge MHD NBIS]Item16B;$it16b_aL;[Bridge MHD NBIS]Item16C;$it16c_ar;[Bridge MHD NBIS]Item17A;$it17a_aL;[Bridge MHD NBIS]Item17B;$it17b_aL;[Bridge MHD NBIS]Item17C;$it17c_ar)SELECTION RANGE TO ARRAY($start_L;$end_L;[Bridge MHD NBIS]Item8;$item8_atxt;[Bridge MHD NBIS]Town Name;$Town_atxt)ARRAY REAL(MAP_ArrayLat_ar;Size of array(MAP_ArrayBIN_atxt))ARRAY REAL(MAP_ArrayLon_ar;Size of array(MAP_ArrayBIN_atxt))ARRAY TEXT(MAP_ArrayDesc_atxt;Size of array(MAP_ArrayBIN_atxt))ARRAY TEXT(MAP_ArrayInfoWin_atxt;Size of array(MAP_ArrayBIN_atxt))MAP_Date_d:=Current date(*)C_LONGINT($loop_L)For ($loop_L;1;Size of array(MAP_ArrayBIN_atxt))$item7_atxt{$loop_L}:=Replace string($item7_atxt{$loop_L};"'";" ")$item6a_atxt{$loop_L}:=Replace string($item6a_atxt{$loop_L};"'";" ")MAP_ArrayDesc_atxt{$loop_L}:=$Bdepts_atxt{$loop_L}+" "+MAP_ArrayBIN_atxt{$loop_L}+" "+Replace string($item7_atxt{$loop_L};"  ";" ")+" over "+Replace string($item6a_atxt{$loop_L};"  ";" ")MAP_ArrayInfoWin_atxt{$loop_L}:="<b>"+$Bdepts_atxt{$loop_L}+" ("+MAP_ArrayBIN_atxt{$loop_L}+") Item 8 : "+$item8_atxt{$loop_L}+"</b><br>"+Replace string($item7_atxt{$loop_L};"  ";" ")+" over "+Replace string($item6a_atxt{$loop_L};"  ";" ")+"<br>"+$Town_atxt{$loop_L}+"<br>"If (($it16a_aL{$loop_L}#0) & ($it17a_aL{$loop_L}#0))MAP_ArrayLat_ar{$loop_L}:=ut_DegMinSecToDeg ($it16a_aL{$loop_L};$it16b_aL{$loop_L};$it16c_ar{$loop_L})MAP_ArrayLon_ar{$loop_L}:=-(ut_DegMinSecToDeg ($it17a_aL{$loop_L};$it17b_aL{$loop_L};$it17c_ar{$loop_L}))Else MAP_ArrayLon_ar{$loop_L}:=0MAP_ArrayLat_ar{$loop_L}:=0End if End for For ($loop_L;Size of array(MAP_ArrayLat_ar);1;-1)If (MAP_ArrayLat_ar{$loop_L}=0)DELETE FROM ARRAY(MAP_ArrayBIN_atxt;$loop_L;1)DELETE FROM ARRAY(MAP_ArrayLat_ar;$loop_L;1)DELETE FROM ARRAY(MAP_ArrayLon_ar;$loop_L;1)DELETE FROM ARRAY(MAP_ArrayDesc_atxt;$loop_L;1)DELETE FROM ARRAY(MAP_ArrayInfoWin_atxt;$loop_L;1)End if End for MAP_CenterLat_r:=0MAP_CenterLon_r:=0MAP_BridgeCount_L:=Size of array(MAP_ArrayLat_ar)For ($loop_L;1;Size of array(MAP_ArrayLat_ar))MAP_CenterLat_r:=MAP_CenterLat_r+MAP_ArrayLat_ar{$loop_L}MAP_CenterLon_r:=MAP_CenterLon_r+MAP_ArrayLon_ar{$loop_L}End for MAP_CenterLat_r:=MAP_CenterLat_r/MAP_BridgeCount_LMAP_CenterLon_r:=MAP_CenterLon_r/MAP_BridgeCount_LC_TEXT($map_tml_txt)$map_tml_txt:=ut_GetSysParameter ("MAP_Template1")MAP_HTMLOutputFile_txt:=""If ($map_tml_txt="")ALERT("Parameter MAP_Template1 does not exist ir is blank!")Else C_BLOB($htmlfile_blb)TEXT TO BLOB($map_tml_txt;$htmlfile_blb;UTF8 text without length )PROCESS HTML TAGS($htmlfile_blb;$htmlfile_blb)  `TEXT TO BLOB($map_tml_txt;$htmlfile_blb;UTF8 text without length )C_TEXT($tempName_txt)$tempName_txt:=Substring(String(Current date(*);ISO Date );1;10)+" "+String(Current time(*);HH MM SS )$tempName_txt:=Replace string($tempName_txt;":";"")$tempName_txt:=Replace string($tempName_txt;"-";"")$tempName_txt:=String(Current process;"00000")+"-"+$tempName_txt$tempName_txt:=Temporary folder+$tempName_txt+".html"C_TIME($doc_t)$doc_t:=Create document($tempName_txt)CLOSE DOCUMENT($doc_t)BLOB TO DOCUMENT($tempName_txt;$htmlfile_blb)MAP_HTMLOutputFile_txt:=$tempName_txtEnd if   `End MAP_GetData