If (False)ÊÊ` Modified by: costasmanousakis-(Designer)-(7/26/2006 17:59:02)Mods_2006_CMy6 ÊÊ` Modified by: costasmanousakis-(Designer)-(10/25/2007 10:59:21)Mods_2007_CM12_5302 ÊÊ` Modified by: costasmanousakis-(Designer)-(9/22/08 15:05:47)Mods_2008_CM_5404 ÊÊ` ("SELECTLIST")ÊÊ`ÊÊ`Save the last method / command in  a global varÊÊ` Modified by: costasmanousakis-(Designer)-(7/23/10 )Mods_2010_07 ÊÊ`ÊÊ`Added optional parameters and better handling of executing on server - to serve as a generic execute method.ÊÊ` ParametersÊÊ` $1 (Optional) : $methodnameÊÊ` $2 (Optional) : ("S" | anything or blank ) "S" indicates execute on serverÊÊ` $3-9 (Optional) : text parameters for the method ÊÊ` Modified by: costasmanousakis-(Designer)-(8/31/10 15:49:25)Mods_2010_08 ÊÊ`ÊÊ`Fixed a bug in the assigning of parameters Param(1...7)_txtÊÊ` Modified by: costasmanousakis-(Designer)-(10/26/10 08:33:29)Mods_2010_10 ÊÊ`ÊÊ`Changes to remember list of commands between sessions. The list is stored asÊÊ`ÊÊ` a Blob in file UTEXEC_Command_file.txt in the active 4D folder.ÊÊ`ÊÊ`Also can "pass" parameters to the method when executed locally, by concatenating them ÊÊ`ÊÊ`in the command executed. Mods_2011_05 ÊÊ`r002 CJ Miller`05/23/11, 10:25:17    ÊÊ`Modify so when compiled we can use parameters in executeMods_2011_06 ÊÊ` CJ Miller`06/13/11, 16:54:56      ` Type all local variables for v11ÊÊ` Modified by: costasmanousakis-(Designer)-(12/12/11 09:17:09)Mods_2011_12 ÊÊ`ÊÊ`sort the array of commands before storing them; remove if(FALSE) code blockÊÊ` Modified by: Costas Manousakis-(Designer)-(1/22/14 18:10:47)Mods_2014_01 ÊÊ`ÊÊ`Added ability to execute on a registered clientEnd if If (User in group(Current user;"Design Access Group"))C_LONGINT($pid)ARRAY TEXT(×UTEXEC_Command_atxt;0)C_TEXT(×UTEXEC_Command;$UTEXEC_Command_file_txt;$msg;$methodname)Startup_PL C_BLOB($TempBlob_x)C_LONGINT($offset_L)C_BOOLEAN($DoCmd_b)$UTEXEC_Command_file_txt:=Get 4D folder(Active 4D Folder )+"UTEXEC_Command_file.txt"If (Test path name($UTEXEC_Command_file_txt)=Is a document )DOCUMENT TO BLOB($UTEXEC_Command_file_txt;$TempBlob_x)$offset_L:=0BLOB TO VARIABLE($TempBlob_x;×UTEXEC_Command_atxt;$offset_L)BLOB TO VARIABLE($TempBlob_x;×UTEXEC_Command;$offset_L)Else C_TIME($docref)$docref:=Create document($UTEXEC_Command_file_txt)CLOSE DOCUMENT($docref)ARRAY TEXT(×UTEXEC_Command_atxt;1)×UTEXEC_Command_atxt{1}:=""End if $methodname:=""$DoCmd_b:=FalseIf (Count parameters>0)C_TEXT($1)$methodname:=$1$DoCmd_b:=TrueEnd if If ($methodname="")$msg:="Select a Command to execute, or enter a new one. "$methodname:=ut_Request ($msg;->×UTEXEC_Command_atxt;×UTEXEC_Command;"";"";2)$DoCmd_b:=(OK=1)End if If ($DoCmd_b)×UTEXEC_Command:=$methodnameC_BOOLEAN($LocalExec_b;$DoRun_b)C_LONGINT($loop_L;$ParamCount_L)$LocalExec_b:=True$DoRun_b:=TrueC_TEXT($ClientName_txt)$ClientName_txt:=""ÊÊ`Local or on Server?C_BOOLEAN($Newprocess_b)$Newprocess_b:=FalseIf (Count parameters>1)C_TEXT($2)$LocalExec_b:=($2#"S")Else If (Application type=4D Remote Mode )ARRAY TEXT($Choises_atxt;0)ARRAY LONGINT($Methods_aL;0)GET REGISTERED CLIENTS($Choises_atxt;$Methods_aL)INSERT IN ARRAY($Choises_atxt;1;2)$Choises_atxt{1}:="Local"$Choises_atxt{2}:="Server"ÊÊ`CONFIRM("Execute local or on server?";"Local";"Server")C_LONGINT($Choise_L)$Choise_L:=G_PickFromList (->$Choises_atxt;"Select Where to Execute the method")$LocalExec_b:=FalseCase of : ($Choise_L=1)$LocalExec_b:=True: ($Choise_L=2): ($Choise_L=>2)$ClientName_txt:=$Choises_atxt{$Choise_L}End case $LocalExec_b:=(OK=1)End if If (Application type#4D Server )Ê&Ê($LocalExec_b)CONFIRM("Execute as a new process?";"Yes";"No")$Newprocess_b:=(OK=1)End if End if ÊÊ`get parameters if passedC_TEXT($Paramtxt;Param1_txt;Param2_txt;Param3_txt;Param4_txt;Param5_txt;Param6_txt;Param7_txt)Param1_txt:=""Param2_txt:=""Param3_txt:=""Param4_txt:=""Param5_txt:=""Param6_txt:=""Param7_txt:=""C_POINTER($Param_ptr)C_LONGINT($parcounter)$parcounter:=0C_BOOLEAN($getParams_b)$getParams_b:=TrueÊÊ`if there were parameters passed we will not ask for any$parcounter:=0If (Count parameters>2)C_TEXT(${3})If (Count parameters>9)CONFIRM("More than 9 parameters passed! Only the first 7 will be used! Do you wish to cont"+"inue?")$DoRun_b:=(Ok=1)Else $DoRun_b:=TrueEnd if If ($DoRun_b)$ParamCount_L:=MinNum (Count parameters;9)For ($loop_L;3;$ParamCount_L)$Param_ptr:=Get pointer("Param"+String($loop_L-2)+"_txt")$Param_ptr->:=${$loop_L}$parcounter:=$parcounter+1End for $getParams_b:=FalseÊÊ`Do not ask for parameters when executing on serverEnd if End if If ($DoRun_b)ÊÊ`Maybe canceled in the GETPARAMETERS check aboveIf ($LocalExec_b)If ($Newprocess_b)If ($getParams_b)$parcounter:=1While ($getParams_b)$Paramtxt:=Request("Enter parameter #"+String($parcounter))If (OK=1)$Param_ptr:=Get pointer("Param"+String($parcounter)+"_txt")$Param_ptr->:=$Paramtxt$parcounter:=$parcounter+1Else $getParams_b:=FalseEnd if If ($parcounter>7)$getParams_b:=FalseEnd if End while $parcounter:=$parcounter-1End if Case of : ($parcounter=0)$pid:=New Process($methodname;×LStackSize;$methodname): ($parcounter=1)$pid:=New Process($methodname;×LStackSize;$methodname;Param1_txt): ($parcounter=2)$pid:=New Process($methodname;×LStackSize;$methodname;Param1_txt;Param2_txt): ($parcounter=3)$pid:=New Process($methodname;×LStackSize;$methodname;Param1_txt;Param2_txt;Param3_txt): ($parcounter=4)$pid:=New Process($methodname;×LStackSize;$methodname;Param1_txt;Param2_txt;Param3_txt;Param4_txt): ($parcounter=5)$pid:=New Process($methodname;×LStackSize;$methodname;Param1_txt;Param2_txt;Param3_txt;Param4_txt;Param5_txt): ($parcounter=6)$pid:=New Process($methodname;×LStackSize;$methodname;Param1_txt;Param2_txt;Param3_txt;Param4_txt;Param5_txt;Param6_txt): ($parcounter=7)$pid:=New Process($methodname;×LStackSize;$methodname;Param1_txt;Param2_txt;Param3_txt;Param4_txt;Param5_txt;Param6_txt;Param7_txt)End case Else ÊÊ``Execute LocallyIf ($parcounter>0)ÊÊ`if there were no parameters passed we don;t ask for any when local - maybe that should changeÊÊ`add parameters to the call$Param_ptr:=Get pointer("Param1_txt")$methodname:=$methodname+"("+×sQu+Param1_txt+×sQuÊÊ`open parenFor ($loop_L;2;$parcounter)$Param_ptr:=Get pointer("Param"+String($loop_L)+"_txt")$methodname:=$methodname+";"+×sQu+$Param_ptr->+×sQuEnd for $methodname:=$methodname+")"ÊÊ`close parenEnd if EXECUTE FORMULA($methodname)End if Else ÊÊ``Execute on Server or another clientÊÊ`we'll ask for parameters if there were not any passedIf ($getParams_b)$parcounter:=1While ($getParams_b)$Paramtxt:=Request("Enter parameter #"+String($parcounter))If (OK=1)$Param_ptr:=Get pointer("Param"+String($parcounter)+"_txt")$Param_ptr->:=$Paramtxt$parcounter:=$parcounter+1Else $getParams_b:=FalseEnd if If ($parcounter>7)$getParams_b:=FalseEnd if End while $parcounter:=$parcounter-1End if If ($ClientName_txt="")ÊÊ`execute on serverCase of : ($parcounter=0)$pid:=Execute on server($methodname;×LStackSize;$methodname): ($parcounter=1)$pid:=Execute on server($methodname;×LStackSize;$methodname;Param1_txt): ($parcounter=2)$pid:=Execute on server($methodname;×LStackSize;$methodname;Param1_txt;Param2_txt): ($parcounter=3)$pid:=Execute on server($methodname;×LStackSize;$methodname;Param1_txt;Param2_txt;Param3_txt): ($parcounter=4)$pid:=Execute on server($methodname;×LStackSize;$methodname;Param1_txt;Param2_txt;Param3_txt;Param4_txt): ($parcounter=5)$pid:=Execute on server($methodname;×LStackSize;$methodname;Param1_txt;Param2_txt;Param3_txt;Param4_txt;Param5_txt): ($parcounter=6)$pid:=Execute on server($methodname;×LStackSize;$methodname;Param1_txt;Param2_txt;Param3_txt;Param4_txt;Param5_txt;Param6_txt): ($parcounter=7)$pid:=Execute on server($methodname;×LStackSize;$methodname;Param1_txt;Param2_txt;Param3_txt;Param4_txt;Param5_txt;Param6_txt;Param7_txt)End case Else ÊÊ`execute on client $ClientName_txtCase of : ($parcounter=0)EXECUTE ON CLIENT($ClientName_txt;$methodname;×LStackSize;$methodname): ($parcounter=1)EXECUTE ON CLIENT($ClientName_txt;$methodname;×LStackSize;$methodname;Param1_txt): ($parcounter=2)EXECUTE ON CLIENT($ClientName_txt;$methodname;×LStackSize;$methodname;Param1_txt;Param2_txt): ($parcounter=3)EXECUTE ON CLIENT($ClientName_txt;$methodname;×LStackSize;$methodname;Param1_txt;Param2_txt;Param3_txt): ($parcounter=4)EXECUTE ON CLIENT($ClientName_txt;$methodname;×LStackSize;$methodname;Param1_txt;Param2_txt;Param3_txt;Param4_txt): ($parcounter=5)EXECUTE ON CLIENT($ClientName_txt;$methodname;×LStackSize;$methodname;Param1_txt;Param2_txt;Param3_txt;Param4_txt;Param5_txt): ($parcounter=6)EXECUTE ON CLIENT($ClientName_txt;$methodname;×LStackSize;$methodname;Param1_txt;Param2_txt;Param3_txt;Param4_txt;Param5_txt;Param6_txt): ($parcounter=7)EXECUTE ON CLIENT($ClientName_txt;$methodname;×LStackSize;$methodname;Param1_txt;Param2_txt;Param3_txt;Param4_txt;Param5_txt;Param6_txt;Param7_txt)End case End if ÊÊ`$pid:=Execute on server($methodname;×LStackSize;Substring($methodname;1;30);Param1_txt;Param2_txt;Param3_txt;Param4_txt;Param5_txt;Param6_txt;Param7_txt)End if If (Find in array(×UTEXEC_Command_atxt;×UTEXEC_Command)>0)Else INSERT IN ARRAY(×UTEXEC_Command_atxt;0;1)×UTEXEC_Command_atxt{1}:=×UTEXEC_CommandEnd if SET BLOB SIZE($TempBlob_x;0)SORT ARRAY(×UTEXEC_Command_atxt)VARIABLE TO BLOB(×UTEXEC_Command_atxt;$TempBlob_x)VARIABLE TO BLOB(×UTEXEC_Command;$TempBlob_x;*)BLOB TO DOCUMENT($UTEXEC_Command_file_txt;$TempBlob_x)SET BLOB SIZE($TempBlob_x;0)End if End if End if 