  ` ----------------------------------------------------  ` Method: QR_NextInspInfo  ` Description  `  ` Determine the next inspection and the type. assigns the values to process variables  `  ` SIA_NEXTINSP_DATE and SIA_NEXTINSPTYPE_TXT, SIA_NEXTINSPTYPECODE_TXT  `  ` Also returns the combined result in a text string  `  ` in the form "SIA_NEXTINSPTYPE_TXT SIA_NEXTINSP_DATE"  `   ` Parameters  ` $0 : $CombineREs_txt  ` $1 : $InfoType_txt   ` $2 : $StartDate_txt : starting date in text "MM/DD/YYYY" - if blank string the current date is used  ` $3 : $AnyText : if passed indicates the first call.  ` ----------------------------------------------------If (False)  ` ----------------------------------------------------  ` User name (OS): costasmanousakis  ` User name (4D): Designer  ` Date and time: 11/10/10, 08:22:50Mods_2010_11   ` Modified by: costasmanousakis-(Designer)-(10/28/11 11:17:50)Mods_2011_10   `  `Added process var SIA_NEXTINSPTYPECODE_TXT;  `  `Changed the order in which the above and UW inspections are checked  ` Modified by: Costas Manousakis-(Designer)-(9/11/13 14:58:12)Mods_2013_09   `  `Added  handling tunnel  inspecitoinsEnd if C_TEXT($0;$RetValue)C_TEXT($InfoType_txt)$InfoType_txt:="ANY"If (Count parameters>0)C_TEXT($1)$InfoType_txt:=$1End if If ($InfoType_txt="")$InfoType_txt:="ANY"End if C_DATE($StartDate_d)$StartDate_d:=Current date(*)If (Count parameters>1)C_TEXT($2;$StartDate_txt)$StartDate_txt:=$2$StartDate_d:=Date($StartDate_txt)If ($StartDate_d=!00/00/00!)$StartDate_d:=Current date(*)End if End if C_TEXT(SIA_NEXTINSPTYPE_TXT;SIA_NEXTINSPTYPECODE_TXT;$ThisInspType_txt;$ThisInspTypeCode_txt)C_DATE(SIA_NEXTINSP_DATE)If (Count parameters>2)C_TEXT($3)SIA_NEXTINSP_DATE:=!00/00/00!SIA_NEXTINSPTYPE_TXT:=""SIA_NEXTINSPTYPECODE_TXT:=""End if C_DATE($InspDate_d;$NextDate_d)C_LONGINT($Freq)C_BOOLEAN($Use)$Use:=FalseCase of : ($InfoType_txt="ANY")$RetValue:=QR_NextInspInfo ("ABOVE";String($StartDate_d))$RetValue:=QR_NextInspInfo ("UW";String($StartDate_d)): ($InfoType_txt="ABOVE")$RetValue:=QR_NextInspInfo ("Closed";String($StartDate_d))$RetValue:=QR_NextInspInfo ("Routine";String($StartDate_d))$RetValue:=QR_NextInspInfo ("FCR";String($StartDate_d))$RetValue:=QR_NextInspInfo ("CMI";String($StartDate_d))$RetValue:=QR_NextInspInfo ("Other";String($StartDate_d)): ($InfoType_txt="TUNNEL")QUERY([TunnelInfo];[TunnelInfo]BIN=[Bridge MHD NBIS]BIN)$RetValue:=QR_NextInspInfo ("Routine";String($StartDate_d))$RetValue:=QR_NextInspInfo ("CMI";String($StartDate_d))$RetValue:=QR_NextInspInfo ("TOV";String($StartDate_d))$RetValue:=QR_NextInspInfo ("Special1";String($StartDate_d))$RetValue:=QR_NextInspInfo ("Special2";String($StartDate_d))$RetValue:=QR_NextInspInfo ("Special3";String($StartDate_d))$RetValue:=QR_NextInspInfo ("Closed";String($StartDate_d))$RetValue:=QR_NextInspInfo ("Other";String($StartDate_d)): ($InfoType_txt="UW")$RetValue:=QR_NextInspInfo ("UWRoutine";String($StartDate_d))$RetValue:=QR_NextInspInfo ("UWSpec";String($StartDate_d)): ($InfoType_txt="FCR")$InspDate_d:=[Bridge MHD NBIS]Item93A$Freq:=[Bridge MHD NBIS]Item92AB$Use:=[Bridge MHD NBIS]Item92AA$ThisInspType_txt:="Fracture Crit."$ThisInspTypeCode_txt:="FCR": ($InfoType_txt="Routine")$InspDate_d:=[Bridge MHD NBIS]Item90$Freq:=24$Use:=True$ThisInspType_txt:="Routine"$ThisInspTypeCode_txt:="RTN": ($InfoType_txt="CMI")$InspDate_d:=[Bridge MHD NBIS]Item93C$Freq:=[Bridge MHD NBIS]Item92CB$Use:=[Bridge MHD NBIS]Item92CA$ThisInspType_txt:="Special Member"$ThisInspTypeCode_txt:="CMI": ($InfoType_txt="Other")$InspDate_d:=[Bridge MHD NBIS]OtherIDate$Freq:=[Bridge MHD NBIS]OtherIFreq$Use:=[Bridge MHD NBIS]OtherInsp$ThisInspType_txt:="Other"$ThisInspTypeCode_txt:="OTH": ($InfoType_txt="Closed")$InspDate_d:=[Bridge MHD NBIS]ClosedIDate$Freq:=[Bridge MHD NBIS]ClosedIFreq$Use:=[Bridge MHD NBIS]ClosedInsp$ThisInspType_txt:="Closed"$ThisInspTypeCode_txt:="CLD": ($InfoType_txt="UWRoutine")$InspDate_d:=[Bridge MHD NBIS]Item93B$Freq:=[Bridge MHD NBIS]Item92BB$Use:=[Bridge MHD NBIS]Item92BA$ThisInspType_txt:="UW Routine"$ThisInspTypeCode_txt:="DVE": ($InfoType_txt="UWSpec")If ([Bridge MHD NBIS]UWSpInspDate=!00/00/00!)$InspDate_d:=[Bridge MHD NBIS]Item93BElse $InspDate_d:=[Bridge MHD NBIS]UWSpInspDateEnd if $Freq:=[Bridge MHD NBIS]UWSpInspFreq$Use:=[Bridge MHD NBIS]UWSpInsp$ThisInspType_txt:="UW Special"$ThisInspTypeCode_txt:="DVS": ($InfoType_txt="TOV")$InspDate_d:=[TunnelInfo]OverHeadInspDate_d$Freq:=[TunnelInfo]OverHeadInspFreq_i$Use:=($Freq>0)$ThisInspType_txt:="Tunnel Overhead Items"$ThisInspTypeCode_txt:="TOV": ($InfoType_txt="Special1")$InspDate_d:=[TunnelInfo]SpecialInsp1Date_d$Freq:=[TunnelInfo]SpecialInsp1Freq_i$Use:=($Freq>0)$ThisInspType_txt:="Tunnel Special 1"$ThisInspTypeCode_txt:="SP1": ($InfoType_txt="Special2")$InspDate_d:=[TunnelInfo]SpecialInsp2Date_d$Freq:=[TunnelInfo]SpecialInsp2Freq_i$Use:=($Freq>0)$ThisInspType_txt:="Tunnel Special 2"$ThisInspTypeCode_txt:="SP2": ($InfoType_txt="Special3")$InspDate_d:=[TunnelInfo]SpecialInsp3Date_d$Freq:=[TunnelInfo]SpecialInsp3Freq_i$Use:=($Freq>0)$ThisInspType_txt:="Tunnel Special 3"$ThisInspTypeCode_txt:="SP3"End case If ($InspDate_d=!00/00/00!)$InspDate_d:=[Bridge MHD NBIS]Item90End if $NextDate_d:=!00/00/00!If ($use)If ($InspDate_d#!00/00/00!)If ($Freq>0)$NextDate_d:=$InspDate_dRepeat $NextDate_d:=Add to date($NextDate_d;0;$Freq;0)Until ($NextDate_d>=$StartDate_d)$NextDate_d:=Date(String(Month of($NextDate_d))+"/1/"+String(Year of($NextDate_d)))  `roll it to the 1st of the monthEnd if End if End if If ($NextDate_d#!00/00/00!)Case of : (($NextDate_d<SIA_NEXTINSP_DATE) | (SIA_NEXTINSP_DATE=!00/00/00!))SIA_NEXTINSP_DATE:=$NextDate_dSIA_NEXTINSPTYPE_TXT:=$ThisInspType_txtSIA_NEXTINSPTYPECODE_TXT:=$ThisInspTypeCode_txt: ($NextDate_d=SIA_NEXTINSP_DATE)SIA_NEXTINSPTYPE_TXT:=SIA_NEXTINSPTYPE_TXT+", "+$ThisInspType_txtEnd case End if If (SIA_NEXTINSP_DATE=!00/00/00!)$0:=""Else $0:=SIA_NEXTINSPTYPE_TXT+" "+String(SIA_NEXTINSP_DATE;Internal date short )End if 